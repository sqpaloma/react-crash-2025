(function(g){var window=this;'use strict';var jHI=function(p){var y=new g.uq("und",new g.rZ("Default","und",!0));y.captionTracks=p.captionTracks;return y},hw_=function(p){return new g.YW(function(y,O){var v=p.length,W=[];
if(v)for(var E=function(Q,q){v--;W[Q]=q;v==0&&y(W)},z=function(Q){O(Q)},f,n=0;n<p.length;n++)f=p[n],g.U5R(f,g.gF(E,n),z);
else y(W)})},mi=function(p){this.C=p},ds=function(){mi.apply(this,arguments)},bjF=function(){ds.apply(this,arguments)},CHS=function(){ds.apply(this,arguments)},D3K=function(){ds.apply(this,arguments)},V2Y=function(){ds.apply(this,arguments)},AyX=function(){ds.apply(this,arguments)},pt6=function(){ds.apply(this,arguments)},yHF=function(){mi.apply(this,arguments)},OYU=function(){ds.apply(this,arguments)},v96=function(){ds.apply(this,arguments)},WGI=function(){ds.apply(this,arguments)},g9I=function(){ds.apply(this,
arguments)},E9L=function(){ds.apply(this,arguments)},zPF=function(){ds.apply(this,arguments)},GwF=function(){ds.apply(this,arguments)},o9U=function(){ds.apply(this,arguments)},fGh=function(){ds.apply(this,arguments)},n9_=function(){ds.apply(this,arguments)},Q0h=function(){ds.apply(this,arguments)},qMe=function(){ds.apply(this,arguments)},SMh=function(){mi.apply(this,arguments)},Ndh=function(){ds.apply(this,arguments)},PQF=function(){ds.apply(this,arguments)},ujY=function(){ds.apply(this,arguments)},
JHF=function(){ds.apply(this,arguments)},KGA=function(){ds.apply(this,arguments)},cHU=function(){ds.apply(this,arguments)},RPI=function(){ds.apply(this,arguments)},$LY=function(){ds.apply(this,arguments)},s0F=function(){ds.apply(this,arguments)},rHI=function(){mi.apply(this,arguments)},aGK=function(){mi.apply(this,arguments)},kw_=function(){mi.apply(this,arguments)},xLA=function(){ds.apply(this,arguments)},TdU=function(){ds.apply(this,arguments)},tBF=function(){ds.apply(this,arguments)},YMY=function(){ds.apply(this,
arguments)},MB_=function(){ds.apply(this,arguments)},ZYY=function(){ds.apply(this,arguments)},LGK=function(){ds.apply(this,arguments)},lG_=function(){ds.apply(this,arguments)},wtL=function(){ds.apply(this,arguments)},mL6=function(){ds.apply(this,arguments)},dLI=function(){ds.apply(this,arguments)},BdA=function(){ds.apply(this,arguments)},HYY=function(){ds.apply(this,arguments)},iYX=function(){ds.apply(this,arguments)},FGY=function(){ds.apply(this,arguments)},IG_=function(){ds.apply(this,arguments)},
eP$=function(){ds.apply(this,arguments)},XtF=function(){ds.apply(this,arguments)},UL6=function(){ds.apply(this,arguments)},j0Y=function(){ds.apply(this,arguments)},hPU=function(){ds.apply(this,arguments)},bYF=function(){ds.apply(this,arguments)},CQY=function(){ds.apply(this,arguments)},DLL=function(){ds.apply(this,arguments)},VBU=function(){ds.apply(this,arguments)},AHh=function(){ds.apply(this,arguments)},p_F=function(){ds.apply(this,arguments)},ylI=function(){mi.apply(this,arguments)},O1I=function(){ds.apply(this,
arguments)},vWK=function(){ds.apply(this,arguments)},WqY=function(){ds.apply(this,arguments)},gWA=function(){ds.apply(this,arguments)},EWX=function(){ds.apply(this,arguments)},zA6=function(){ds.apply(this,arguments)},GXF=function(){ds.apply(this,arguments)},oW6=function(){ds.apply(this,arguments)},fEh=function(){ds.apply(this,arguments)},nW6=function(){ds.apply(this,arguments)},QZS=function(){ds.apply(this,arguments)},qDh=function(){ds.apply(this,arguments)},SDh=function(){ds.apply(this,arguments)},
NRK=function(){ds.apply(this,arguments)},PaY=function(){ds.apply(this,arguments)},u9F=function(){ds.apply(this,arguments)},JlY=function(){ds.apply(this,arguments)},KqF=function(){ds.apply(this,arguments)},clU=function(){ds.apply(this,arguments)},RAh=function(){ds.apply(this,arguments)},$re=function(){ds.apply(this,arguments)},sZY=function(){ds.apply(this,arguments)},rl6=function(){ds.apply(this,arguments)},aE_=function(){ds.apply(this,arguments)},kXX=function(){ds.apply(this,arguments)},xrA=function(){ds.apply(this,
arguments)},TRA=function(){ds.apply(this,arguments)},tgS=function(){ds.apply(this,arguments)},YDX=function(){ds.apply(this,arguments)},Mge=function(){ds.apply(this,arguments)},Z1U=function(){ds.apply(this,arguments)},LqY=function(){ds.apply(this,arguments)},lEL=function(){ds.apply(this,arguments)},w_e=function(p){p=p.key||p.id;
if(!p)throw Error("Entity key is missing");return p},mrU=function(){if(Ba)return Ba();
var p={};Ba=g.EA("PersistentEntityStoreDb",{HH:(p.EntityStore={Q$:1},p.EntityAssociationStore={Q$:2},p),shared:!1,upgrade:function(y,O){O(1)&&g.FG(g.w1(y,"EntityStore",{keyPath:"key"}),"entityType","entityType");O(2)&&(y=g.w1(y,"EntityAssociationStore",{keyPath:["parentEntityKey","childEntityKey"]}),g.FG(y,"byParentEntityKey","parentEntityKey"),g.FG(y,"byChildEntityKey","childEntityKey"))},
version:3});return Ba()},dre=function(p){return g.CX(mrU(),p)},BR$=function(p){return g.CX((0,g.RGF)(),p)},Ha=function(p){this.token=p},iu=function(p,y){y=y===void 0?{}:y;
g.pX.call(this,g.$OX[p],Object.assign({},{name:"PESEncoderError",type:p},y));this.type=p;this.level="WARNING";Object.setPrototypeOf(this,iu.prototype)},H1Y=function(p){return new iu("WRONG_DATA_TYPE",{Ci:p})},i1I=function(p){return p instanceof Error?new iu("UNKNOWN_ENCODE_ERROR",{originalMessage:p.message}):new iu("UNKNOWN_ENCODE_ERROR")},Fqe=function(p){return p instanceof Error?new iu("UNKNOWN_DECODE_ERROR",{originalMessage:p.message}):new iu("UNKNOWN_DECODE_ERROR")},IEe=function(p,y){p=p instanceof
iu?p:y(p);
g.F$(p);throw p;},eAX=function(){},X_h=function(p,y,O){try{return p.J(y,O)}catch(v){IEe(v,i1I)}},Ur_=function(p){p=(new TextEncoder).encode(p).subarray(0,16);
var y=new Uint8Array(16);y.set(p);return y},Fr=function(p){this.C=p},hA$=function(p){var y=jZU[p];
if(y)return y;g.It(new g.pX("Entity model not found.",{entityType:p}))},b1L=function(p,y){this.C=p;
this.T=y;this.J={}},DrX=function(p,y){a:{p=CaF(p.T,y.version);
try{var O=p.T(y.data,y.key);break a}catch(v){IEe(v,Fqe)}O=void 0}return O},Iv=function(p,y,O){return p.C.objectStore("EntityStore").get(y).then(function(v){if(v){if(O&&v.entityType!==O)throw Error("Incorrect entity type");
return DrX(p,v)}})},eO=function(p,y,O){return O?(O=O.map(function(v){return Iv(p,v,y)}),g.YB.all(O)):p.C.objectStore("EntityStore").index("entityType").getAll(IDBKeyRange.only(y)).then(function(v){return v.map(function(W){return DrX(p,W)})})},UG=function(p,y,O){var v=w_e(y),W=CaF(p.T,1),E=Object.assign({},y);
return p.C.objectStore("EntityStore").get(v).then(function(z){if(z){if(z.entityType!==O)throw Error("Incorrect entity type");E.entityMetadata||(z=DrX(p,z),E.entityMetadata=z.entityMetadata)}}).then(function(){var z={key:v,
entityType:O,data:X_h(W,E,v),version:1};return g.YB.all([g.Bi(p.C.objectStore("EntityStore"),z),Vg$(p,E,O)])}).then(function(){Xr(p,v,O);
return v})},AlX=function(p,y,O){y=y.map(function(v){return UG(p,v,O)});
return g.YB.all(y)},jO=function(p,y,O){if(O==null?0:O.fS){var v=new Set;
return p3e(p,y,v).then(function(){for(var E=[],z=g.c(v),f=z.next();!f.done;f=z.next())E.push(jO(p,f.value));return g.YB.all(E).then(function(){})})}var W=g.JK(y).entityType;
return g.YB.all([p.C.objectStore("EntityStore").delete(y),yAK(p,y)]).then(function(){Xr(p,y,W)})},O4Y=function(p,y){return g.UN(p.C.objectStore("EntityStore").index("entityType"),{query:IDBKeyRange.only(y)},function(O){return g.YB.all([O.delete(),
yAK(p,O.cursor.primaryKey)]).then(function(){Xr(p,O.cursor.primaryKey,y);return g.ec(O)})})},vMh=function(p,y,O,v){var W=CaF(p.T,1);
return Iv(p,y,v).then(function(E){if(E){E=g.kH(E,O);var z={key:y,entityType:v,data:X_h(W,E,y),version:1};return g.YB.all([g.Bi(p.C.objectStore("EntityStore"),z),Vg$(p,E,v)])}}).then(function(){Xr(p,y,v);
return y})},Xr=function(p,y,O){var v=p.J[O];
v||(v=new Set,p.J[O]=v);v.add(y)},WTS=function(p,y,O){var v=w_e(y);
O=hA$(O);if(!O)return g.YB.resolve([]);O=new O(y);p=p.C.objectStore("EntityAssociationStore");y=[];O=g.c(O.T());for(var W=O.next();!W.done;W=O.next())y.push(g.Bi(p,{parentEntityKey:v,childEntityKey:W.value}));return g.YB.all(y).then(function(E){return E.map(function(z){return z[1]})})},yAK=function(p,y){return p.C.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(y))},Vg$=function(p,y,O){var v=w_e(y);
return yAK(p,v).then(function(){return WTS(p,y,O)})},p3e=function(p,y,O){if(O.has(y))return g.YB.resolve(void 0);
O.add(y);return gMY(p,y).then(function(v){return p.C.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(y)).then(function(){return v})}).then(function(v){var W=g.YB.resolve(void 0);
v=g.c(v);for(var E=v.next(),z={};!E.done;z={mX:void 0},E=v.next())z.mX=E.value,W=W.then(function(f){return function(){return p3e(p,f.mX,O)}}(z));
return W}).then(function(){})},gMY=function(p,y){var O=p.C.objectStore("EntityAssociationStore");
return O.index("byParentEntityKey").getAll(IDBKeyRange.only(y)).then(function(v){var W=[];v=g.c(v);for(var E=v.next();!E.done;E=v.next())E=E.value,W.push(O.index("byChildEntityKey").getAll(E.childEntityKey));return g.YB.all(W)}).then(function(v){var W=[];
v=g.c(v);for(var E=v.next();!E.done;E=v.next())E=E.value,E.length===1&&W.push(E[0].childEntityKey);return W})},h6=function(){},EMe=function(){this.C={};
this.C[0]=new h6;if(!g.xL("aes_pes_encoder_killswitch")){var p=this.C;try{var y=g.yk();var O=Ur_(y);var v=new Fr(new g.lO(O),new g.Ly(O))}catch(W){throw p=W instanceof Error?new iu("KEY_CREATION_FAILED",{originalMessage:W.message}):new iu("KEY_CREATION_FAILED"),g.F$(p),p;}p[1]=v}},CaF=function(p,y){y=y===void 0?0:y;
p=p.C[y];if(!p)throw y=new iu("INVALID_ENCODER_VERSION",{Ci:y}),g.F$(y),y;return p},bu=function(p,y){g.d.call(this);
this.token=p;this.C=y;this.observers=[];p=new g.ji.BroadcastChannel("PERSISTENT_ENTITY_STORE_SYNC:"+g.yk());p.onmessage=this.T.bind(this);this.channel=p},Ci=function(p,y,O){var v,W,E,z;
return g.w(function(f){if(f.T==1)return g.L(f,dre(p.token),2);if(f.T!=3)return v=f.C,g.L(f,g.d1(v,["EntityStore","EntityAssociationStore"],y,function(n){W=new b1L(n,p.C);return O(W)}),3);
E=f.C;W&&(z=W.J,Object.keys(z).length>0&&(p.channel.postMessage(z),zLX(p,z)));return f.return(E)})},Dp=function(p,y,O){return Ci(p,{mode:"readwrite",
K_:!0},function(v){return UG(v,y,O)})},Gn_=function(p,y){return Ci(p,{mode:"readwrite",
K_:!0},function(O){return AlX(O,y,"offlineOrchestrationActionWrapperEntity")})},oMS=function(p,y){return Ci(p,{mode:"readwrite",
K_:!0},function(O){return jO(O,y)})},fb_=function(p){return Ci(p,{mode:"readwrite",
K_:!0},function(y){return O4Y(y,"videoPlaybackPositionEntity")})},V6=function(p,y,O){return Ci(p,{mode:"readonly",
K_:!0},function(v){return Iv(v,y,O)})},A6=function(p,y,O){return Ci(p,{mode:"readonly",
K_:!0},function(v){return eO(v,y,O)})},zLX=function(p,y){p=g.c(p.observers);
for(var O=p.next();!O.done;O=p.next())O=O.value,O(y)},nM_=function(){var p,y,O;
return g.w(function(v){if(v.T==1)return g.Rx(v,2),g.L(v,g.Ws(),4);if(v.T!=2){p=v.C;if(!p||!g.ON()||typeof g.ji.BroadcastChannel==="undefined")return v.return();y=new EMe;return v.return(new bu(p,y))}O=g.kx(v);O instanceof Error&&g.F$(O);return v.return()})},pI=function(){QIh||(QIh=nM_());
return QIh},q7L=function(p){var y;
p=(y=p.options)==null?void 0:y.persistenceOption;return p==="ENTITY_PERSISTENCE_OPTION_PERSIST"||p==="ENTITY_PERSISTENCE_OPTION_INMEMORY_AND_PERSIST"},S7U=function(p){var y;
return g.w(function(O){return O.T==1?g.L(O,pI(),2):(y=O.C)?g.L(O,Ci(y,"readwrite",function(v){for(var W={},E=g.c(p),z=E.next(),f={};!z.done;f={aC:void 0,Lq:void 0},z=E.next())f.aC=z.value,f.aC.entityKey&&q7L(f.aC)&&(f.Lq=g.eF(f.aC.payload),z=void 0,f.aC.type==="ENTITY_MUTATION_TYPE_REPLACE"&&(z=function(n){return function(){return UG(v,n.aC.payload[n.Lq],n.Lq)}}(f)),f.aC.type==="ENTITY_MUTATION_TYPE_DELETE"&&(z=function(n){return function(){return jO(v,n.aC.entityKey)}}(f)),f.aC.type==="ENTITY_MUTATION_TYPE_UPDATE"&&
(z=function(n){return function(){return vMh(v,n.aC.entityKey,n.aC.payload[n.Lq],n.Lq)}}(f)),z&&(W[f.aC.entityKey]=W[f.aC.entityKey]?W[f.aC.entityKey].then(z):z()));
return g.YB.all(Object.values(W))}),0):O.return()})},NnI=function(p){var y;
return g.w(function(O){if(O.T==1){y=p.mutations;if(!y||y.length<=0)return O.return();if(g.nV){var v={type:"ENTITY_LOADED"};y!==void 0&&(v.payload=y);g.nV.dispatch(v)}return g.L(O,S7U(y),2)}y.length=0;g.cR(O)})},P0A=function(p){return p!==void 0},u8L=function(p){var y=g.H9();
y=Object.assign({},y);p=Object.assign({},p);for(var O in y)p[O]?(y[O]!==4&&(y[O]=p[O]),delete p[O]):y[O]!==2&&(y[O]=4);Object.assign(y,p);g.$7b(y);JSON.stringify(y);return y},JA_=function(p){var y,O;
return g.w(function(v){if(v.T==1)return g.L(v,g.Ws(),2);if(v.T!=3)return(y=v.C)?g.L(v,g.I6(y),3):v.return();O=v.C;return v.return(g.d1(O,["index","media","captions"],{mode:"readwrite",K_:!0},function(W){var E=IDBKeyRange.bound(p+"|",p+"~");W=[W.objectStore("index").delete(E),W.objectStore("media").delete(E),W.objectStore("captions").delete(E)];return g.YB.all(W).then(function(){})}))})},KT$=function(){var p,y;
return g.w(function(O){if(O.T==1)return g.L(O,g.Ws(),2);if(O.T!=3){p=O.C;if(!p)throw g.TY("rvdfd");return g.L(O,g.I6(p),3)}y=O.C;return O.return(g.d1(y,["index","media"],{mode:"readwrite",K_:!0},function(v){var W={};return g.In(v.objectStore("index"),{},function(E){var z=E.cursor.key.match(/^([\w\-_]+)\|(a|v)$/),f=g.YB.resolve(void 0);if(z){var n=z[1];z=z[2];W[n]=W[n]||{};var Q;W[n][z]=g.x7K((Q=E.getValue())==null?void 0:Q.fmts)}else f=E.delete().then(function(){});
return g.YB.all([g.ec(E),f]).then(function(q){return g.c(q).next().value})}).then(function(){for(var E={},z=g.c(Object.keys(W)),f=z.next();!f.done;f=z.next()){f=f.value;
var n=W[f].v;E[f]=W[f].a&&n?1:2}var Q=u8L(E);return g.t1i(v.objectStore("media"),{},function(q){var S=q.cursor.key.match(g.MzQ);S&&E[S[1]]||v.objectStore("media").delete(q.cursor.key);return g.cgB(q)}).then(function(){return Q})})}))})},cAF=function(p,y){var O,v;
return g.w(function(W){if(W.T==1)return g.L(W,g.Ws(),2);if(W.T!=3){O=W.C;if(!O)throw g.TY("wct");return g.L(W,g.I6(O),3)}v=W.C;return g.L(W,g.d1(v,["captions"],{mode:"readwrite",K_:!0},function(E){var z=[];E=E.objectStore("captions");for(var f=0;f<y.length;f++){var n=g.Bi(E,y[f],p+"|"+y[f].metadata.vss_id);z.push(n)}return g.YB.all(z)}),0)})},RLA=function(p){var y,O,v;
return g.w(function(W){if(W.T==1)return y=IDBKeyRange.bound(p+"|",p+"~"),g.L(W,g.Ws(),2);if(W.T!=3){O=W.C;if(!O)throw g.TY("gactfv");return g.L(W,g.I6(O),3)}v=W.C;return W.return(v.getAll("captions",y))})},$aF=function(p){return g.w(function(y){g.Fp(p,0);
return y.return(JA_(p))})},sIe=function(p){return{context:g.Jx(),
videoIds:p}},rAL=function(p){return{context:g.Jx(),
playlistIds:p}},abh=function(p){return{context:g.Jx(),
offlinePlaylistSyncChecks:p}},knF=function(){this.C=new Map},Tn$=function(){xaI||(xaI=new knF);
return xaI},tuK=function(p,y){return{eventType:{flowEventNamespace:"FLOW_EVENT_NAMESPACE_OFFLINE_ORCHESTRATION",
flowEventType:p},metadata:y,statusCode:void 0,csn:void 0,can:void 0}},Y7$=function(p,y,O){if(!O){var v=v===void 0?!1:v;
O=p.C.get("FLOW_TYPE_OFFLINE_ORCHESTRATION");if(!O||v)O=g.t8(16),p.C.set("FLOW_TYPE_OFFLINE_ORCHESTRATION",O)}p={flowNonce:O,flowType:"FLOW_TYPE_OFFLINE_ORCHESTRATION",flowEventType:y.eventType};y.metadata&&(p.flowMetadata=y.metadata);y.statusCode!==void 0&&(p.flowEventStatus=y.statusCode);y.csn&&(p.csn=y.csn);y.can&&(p.can=y.can);g.Pi("flowEvent",p,void 0)},MuY=function(p){var y,O,v,W,E,z,f,n,Q,q,S,N,P,u,R,r,x,k,M,l,H,h,X,V,WR,O4,E4,b,PR,xx,U4,rF,GL,T0,ax,O_,a,G0,U_,$C;
return g.w(function(tI){if(tI.T==1)return g.L(tI,Ci(p,{mode:"readonly",K_:!0},function(QU){return eO(QU,"playbackData").then(function(HR){var lY=HR.map(function(Z){return Z.transfer}).filter(function(Z){return!!Z}),Y6=HR.map(function(Z){return Z.offlineVideoPolicy}).filter(function(Z){return!!Z}),t=HR.filter(function(Z){return!!Z.key}).map(function(Z){return g.Ky(g.JK(Z.key).entityId,"downloadStatusEntity")});
lY=eO(QU,"transfer",lY);Y6=eO(QU,"offlineVideoPolicy",Y6);t=eO(QU,"downloadStatusEntity",t);var Y=lY.then(function(Z){Z=Z.reduce(function(m,e){(e==null?0:e.offlineVideoStreams)&&m.push.apply(m,g.T(e.offlineVideoStreams));return m},[]).filter(function(m){return!!m});
return eO(QU,"offlineVideoStreams",Z)});
return g.YB.all([lY,Y6,Y,t]).then(function(Z){var m=g.c(Z);Z=m.next().value;var e=m.next().value;var s4=m.next().value;m=m.next().value;return[HR,Z,e,s4,m]})})}),2);
if(tI.T!=3)return y=tI.C,g.L(tI,Ci(p,{mode:"readonly",K_:!0},function(QU){return eO(QU,"mainDownloadsListEntity").then(function(HR){var lY,Y6;return(Y6=(lY=HR[0])==null?void 0:lY.downloads)!=null?Y6:[]})}),3);
O=tI.C;v=g.c(y);W=v.next().value;E=v.next().value;z=v.next().value;f=v.next().value;n=v.next().value;Q=W;q=E;S=z;N=f;P=n;u={};R={};r={};x={};k={};M=[];l=g.c(q);for(H=l.next();!H.done;H=l.next())(h=H.value)&&(u[h.key]=h);X=g.c(S);for(V=X.next();!V.done;V=X.next())(WR=V.value)&&(R[WR.key]=WR);O4=g.c(P);for(E4=O4.next();!E4.done;E4=O4.next())(b=E4.value)&&(r[b.key]=b);PR=g.c(N);for(xx=PR.next();!xx.done;xx=PR.next())(U4=xx.value)&&(x[U4.key]=U4);rF=g.c(O);for(GL=rF.next();!GL.done;GL=rF.next())T0=GL.value,
ax=void 0,k[(ax=T0.videoItem)!=null?ax:""]=!0,T0.videoItem&&(a=O_=void 0,G0=(a=(O_=g.JK(T0.videoItem))==null?void 0:O_.entityId)!=null?a:"",M.push({externalVideoId:G0}));U_=Q.filter(function(QU){if(!QU||!QU.key||!QU.offlineVideoPolicy)return!1;QU=g.JK(QU.key).entityId;QU=g.Ky(QU,"downloadStatusEntity");var HR;return!(QU&&((HR=r[QU])==null?void 0:HR.downloadState)==="DOWNLOAD_STATE_USER_DELETED")});
$C=U_.map(function(QU){var HR=u[QU.transfer],lY=[];if(HR==null?0:HR.offlineVideoStreams)for(var Y6=g.c(HR.offlineVideoStreams),t=Y6.next();!t.done;t=Y6.next())(t=x[t.value])&&lY.push(t);Y6=R[QU.offlineVideoPolicy];t=k;var Y=QU==null?void 0:QU.playerResponseTimestamp,Z=g.JK(Y6.key).entityId;QU=g.Ky(Z,"mainVideoEntity");if(Y6.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"){var m="OFFLINE_VIDEO_STATE_DISABLED";Y6.expirationTimestamp&&Number(Y6.expirationTimestamp)<Date.now()/1E3&&(m="OFFLINE_VIDEO_STATE_EXPIRED")}else if(Y6.action===
"OFFLINE_VIDEO_POLICY_ACTION_DOWNLOAD_FAILED")m="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";else{switch(HR==null?void 0:HR.transferState){case "TRANSFER_STATE_TRANSFER_IN_QUEUE":m="OFFLINE_VIDEO_STATE_PENDING";break;case "TRANSFER_STATE_TRANSFERRING":m="OFFLINE_VIDEO_STATE_TRANSFERRING";break;case "TRANSFER_STATE_PAUSED_BY_USER":m="OFFLINE_VIDEO_STATE_PAUSED_TRANSFER";break;case "TRANSFER_STATE_FAILED":m="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";break;case "TRANSFER_STATE_COMPLETE":m="OFFLINE_VIDEO_STATE_PLAYABLE";
break;case "TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH":m="OFFLINE_VIDEO_STATE_STREAMS_OUT_OF_DATE";break;default:m="OFFLINE_VIDEO_STATE_UNKNOWN"}if(m==="OFFLINE_VIDEO_STATE_OFFLINE_FAILED")switch(HR==null?void 0:HR.failureReason){case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":m="OFFLINE_VIDEO_STATE_OUT_OF_STORAGE_ERROR";break;case "TRANSFER_FAILURE_REASON_STREAM_MISSING":m="OFFLINE_VIDEO_STATE_STREAMS_MISSING";break;case "TRANSFER_FAILURE_REASON_NETWORK":case "TRANSFER_FAILURE_REASON_NETWORK_LOST":m=
"OFFLINE_VIDEO_STATE_NETWORK_ERROR"}}Z={id:Z,videoState:m};if(HR==null?0:HR.cotn)Z.cotn=HR.cotn;if(HR==null?0:HR.maximumDownloadQuality)Z.selectedVideoQuality=HR==null?void 0:HR.maximumDownloadQuality;if(HR==null?0:HR.lastProgressTimeMs)Z.lastProgressTimeMs=HR.lastProgressTimeMs;Y&&(Z.playerResponseSavedTimeMs=String(Number(Y)*1E3));HR=String;Y=0;lY=g.c(lY);for(m=lY.next();!m.done;m=lY.next())if(m=m.value,m.streamsProgress){m=g.c(m.streamsProgress);for(var e=m.next();!e.done;e=m.next()){var s4=void 0;
Y+=Number((s4=e.value.numBytesDownloaded)!=null?s4:0)}}Z.downloadedBytes=HR(Y);Z.selectedOfflineMode=t[QU]?"OFFLINE_MODE_TYPE_AUTO_OFFLINE":"OFFLINE_NOW";Y6.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"&&(Z.offlinePlaybackDisabledReason=Y6.offlinePlaybackDisabledReason);return Z});
return tI.return({offlineVideos:$C,additionalOfflineClientState:{mainAppAdditionalOfflineClientState:{smartDownloadVideos:M}}})})},Z4Y=function(){this.locks=navigator.locks},LTL=function(){try{var p=g.b1("ytglobal.locks_");
if(p)return p;var y;if(y=navigator){var O=navigator;y="locks"in O&&!!O.locks}if(y)return g.ji.localStorage&&g.ji.localStorage.getItem("noop"),p=new Z4Y,g.hQ("ytglobal.locks_",p),p}catch(v){}},yX=function(){},lbh=function(){},w3$=function(p){if(p.includes(":"))throw Error("Invalid user cache name: "+p);
return p+":"+g.yk("CacheStorage get")},maF=function(){return g.w(function(p){if(On!==void 0)return p.return(On);
On=new Promise(function(y){var O;return g.w(function(v){switch(v.T){case 1:return g.Rx(v,2),g.L(v,v7.open("test-only"),4);case 4:return g.L(v,v7.delete("test-only"),5);case 5:g.rQ(v,3);break;case 2:if(O=g.kx(v),O instanceof Error&&O.name==="SecurityError")return y(!1),v.return();case 3:y("caches"in window),g.cR(v)}})});
return p.return(On)})},Bn6=function(){return g.w(function(p){if(p.T==1)return g.L(p,maF(),2);
if(!p.C)return p.return(void 0);daA||(daA=new lbh);return p.return(daA)})},W7=function(p,y,O){g.It(new g.pX("Woffle: "+p,O?{cotn:O}:""));
y instanceof Error&&g.It(y)},H4A=function(p){var y;
return g.w(function(O){if(O.T==1)return g.L(O,MuY(p),2);y=O.C;g.Pi("offlineStateSnapshot",y);g.cR(O)})},gH=function(p){g.d.call(this);
var y=this;this.api=p;this.Jn={jcu:function(){return y.C},
HhR:function(){return y.T}};
typeof g.ji.BroadcastChannel!=="undefined"&&(this.C=new g.ji.BroadcastChannel("PLAYER_OFFLINE_ERROR_SYNC:"+g.yk()),this.C.onmessage=this.J.bind(this),this.T=new g.ji.BroadcastChannel("PLAYER_OFFLINE_PAUSE_SYNC:"+g.yk()),this.T.onmessage=this.B.bind(this))},En=function(p,y){p.api.g2("onOfflineOperationFailure",y);
var O;(O=p.C)==null||O.postMessage(y)},i4F=function(p,y,O,v){var W=this;
this.S=p;this.V=y;this.visibility=O;this.K=v;this.D=this.Y=this.G=this.J=this.C=!1;this.B=new g.WI(function(){W.ZB()});
this.Jn={MP:function(){return W.T},
ZB:function(){W.ZB()},
CRu:function(){return W.B}};
this.visibility.subscribe("visibilitystatechange",function(){W.fE()})},FTA=function(p){if(!p.J&&!p.C){var y=LTL();
if(y){p.J=!0;var O=g.yk("OfflineLockManager");y.request("woffle_orchestration_leader:"+O,{},function(){var v,W,E,z;return g.w(function(f){switch(f.T){case 1:return g.Rx(f,2),p.T=new g.JA,p.C=!0,p.J=!1,g.L(f,p.S(),4);case 4:return g.L(f,p.T.promise,5);case 5:g.rQ(f,0);break;case 2:v=g.kx(f),((E=(W=p).K)==null?0:E.call(W,"wo_relinquish_leadership_on_lock_request_error"))||p.ZB(),v instanceof Error&&(z=v,z.args=[{name:"WoLockManagerError",QA:v.name}],g.F$(z)),g.cR(f)}})})}}},IbA=function(p){p.C&&(p.D=
!0,zv(p))},eLS=function(p,y){p.C&&(p.G=y,zv(p))},X3h=function(p,y){p.C&&(p.Y=y,zv(p))},zv=function(p){p.Y&&p.G&&p.D&&p.visibility.isBackground()?g.gb(p.B,6E4):p.B.stop()},Gv=function(p){var y;
p.offlineDeleteReason=(y=p.offlineDeleteReason)!=null?y:"OFFLINE_DELETE_REASON_UNKNOWN";var O;p.offlineModeType=(O=p.offlineModeType)!=null?O:"OFFLINE_NOW";g.Pi("offlineDeleteEvent",p)},o8=function(p,y){var O=y.videoId;
var v=y.ZO;y=y.offlineModeType;p.encryptedVideoId=O;p.cotn=v==null?void 0:v.cotn;p.offlineabilityFormatType=v==null?void 0:v.maximumDownloadQuality;var W;p.isRefresh=(W=v==null?void 0:v.isRefresh)!=null?W:!1;var E;p.softErrorCount=(E=v==null?void 0:v.transferRetryCount)!=null?E:0;p.offlineModeType=y!=null?y:"OFFLINE_NOW";(p.transferStatusType==="TRANSFER_STATUS_TYPE_UNKNOWN"&&p.statusType==="UNKNOWN_STATUS_TYPE"||!p.transferStatusType&&!p.statusType)&&g.It(Error("Woffle unknown transfer status"));
g.Pi("offlineTransferStatusChanged",p)},UaS=function(p){o8({transferStatusType:"TRANSFER_STATUS_TYPE_ENQUEUED",
statusType:"ADDED_TO_QUEUE"},p)},jIU=function(p,y,O,v){v={transferStatusType:"TRANSFER_STATUS_TYPE_PROCESSING",
statusType:"OFFLINING_STARTED",transferFirstStarted:!!v};y&&O&&(y=Math.floor(y/1024).toFixed(),O=Math.floor(O/1024).toFixed(),v.alreadyDownloadedKbytes=y,v.totalFetchedKbytes=y,v.totalContentKbytes=O);o8(v,p)},hLX=function(p){o8({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_PLAYER_RESPONSE_REFRESH"},p)},b4A=function(p){o8({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_USER_PAUSE",
statusType:"SUSPENDED"},p)},C0Y=function(p){switch(p){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":return"OFFLINE_DATABASE_ERROR";
case "TRANSFER_FAILURE_REASON_PLAYABILITY":return"NOT_PLAYABLE";case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":return"TOO_MANY_RETRIES";case "TRANSFER_FAILURE_REASON_INTERNAL":return"OFFLINE_DOWNLOAD_CONTROLLER_ERROR";case "TRANSFER_FAILURE_REASON_STREAM_MISSING":return"STREAM_VERIFICATION_FAILED";case "TRANSFER_FAILURE_REASON_SERVER":case "TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING":return"OFFLINE_REQUEST_FAILURE";case "TRANSFER_FAILURE_REASON_NETWORK":return"OFFLINE_NETWORK_ERROR";default:return"UNKNOWN_FAILURE_REASON"}},
fI=function(p){var y,O,v;
return((v=(y=p.actionMetadata)==null?void 0:(O=y.retryScheduleIntervalsInSeconds)==null?void 0:O.length)!=null?v:0)>0},nI=function(p){return p.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD"&&!!p.entityKey},QX=function(p){return p.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&!!p.entityKey},q6=function(p){return p.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&!!p.entityKey},DaF=function(p){return p.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE"&&!!p.entityKey},
SG=function(p,y,O,v,W){W=W===void 0?!1:W;
var E,z,f,n,Q,q;return g.w(function(S){if(S.T==1)return E=g.Ky(p,y),z=g.Ky(p,"downloadStatusEntity"),g.L(S,Ci(O,{mode:"readonly",K_:!0},function(N){return g.YB.all([Iv(N,E,y),Iv(N,z,"downloadStatusEntity")])}),2);
f=S.C;n=f.length?f[0]:void 0;if(!n)return S.W2(0);Q=VuL;if(q=f.length>1?f[1]:void 0){if(q.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&!W)return S.return();q.downloadState=v}else q={key:z,downloadState:v};g.hT(n,Q,q);return g.L(S,Ci(O,{mode:"readwrite",K_:!0},function(N){return g.YB.all([UG(N,n,y),UG(N,q,"downloadStatusEntity")])}),0)})},N6=function(p,y){return p.actionType===y.actionType&&p.entityKey===y.entityKey},P7=function(p,y){if(p&&p.transferState!=="TRANSFER_STATE_COMPLETE"&&p.transferState!==
"TRANSFER_STATE_FAILED"){var O=g.JK(p.key).entityId;
o8({transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_BY_USER",statusType:"CANCELLED"},{videoId:O,ZO:p,offlineModeType:y})}},uw=function(p){if(!p||!p.thumbnails)return[];
var y=[];p=g.c(p.thumbnails);for(var O=p.next();!O.done;O=p.next())O=O.value,O.url&&y.push(O.url);return y},AAh=function(p,y,O){O=O===void 0?[]:O;
var v,W,E,z,f,n,Q,q,S,N,P,u,R;return g.w(function(r){if(r.T==1)return O.length?g.L(r,A6(p,y),2):r.return([]);v=r.C;W=new Set;E=g.c(v);for(z=E.next();!z.done;z=E.next())if(f=z.value,n=f.id||f.key)Q=g.JK(n).entityId,W.add(Q);q=[];S=g.c(O);for(N=S.next();!N.done;N=S.next())P=N.value,u=P.offlineVideoData,R=void 0,((R=u)==null?0:R.videoId)&&!W.has(u.videoId)&&q.push(P);return r.return(q)})},p4I=function(p,y,O){return new g.yl(p,{cotn:y,
raw_player_response:O,download_media:!0,start:Infinity,disable_watch_next:!0})},y_F=function(){return{priority:1,
retryScheduleIntervalsInSeconds:[1,2,4]}},Js=function(p,y,O,v,W,E,z,f,n,Q,q){this.entityType=p;
this.actionId=y;this.action=O;this.parentActionId=v;this.rootActionId=W===void 0?y:W;this.childActionIds=E;this.prereqActionId=z;this.postreqActionIds=f;this.hasChildActionFailed=Q;this.retryScheduleIndex=0;this.C=q||Date.now();this.retryScheduleIndex=n||0},KI=function(p){if(!p.key)throw Error("Entity key is required.");
if(!p.actionProto)throw Error("OfflineOrchestrationAction is required.");var y=g.JK(p.key),O=g.JK(p.actionProto.entityKey);return new Js(O.entityType,y.entityId,p.actionProto,p.parentActionId,p.rootActionId,p.childActionIds,p.prereqActionId,p.postreqActionIds,p.retryScheduleIndex,p.hasChildActionFailed,Number(p.enqueueTimeSec)*1E3)},c7=function(p){return{key:g.Ky(p.actionId,"offlineOrchestrationActionWrapperEntity"),
actionProto:p.action,parentActionId:p.parentActionId,rootActionId:p.rootActionId,childActionIds:p.childActionIds,prereqActionId:p.prereqActionId,postreqActionIds:p.postreqActionIds,retryScheduleIndex:p.retryScheduleIndex,hasChildActionFailed:p.hasChildActionFailed,enqueueTimeSec:(p.C/1E3).toFixed()}},OTL=function(){var p;
return g.w(function(y){return y.T==1?g.L(y,Bn6(),2):(p=y.C)?y.return(p.delete("yt-player-local-img")):y.return(!0)})},R8=function(p){var y,O;
return g.w(function(v){if(v.T==1)return g.L(v,Bn6(),2);if(v.T!=3){y=v.C;if(!y)throw Error("Cache API not supported");return p.length?g.L(v,y.open("yt-player-local-img"),3):v.return()}O=v.C;return g.L(v,Promise.all(p.map(function(W){return O.delete(W)})),0)})},$r=function(p){var y,O;
return g.w(function(v){if(v.T==1)return g.L(v,Bn6(),2);if(v.T!=3){y=v.C;if(!y)throw Error("Cache API not supported");return p.length?g.L(v,y.open("yt-player-local-img"),3):v.return()}O=v.C;return g.L(v,O.addAll(p),0)})},sn=function(p,y,O,v,W){var E,z,f,n,Q,q,S,N,P,u,R,r,x,k,M,l,H,h,X,V,WR,O4,E4,b,PR,xx,U4,rF,GL,T0,ax;
return g.w(function(O_){switch(O_.T){case 1:return E=g.Ky(p,"mainVideoEntity"),z=g.Ky(p,"ytMainChannelEntity"),f=g.Ky(p,"transfer"),n=g.Ky(p,"videoDownloadContextEntity"),g.L(O_,Ci(y,{mode:"readonly",K_:!0},function(a){return g.YB.all([Iv(a,E,"mainVideoEntity"),Iv(a,z,"ytMainChannelEntity"),Iv(a,f,"transfer"),Iv(a,n,"videoDownloadContextEntity"),eO(a,"ytMainChannelEntity"),eO(a,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:Q=O_.C;q=g.c(Q);S=q.next().value;N=q.next().value;P=q.next().value;u=q.next().value;R=q.next().value;r=q.next().value;x=S;k=N;M=P;l=u;H=R;h=r;if(!x&&!k){O_.W2(3);break}X=x?uw(x.thumbnail):[];if(!k){V=[];O_.W2(4);break}return g.L(O_,vTX(k,H),5);case 5:V=O_.C;case 4:return WR=V,g.L(O_,R8(X.concat(WR)),3);case 3:O4=[];E4=g.Ky(p,"downloadStatusEntity");b=g.c(h);for(PR=b.next();!PR.done;PR=b.next())xx=PR.value,U4=g.JK(xx.key).entityId,rF=KI(xx),GL=g.JK(rF.action.entityKey).entityId,U4!==p&&GL!==
p||N6(O,xx.actionProto)||O4.push(xx.key);return g.L(O_,Ci(y,{mode:"readwrite",K_:!0},function(a){var G0=O4.map(function(U_){return jO(a,U_)});
G0.push(jO(a,E,{fS:!0}));G0.push(jO(a,E4,{fS:!0}));return g.YB.all(G0)}),7);
case 7:ax=(T0=l)==null?void 0:T0.offlineModeType,W&&(Gv(W),W.offlineModeType&&(ax=W.offlineModeType)),P7(M,ax),En(v,{entityKey:E,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.cR(O_)}})},ETU=function(p,y,O,v){var W,E,z,f,n,Q,q,S,N,P,u,R,r,x,k,M,l,H,h,X,V,WR,O4,E4,b,PR,xx,U4,rF,GL,T0,ax,O_,a,G0,U_,$C,tI,QU,HR,lY,Y6,t,Y,Z,m,e,s4,yM,JQ;
return g.w(function(vR){switch(vR.T){case 1:return W=g.Ky(p,"mainPlaylistEntity"),E=g.Ky(p,"ytMainChannelEntity"),g.L(vR,Ci(y,{mode:"readonly",K_:!0},function(Yx){return g.YB.all([Iv(Yx,W,"mainPlaylistEntity"),Iv(Yx,E,"ytMainChannelEntity"),eO(Yx,"mainPlaylistEntity"),eO(Yx,"mainDownloadsListEntity"),eO(Yx,"ytMainChannelEntity"),eO(Yx,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:z=vR.C;f=g.c(z);n=f.next().value;Q=f.next().value;q=f.next().value;S=f.next().value;N=f.next().value;P=f.next().value;u=n;R=Q;r=q;x=S;k=N;M=P;if(!u&&!R){vR.W2(3);break}l=u?W5K(u):[];if(!R){H=[];vR.W2(4);break}return g.L(vR,vTX(R,k),5);case 5:H=vR.C;case 4:return h=H,g.L(vR,R8(l.concat(h)),3);case 3:X=[];V=new Map;if(!u){vR.W2(7);break}return g.L(vR,gTY(u,r,x),8);case 8:X=vR.C;WR=g.c(X);for(O4=WR.next();!O4.done;O4=WR.next())E4=O4.value,V.set(E4,{videoId:E4,playlistId:p,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});
return g.L(vR,Ci(y,{mode:"readonly",K_:!0},function(Yx){return g.YB.all([eO(Yx,"transfer"),eO(Yx,"videoDownloadContextEntity")])}),9);
case 9:b=vR.C;PR=g.c(b);xx=PR.next().value;U4=PR.next().value;rF=xx;GL=U4;T0=g.c(rF);for(ax=T0.next();!ax.done;ax=T0.next())O_=ax.value,a=g.JK(O_.key).entityId,(G0=V.get(a))&&O_&&(G0.cotn=O_.cotn);U_=g.c(GL);for($C=U_.next();!$C.done;$C=U_.next())tI=$C.value,QU=g.JK(tI.key).entityId,(HR=V.get(QU))&&tI&&(HR.offlineModeType=tI.offlineModeType);case 7:lY=[];Y6=g.c(M);for(t=Y6.next();!t.done;t=Y6.next())Y=t.value,Z=g.JK(Y.key).entityId,m=KI(Y),Z!==p&&m.rootActionId!==p||N6(O,Y.actionProto)||lY.push(Y.key);
e=g.Ky(p,"mainPlaylistEntity");return g.L(vR,Ci(y,{mode:"readwrite",K_:!0},function(Yx){var CK=lY.map(function($6){return jO(Yx,$6)});
CK.push(jO(Yx,e,{fS:!0}));return g.YB.all(CK)}),10);
case 10:if(!u){vR.W2(0);break}X.reverse();if(!X){vR.W2(0);break}s4=g.c(X);yM=s4.next();case 13:if(yM.done){vR.W2(0);break}JQ=yM.value;return g.L(vR,sn(JQ,y,O,v,V.get(JQ)),14);case 14:yM=s4.next(),vR.W2(13)}})},GlA=function(p,y,O,v){var W,E,z,f,n,Q,q,S,N;
return g.w(function(P){if(P.T==1)return W=g.Ky("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),E=new Map,g.L(P,Ci(p,{mode:"readwrite",K_:!0},function(u){var R=eO(u,"transfer"),r=eO(u,"offlineOrchestrationActionWrapperEntity"),x=eO(u,"videoDownloadContextEntity"),k=Iv(u,W,"mainDownloadsListEntity");return g.YB.all([R,r,x,k]).then(function(M){M=g.c(M);var l=M.next().value;var H=M.next().value;var h=M.next().value;var X=M.next().value;M=zq_.map(function(WR){return O4Y(u,WR)});
H=g.c(H);for(var V=H.next();!V.done;V=H.next())V=V.value,N6(y,V.actionProto)||M.push(jO(u,V.key,{fS:!0}));X&&(X.downloads=[],M.push(UG(u,X,"mainDownloadsListEntity")));if(h)for(h=g.c(h),X=h.next();!X.done;X=h.next())X=X.value,H=g.JK(X.key).entityId,H=g.Ky(H,"transfer"),E.set(H,X.offlineModeType);return g.YB.all(M).then(function(){return l})})}),2);
z=P.C;f=g.c(z);for(n=f.next();!n.done;n=f.next())Q=n.value,P7(Q,E.get(Q.key)),q=g.JK(Q.key).entityId,S={videoId:q,offlineDeleteReason:v,cotn:Q.cotn,offlineModeType:E.get(Q.key)},Gv(S),N=g.Ky(q,"mainVideoEntity"),En(O,{entityKey:N,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.L(P,OTL(),0)})},W5K=function(p,y){var O=[];
if(p.thumbnailStyleData){p=g.c(p.thumbnailStyleData);for(var v=p.next();!v.done;v=p.next()){var W=void 0,E=void 0,z=void 0;O=O.concat(uw((W=v.value)==null?void 0:(E=W.value)==null?void 0:(z=E.collageThumbnail)==null?void 0:z.coverThumbnail))}}y=uw(y);return O.concat(y)},gTY=function(p,y,O){var v,W,E,z,f,n,Q,q,S,N,P,u,R,r,x,k,M,l,H,h,X,V,WR;
return g.w(function(O4){v=[];W=new Set;if(O.length)for(E=g.c(O),z=E.next();!z.done;z=E.next())if(f=z.value,n=void 0,(n=f.downloads)==null?0:n.length)for(Q=g.c(f.downloads),q=Q.next();!q.done;q=Q.next())S=q.value,S.videoItem&&(N=g.JK(S.videoItem).entityId,W.add(N));if(p.videos){P=g.c(p.videos);for(u=P.next();!u.done;u=P.next())R=u.value,r=JSON.parse(g.JK(R).entityId),r.videoId&&!W.has(r.videoId)&&v.push(r.videoId);x=g.c(y);for(k=x.next();!k.done;k=x.next())if(M=k.value,M.key!==p.key&&(l=M.videos))for(H=
g.c(l),h=H.next();!h.done;h=H.next())X=h.value,V=JSON.parse(g.JK(X).entityId),V.videoId&&(WR=v.indexOf(V.videoId),WR!==-1&&v.splice(WR,1))}return O4.return(v)})},vTX=function(p,y){var O,v,W,E,z,f,n,Q;
return g.w(function(q){O=uw(p.avatar);v=g.c(y);for(W=v.next();!W.done;W=v.next())if(E=W.value,E.id!==p.id)for(z=g.c(uw(E.avatar)),f=z.next();!f.done;f=z.next())n=f.value,Q=O.indexOf(n),Q!==-1&&O.splice(Q,1);return q.return(O)})},oTU=function(p){var y;
return g.w(function(O){y=g.F(p.frameworkUpdates,rH);return p.frameworkUpdates&&y?g.L(O,NnI(y),0):O.return()})},nT_=function(p){var y;
if((y=p.onResponseReceivedActions)!=null&&y.length){var O;p=(O=g.F(g.F(p.onResponseReceivedActions[0],f$F),g.KpI))==null?void 0:O.actions;if(p!=null&&p.length)return p}},Q4F=function(p){var y,O,v;
return g.w(function(W){if(W.T==1)return p?g.L(W,V6(p,g.mY,"mainDownloadsListEntity"),2):W.return([]);y=W.C;return((O=y)==null?0:(v=O.downloads)==null?0:v.length)?W.return(y.downloads.map(function(E){var z;return(z=E.videoItem)!=null?z:""})):W.return([])})},S2L=function(p,y){var O;
return g.w(function(v){return v.T==1?g.L(v,q2Y(p,y),2):(O=v.C)?g.L(v,Ci(p,{mode:"readwrite",K_:!0},function(W){var E=[UG(W,O.mainDownloadsLibraryEntity,"mainDownloadsLibraryEntity")];O.mainDownloadsListEntity&&E.push(UG(W,O.mainDownloadsListEntity,"mainDownloadsListEntity"));return g.YB.all(E)}),0):v.W2(0)})},q2Y=function(p,y){var O,v,W,E,z,f,n,Q,q,S,N,P,u,R,r,x,k,M;
return g.w(function(l){if(l.T==1)return O=g.Ky("main_downloads_library_id","mainDownloadsLibraryEntity"),v=g.Ky("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.L(l,Ci(p,{mode:"readonly",K_:!0},function(H){return g.YB.all([Iv(H,O,"mainDownloadsLibraryEntity"),Iv(H,v,"mainDownloadsListEntity")])}),2);
W=l.C;E=g.c(W);z=E.next().value;f=E.next().value;n=z;Q=f;n||(n={id:O});q=g.c(y);for(S=q.next();!S.done;S=q.next())if(N=S.value,N===g.mY){if(n.smartDownloadsList)return l.return();n.smartDownloadsList=N}else if(P=g.JK(N).entityType,u={},P==="mainPlaylistEntity"?u.playlistItem=N:P==="mainVideoEntity"&&(u.videoItem=N),!g.DK(u)){R=void 0;if((R=Q)==null?0:R.downloads){r=!1;x=g.c(Q.downloads);for(k=x.next();!k.done;k=x.next())if(M=k.value,M.playlistItem===N||M.videoItem===N){r=!0;break}r||Q.downloads.push(u)}else Q=
{id:v,downloads:[u]};n.downloadsList=v}return l.return({mainDownloadsLibraryEntity:n,mainDownloadsListEntity:Q})})},NxY=function(p,y){var O,v,W,E,z,f,n,Q,q,S,N,P,u,R,r;
return g.w(function(x){if(x.T==1)return O=g.Ky("main_downloads_library_id","mainDownloadsLibraryEntity"),v=g.Ky("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.L(x,Ci(p,{mode:"readonly",K_:!0},function(k){return g.YB.all([Iv(k,O,"mainDownloadsLibraryEntity"),Iv(k,v,"mainDownloadsListEntity"),Iv(k,g.mY,"mainDownloadsListEntity")])}),2);
W=x.C;E=g.c(W);z=E.next().value;f=E.next().value;n=E.next().value;Q=z;q=f;S=n;if(!Q)return x.W2(0);if(y===g.mY&&((N=S)==null?0:N.downloads))S.downloads=[];else if((P=q)==null?0:P.downloads)for(u=g.JK(y).entityType,R=0;R<q.downloads.length;R++)if(r=q.downloads[R],u==="mainVideoEntity"&&r.videoItem===y){q.downloads.splice(R,1);break}else if(u==="mainPlaylistEntity"&&r.playlistItem===y){q.downloads.splice(R,1);break}return g.L(x,Ci(p,{mode:"readwrite",K_:!0},function(k){var M=[UG(k,Q,"mainDownloadsLibraryEntity")];
q&&M.push(UG(k,q,"mainDownloadsListEntity"));S&&M.push(UG(k,S,"mainDownloadsListEntity"));return g.YB.all(M)}),0)})},a8=function(p,y){var O,v,W,E,z,f,n,Q,q,S,N;
return g.w(function(P){if(P.T==1)return O=g.Ky(y,"transfer"),v=g.Ky(y,"videoDownloadContextEntity"),g.L(P,Ci(p,{mode:"readonly",K_:!0},function(u){return g.YB.all([Iv(u,O,"transfer"),Iv(u,v,"videoDownloadContextEntity")])}),2);
W=P.C;E=g.c(W);z=E.next().value;f=E.next().value;n=z;Q=f;N={videoId:y,cotn:(q=n)==null?void 0:q.cotn,offlineModeType:(S=Q)==null?void 0:S.offlineModeType};return P.return(N)})},kr=function(p,y,O,v,W){var E,z,f,n,Q,q,S,N,P,u,R,r,x,k,M,l,H,h,X,V;
return g.w(function(WR){switch(WR.T){case 1:return E=g.Ky(p,"musicTrack"),z=g.Ky(p,"transfer"),g.L(WR,Ci(y,{mode:"readonly",K_:!0},function(O4){return g.YB.all([Iv(O4,E,"musicTrack"),Iv(O4,z,"transfer"),eO(O4,"musicTrack"),eO(O4,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:f=WR.C;n=g.c(f);Q=n.next().value;q=n.next().value;S=n.next().value;N=n.next().value;P=Q;u=q;R=S;r=N;if(!P){WR.W2(3);break}return g.L(WR,P4e(P,R),4);case 4:return x=WR.C,g.L(WR,R8(x),3);case 3:k=[];M=g.c(r);for(l=M.next();!l.done;l=M.next())H=l.value,h=g.JK(H.key).entityId,X=KI(H),V=g.JK(X.action.entityKey).entityId,h!==p&&V!==p||N6(O,H.actionProto)||k.push(H.key);return g.L(WR,Ci(y,{mode:"readwrite",K_:!0},function(O4){var E4=k.map(function(b){return jO(O4,b)});
E4.push(jO(O4,E,{fS:!0}));return g.YB.all(E4)}),6);
case 6:P7(u),W&&Gv(W),En(v,{entityKey:E,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.cR(WR)}})},xr=function(p,y,O,v,W){var E,z,f,n,Q,q,S,N,P,u,R,r,x,k,M,l,H,h,X,V,WR,O4,E4,b,PR,xx,U4,rF,GL,T0,ax,O_,a,G0,U_,$C;
return g.w(function(tI){switch(tI.T){case 1:return E=g.Ky(p,y),z=g.Ky("music_downloads_library_id","musicDownloadsLibraryEntity"),g.L(tI,Ci(O,{mode:"readonly",K_:!0},function(QU){return g.YB.all([Iv(QU,E,y),Iv(QU,z,"musicDownloadsLibraryEntity"),eO(QU,y),eO(QU,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:f=tI.C;n=g.c(f);Q=n.next().value;q=n.next().value;S=n.next().value;N=n.next().value;P=Q;u=q;R=S;r=N;if(!P){tI.W2(3);break}return g.L(tI,P4e(P,R),4);case 4:return x=tI.C,g.L(tI,R8(x),3);case 3:k=[];M=new Map;if(!P){tI.W2(6);break}return g.L(tI,uTI(P,R,u),7);case 7:k=tI.C;l=g.c(k);for(H=l.next();!H.done;H=l.next())h=H.value,X=g.JK(h).entityId,M.set(X,{videoId:X,playlistId:p,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});return g.L(tI,A6(O,"transfer"),8);case 8:for(V=tI.C,WR=
g.c(V),O4=WR.next();!O4.done;O4=WR.next())E4=O4.value,b=g.JK(E4.key).entityId,(PR=M.get(b))&&E4&&(PR.cotn=E4.cotn);case 6:xx=[];U4=g.c(r);for(rF=U4.next();!rF.done;rF=U4.next())GL=rF.value,T0=g.JK(GL.key).entityId,ax=KI(GL),T0!==p&&ax.rootActionId!==p||N6(v,GL.actionProto)||xx.push(GL.key);O_=g.Ky(p,y);return g.L(tI,Ci(O,{mode:"readwrite",K_:!0},function(QU){var HR=xx.map(function(lY){return jO(QU,lY)});
HR.push(jO(QU,O_,{fS:!0}));return g.YB.all(HR)}),9);
case 9:if(!P){tI.W2(0);break}k.reverse();if(!k.length){tI.W2(0);break}a=g.c(k);G0=a.next();case 12:if(G0.done){tI.W2(0);break}U_=G0.value;$C=g.JK(U_).entityId;if(!$C){tI.W2(13);break}return g.L(tI,kr($C,O,v,W,M.get($C)),13);case 13:G0=a.next(),tI.W2(12)}})},Tv=function(p,y,O){var v,W,E,z,f,n,Q;
return g.w(function(q){if(q.T==1)return g.L(q,Ci(p,{mode:"readwrite",K_:!0},function(S){var N=eO(S,"transfer"),P=eO(S,"offlineOrchestrationActionWrapperEntity");return g.YB.all([N,P]).then(function(u){u=g.c(u);var R=u.next().value;var r=u.next().value;u=J_6.map(function(l){return O4Y(S,l)});
r=g.c(r);for(var x=r.next();!x.done;x=r.next()){x=x.value;var k=g.JK(x.actionProto.entityKey).entityType==="musicTrack",M=x.actionProto.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD";N6(y,x.actionProto)||k&&(!k||M)||u.push(jO(S,x.key,{fS:!0}))}return g.YB.all(u).then(function(){return R})})}),2);
v=q.C;W=g.c(v);for(E=W.next();!E.done;E=W.next())z=E.value,P7(z),f=g.JK(z.key).entityId,n={videoId:f,offlineDeleteReason:void 0,cotn:z.cotn},Gv(n),Q=g.Ky(f,"musicTrack"),En(O,{entityKey:Q,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.L(q,OTL(),0)})},K5F=function(p){for(var y,O=g.c(p.additionalMetadatas),v=O.next();!v.done;v=O.next())v=v.value,v.offlineMusicVideoData&&(y=v.offlineMusicVideoData);
var W,E,z,f,n;return{id:g.Ky(p.videoId,"musicTrack"),videoId:p.videoId,title:p.title,thumbnailDetails:p.thumbnail,lengthMs:String(Number(p.lengthSeconds)*1E3),albumTitle:(W=y)==null?void 0:W.releaseTitle,musicVideoType:(E=y)==null?void 0:E.musicVideoType,contentRating:{explicitType:(z=y)==null?void 0:z.explicitType},artistNames:((f=y)==null?void 0:f.byline)||((n=y)==null?void 0:n.channelName),downloadMetadata:g.Ky(p.videoId,"musicTrackDownloadMetadataEntity")}},uTI=function(p,y,O){var v,W,E,z,f,n,
Q,q,S,N,P,u,R,r,x,k,M,l;
return g.w(function(H){v=[];W=new Set;if((E=O)==null?0:(z=E.downloadedTracks)==null?0:z.length)for(f=g.c(O.downloadedTracks),n=f.next();!n.done;n=f.next())Q=n.value,W.add(Q);if(p.tracks){q=g.c(p.tracks);for(S=q.next();!S.done;S=q.next())N=S.value,W.has(N)||v.push(N);P=g.c(y);for(u=P.next();!u.done;u=P.next())if(R=u.value,R.id!==p.id&&(r=R.tracks))for(x=g.c(r),k=x.next();!k.done;k=x.next())M=k.value,l=v.indexOf(M),l!==-1&&v.splice(l,1)}return H.return(v)})},P4e=function(p,y){var O,v,W,E,z,f,n,Q;
return g.w(function(q){O=uw(p.thumbnailDetails);v=g.c(y);for(W=v.next();!W.done;W=v.next())if(E=W.value,E.id!==p.id)for(z=g.c(uw(E.thumbnailDetails)),f=z.next();!f.done;f=z.next())n=f.value,Q=O.indexOf(n),Q!==-1&&O.splice(Q,1);return q.return(O)})},c_X=function(p,y){var O,v,W,E,z,f,n,Q,q;
return g.w(function(S){if(S.T==1)return O=g.Ky("music_downloads_library_id","musicDownloadsLibraryEntity"),g.L(S,V6(p,O,"musicDownloadsLibraryEntity"),2);(v=S.C)||(v={id:O});W=g.JK(y).entityType;W==="musicTrack"?(E=v.downloadedTracks)!=null&&E.includes(y)||(v.downloadedTracks=((z=v.downloadedTracks)!=null?z:[]).concat(y)):W==="musicPlaylist"?(f=v.downloadedPlaylists)!=null&&f.includes(y)||(v.downloadedPlaylists=((n=v.downloadedPlaylists)!=null?n:[]).concat(y)):W!=="musicAlbumRelease"||(Q=v.downloadedAlbumReleases)!=
null&&Q.includes(y)||(v.downloadedAlbumReleases=((q=v.downloadedAlbumReleases)!=null?q:[]).concat(y));return g.L(S,Dp(p,v,"musicDownloadsLibraryEntity"),0)})},Rq6=function(p,y){var O,v,W,E,z,f,n;
return g.w(function(Q){if(Q.T==1)return O=g.Ky("music_downloads_library_id","musicDownloadsLibraryEntity"),g.L(Q,V6(p,O,"musicDownloadsLibraryEntity"),2);v=Q.C;if(!v)return Q.W2(0);W=g.JK(y).entityType;W==="musicTrack"?E=v.downloadedTracks:W==="musicPlaylist"&&(E=v.downloadedPlaylists);if((z=E)==null?0:z.length)for(f=0;f<E.length;f++)if(n=E[f],n===y){E.splice(f,1);break}return g.L(Q,Dp(p,v,"musicDownloadsLibraryEntity"),0)})},$yh=function(p){var y=p.videos;
p=[];var O=[];if(y){y=g.c(y);for(var v=y.next();!v.done;v=y.next()){var W=v.value.offlineVideoData.videoId;v=g.Ky(W,"musicTrack");W=g.Ky(W,"musicTrackDownloadMetadataEntity");p.push(v);O.push(W)}}return{TI:p,Po:O}},ts=function(p,y,O){y={track:K5F(y)};
O&&(y.playlistId=O);if(p=g.F(p.actionMetadata,s4A))y.maximumDownloadQuality=p.maximumDownloadQuality;return{musicTrackEntityActionMetadata:y}},a$$=function(p){var y,O,v,W,E,z,f,n;
return g.w(function(Q){switch(Q.T){case 1:return y=g.Np(),O=sIe(p),v=g.R2(r_U),g.Rx(Q,2),E={a$:!0},g.L(Q,g.WA(y,O,v,void 0,E),4);case 4:W=Q.C;g.rQ(Q,3);break;case 2:z=g.kx(Q);if(z instanceof g.Qv)throw f="GetOffline network manager error: "+z.message,W7(f,z),Error(f);W7("GetOffline fetch request error",z);throw Error("GetOffline fetch request error");case 3:n=Yr(W);if(!W)throw W7("Network request failed"),Error("Network request failed");if(n!==void 0)M6(n);else if(!W.videos||!W.videos.length)throw W7("No data"),
Error("No data");return Q.return(W.videos.map(function(q){return q.offlineVideoData}))}})},klL=function(p){var y,O,v,W,E,z,f,n;
return g.w(function(Q){switch(Q.T){case 1:return y=g.Np(),O=rAL(p),v=g.R2(r_U),g.Rx(Q,2),E={a$:!0},g.L(Q,g.WA(y,O,v,void 0,E),4);case 4:W=Q.C;g.rQ(Q,3);break;case 2:z=g.kx(Q);if(z instanceof g.Qv)throw f="GetOffline network manager error for playlist: "+z.message,W7(f,z),Error(f);W7("GetOffline fetch request error for playlist",z);throw Error("GetOffline fetch request error for playlist");case 3:n=Yr(W);if(!W)throw W7("Network request failed for playlist"),Error("Network request failed for playlist");
if(n!==void 0)M6(n,"playlist");else if(!W.playlists||!W.playlists.length)throw W7("No data for playlist"),Error("No data for playlist");return Q.return(W.playlists.map(function(q){return q.offlinePlaylistData}))}})},TxA=function(p,y,O,v){var W,E,z,f,n,Q,q,S,N,P,u,R,r,x,k,M,l,H,h,X,V,WR,O4,E4,b,PR,xx,U4,rF,GL;
return g.w(function(T0){switch(T0.T){case 1:return g.L(T0,pI(),2);case 2:W=T0.C;if(!W)return T0.return([]);E=[];if((z=v)==null?0:z.length){E=v;T0.W2(3);break}return g.L(T0,A6(W,"mainPlaylistEntity"),4);case 4:E=T0.C;case 3:if(!E.length)return T0.return([]);f=[];n=Date.now()/1E3;Q=g.c(E);q=Q.next();case 5:if(q.done)return f.length?g.L(T0,xyY(f),10):T0.return([]);S=q.value;if(!S.downloadState){N=void 0;T0.W2(8);break}return g.L(T0,V6(W,S.downloadState,"mainPlaylistDownloadStateEntity"),9);case 9:N=
T0.C;case 8:P=N;u=void 0;r=(R=(u=S)==null?void 0:u.entityMetadata)&&R.nextAutoRefreshIntervalSeconds?Number(R.nextAutoRefreshIntervalSeconds):NaN;x=Number.isNaN(r)?p:r;M=k=void 0;l=((k=P)==null?0:k.lastSyncedTimestampMillis)?Number((M=P)==null?void 0:M.lastSyncedTimestampMillis)/1E3:0;h=H=void 0;X=((H=P)==null?0:H.addedTimestampMillis)?Number((h=P)==null?void 0:h.addedTimestampMillis)/1E3:0;if(O||!R||l+x<=n){V=[];WR=void 0;if((WR=S.videos)==null?0:WR.length)for(O4=g.c(S.videos),E4=O4.next();!E4.done;E4=
O4.next())b=E4.value,PR=JSON.parse(g.JK(b).entityId),PR.videoId&&V.push(PR.videoId);xx="0";R&&(U4=void 0,xx=String(Number((U4=R.offlineLastModifiedTimestampSeconds)!=null?U4:0).toFixed()));rF={playlistId:S.playlistId,videoIds:V,offlineLastModifiedTimestamp:xx,autoSync:y,offlineDateAddedTimestamp:String(X.toFixed())};f.push(rF)}q=Q.next();T0.W2(5);break;case 10:return GL=T0.C,T0.return(GL)}})},teX=function(){var p,y,O,v,W;
return g.w(function(E){if(E.T==1)return g.L(E,pI(),2);if(E.T!=3)return(p=E.C)?g.L(E,A6(p,"refresh"),3):E.return(!1);y=E.C;if((O=y[0])==null||!O.refreshTime)return E.return(!1);v=Number(y[0].refreshTime);W=Date.now()/1E3;return E.return(isFinite(v)&&W>=v)})},MeF=function(p,y){var O,v,W;
return g.w(function(E){switch(E.T){case 1:return g.Rx(E,2),g.L(E,Y2h(p,y),4);case 4:return v=E.C,g.L(E,oTU(v),5);case 5:O=nT_(v);g.rQ(E,3);break;case 2:W=g.kx(E),W7("getAndProcessSmartDownloadsResponse request or processing error",W);case 3:return E.return(O)}})},ZTF=function(p,y,O,v){var W,E,z,f,n,Q,q,S,N,P,u,R,r,x,k,M,l,H,h,X,V,WR,O4,E4,b,PR,xx,U4,rF,GL;
return g.w(function(T0){switch(T0.T){case 1:return g.L(T0,pI(),2);case 2:W=T0.C;if(!W)return T0.return([]);E=[];if((z=v)==null?0:z.length){E=v;T0.W2(3);break}return g.L(T0,A6(W,"musicPlaylist"),4);case 4:E=T0.C;case 3:if(!E.length)return T0.return([]);f=[];n=Date.now()/1E3;Q=g.c(E);q=Q.next();case 5:if(q.done)return f.length?g.L(T0,xyY(f),10):T0.return([]);S=q.value;N=void 0;u=(P=(N=S)==null?void 0:N.entityMetadata)&&P.nextAutoRefreshIntervalSeconds?Number(P.nextAutoRefreshIntervalSeconds):NaN;R=
Number.isNaN(u)?p:u;x=r=0;k="DOWNLOAD_SYNC_STATE_UNKNOWN";if(!S.downloadMetadata){T0.W2(8);break}return g.L(T0,V6(W,S.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),9);case 9:M=T0.C,H=l=void 0,r=Number((H=(l=M)==null?void 0:l.addedTimestampMillis)!=null?H:"0")/1E3,X=h=void 0,x=Number((X=(h=M)==null?void 0:h.lastModifiedTimestampMillis)!=null?X:"0")/1E3,WR=V=void 0,k=(WR=(V=M)==null?void 0:V.syncState)!=null?WR:"DOWNLOAD_SYNC_STATE_UNKNOWN";case 8:O4=void 0;if(O||k!=="DOWNLOAD_SYNC_STATE_UP_TO_DATE"||
!P||Number((O4=P.lastSyncedTimestampSeconds)!=null?O4:0)+R<=n){E4=[];b=void 0;if((b=S.tracks)==null?0:b.length)for(PR=g.c(S.tracks),xx=PR.next();!xx.done;xx=PR.next())U4=xx.value,E4.push(g.JK(U4).entityId);rF={playlistId:S.playlistId,videoIds:E4,offlineLastModifiedTimestamp:String(x.toFixed()),autoSync:y,offlineDateAddedTimestamp:String(r.toFixed())};f.push(rF)}q=Q.next();T0.W2(5);break;case 10:return GL=T0.C,T0.return(GL)}})},Y2h=function(p,y){var O,v,W,E,z,f,n,Q,q,S;
return g.w(function(N){switch(N.T){case 1:return O=g.Np(),g.L(N,pI(),2);case 2:v=N.C;if(!v){N.W2(3);break}return g.L(N,MuY(v),4);case 4:W=N.C;case 3:var P=W;E={context:g.Jx(),browseId:"FEdownloads",browseRequestSupportedMetadata:{downloadsBrowseParams:{offlineFeatureSettingState:{isSdEnabled:p},offlineClientState:P,clientStateRequestData:{preferredFormatType:y}}}};z=g.R2(L5h);g.Rx(N,5);n={a$:!0};return g.L(N,g.WA(O,E,z,void 0,n),7);case 7:f=N.C;g.rQ(N,6);break;case 5:Q=g.kx(N);if(Q instanceof g.Qv)throw q=
"DPS network manager error for smart downloads: "+Q.message,W7(q,Q),Error(q);W7("DPS fetch request error for smart downloads",Q);throw Error("DPS fetch request error for smart downloads");case 6:S=Yr(f);if(f)S!==void 0&&M6(S,"smart downloads");else throw W7("Network request failed for smart downloads"),Error("Network request failed for smart downloads");return N.return(f)}})},w4F=function(p,y){var O,v,W,E,z,f,n,Q;
return g.w(function(q){switch(q.T){case 1:return O=g.Np(),v={context:g.Jx(),videoPlaybackPositionEntities:p,lastSyncTimestampUsec:y},W=g.R2(l$F),g.Rx(q,2),z={a$:!0},g.L(q,g.WA(O,v,W,void 0,z),4);case 4:E=q.C;g.rQ(q,3);break;case 2:f=g.kx(q);if(f instanceof g.Qv)throw n="VPPS network manager error: "+f.message,W7(n,f),Error(n);W7("VPPS fetch request error",f);throw Error("VPPS fetch request error");case 3:Q=Yr(E);if(E)Q!==void 0&&M6(Q,"position sync");else throw W7("Network request failed for position sync"),
Error("Network request failed for position sync");return q.return(E)}})},dy$=function(p,y,O){var v,W,E,z,f,n,Q,q;
return g.w(function(S){switch(S.T){case 1:v=g.Np();var N=O.refreshData,P=O.isEnqueuedForExpiredStreamUrlRefetch,u=O.ya,R=O.offlineSourceData,r=O.mediaCapabilities,x={entityKey:p};N&&(x.refreshData=N);P&&(x.isExpiredStreamUrlRefetch=P);u&&(x.downloadParameters=u);R&&(x.offlineSourceData=R);N={context:g.qt(y),signatureTimestamp:20243,videos:[x]};r&&(N.mediaCapabilities=r);W=N;E=g.R2(mye);g.Rx(S,2);f={a$:!0};return g.L(S,g.WA(v,W,E,void 0,f),4);case 4:z=S.C;g.rQ(S,3);break;case 2:n=g.kx(S);if(n instanceof
g.Qv)throw Q="GetPDE network manager error: "+n.message,W7(Q,n),Error(Q);W7("GetPDE fetch request error",n);throw Error("GetPDE fetch request error");case 3:q=Yr(z);if(z)q!==void 0&&M6(q,"PDE");else throw W7("Network request failed for PDE"),Error("Network request failed for PDE");return S.return(z)}})},Yr=function(p){var y;
return(y=p.errorMetadata)==null?void 0:y.status},M6=function(p,y){y=y?" for "+y:"";
if(p===0)throw p="Empty response body"+y,W7(p),Error(p);p="Response with error"+y;W7(p);throw Error(p);},xyY=function(p){var y,O,v,W,E,z,f,n;
return g.w(function(Q){switch(Q.T){case 1:return y=g.Np(),O=abh(p),v=g.R2(BxF),g.Rx(Q,2),E={a$:!0},g.L(Q,g.WA(y,O,v,void 0,E),4);case 4:W=Q.C;g.rQ(Q,3);break;case 2:z=g.kx(Q);if(z instanceof g.Qv)throw f="offlinePlaylistSyncCheck network manager error: "+z.message,W7(f,z),Error(f);W7("offlinePlaylistSyncCheck fetch request error",z);throw Error("offlinePlaylistSyncCheck fetch request error");case 3:n=Yr(W);if(!W)throw W7("Network request failed for playlist sync"),Error("Network request failed for playlist sync");
if(n!==void 0)M6(n,"playlist sync");else if(!W.offlinePlaylistSyncCheckDatas||!W.offlinePlaylistSyncCheckDatas.length)throw W7("No data for playlist sync"),Error("No data for playlist sync");return Q.return(W.offlinePlaylistSyncCheckDatas.map(function(q){return q.offlinePlaylistSyncCheckData}))}})},ZV=function(p){this.C=p},HTX=function(p,y){var O,v,W,E,z,f;
return g.w(function(n){switch(n.T){case 1:O=new Map,v=g.c(y),W=v.next();case 2:if(W.done){n.W2(4);break}E=W.value;z=O;f=z.set;return g.L(n,p.T(E),5);case 5:f.call(z,E,n.C);W=v.next();n.W2(2);break;case 4:return n.return(O)}})},LI=function(p,y,O,v,W,E){y=g.Ky(y,O);
v=Object.assign({},E,{priority:v,retryScheduleIntervalsInSeconds:W});return{actionType:p,entityKey:y,actionMetadata:v}},lw=function(p,y,O,v,W,E){this.status=p;
this.C=y;this.B=O;this.T=v;this.J=W;this.downloadState=E},iTY=function(p,y,O){this.C=p;
this.I_=y;this.J=O},eqK=function(p,y){var O,v,W,E,z,f,n,Q,q;
return g.w(function(S){switch(S.T){case 1:return O=y.entityKey,W=(v=g.F(y.actionMetadata,wH))==null?void 0:v.isEnqueuedForExpiredStreamUrlRefetch,g.Rx(S,2),E=void 0,g.L(S,F5I(p,y),4);case 4:E=S.C;g.Rx(S,5);var N=(N=g.F(y.actionMetadata,wH))?{maximumDownloadQuality:N.maximumDownloadQuality}:void 0;return g.L(S,dy$(O,p.I_,{isEnqueuedForExpiredStreamUrlRefetch:W,ya:N,offlineSourceData:E}),7);case 7:z=S.C;g.rQ(S,6,2);break;case 5:return g.kx(S,2),f=fI(y)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":
"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",W7("PDE handleAdd error"),S.return(m$(y,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",f,"DOWNLOAD_STATE_FAILED"));case 6:return g.L(S,I$_(p,z,y),8);case 8:return S.return(m$(y,!0,z.orchestrationActions));case 2:return n=g.kx(S),Q="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",q="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",n instanceof g.sN&&n.type==="QUOTA_EXCEEDED"&&(Q="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
q="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),W7("PDE handleAdd error"),S.return(m$(y,!1,void 0,Q,q,"DOWNLOAD_STATE_FAILED"))}})},j4X=function(p,y){var O,v,W,E,z,f,n,Q,q,S,N,P,u,R,r,x,k,M,l,H,h,X,V,WR;
return g.w(function(O4){switch(O4.T){case 1:return O=y.entityKey,v=g.JK(O).entityId,g.L(O4,Ci(p.C,{mode:"readonly",K_:!0},function(E4){var b=Iv(E4,O,"playbackData"),PR=Iv(E4,g.Ky(v,"offlineVideoPolicy"),"offlineVideoPolicy");E4=Iv(E4,g.Ky(v,"transfer"),"transfer");return g.YB.all([b,PR,E4])}),2);
case 2:W=O4.C;E=g.c(W);z=E.next().value;f=E.next().value;n=E.next().value;Q=z;q=f;S=n;if(!Q||!q)return O4.return(m$(y,!0));N=[];R=((u=Q)==null?0:u.playerResponseJson)?JSON.parse(Q.playerResponseJson):null;if(!(S&&R&&p.I_.K("html5_refresh_deprecated_downloads"))){O4.W2(3);break}P=X4X(p,R,S);return g.L(O4,UyL(p,S),4);case 4:N=O4.C;case 3:r={lastPlayerResponseTimestampSeconds:Q.playerResponseTimestamp,offlineToken:q.offlineToken,formatIds:N};x={};if((k=S)==null?0:k.maximumDownloadQuality)x.maximumDownloadQuality=
S.maximumDownloadQuality;g.Rx(O4,5);M=void 0;return g.L(O4,F5I(p,y),7);case 7:return M=O4.C,g.Rx(O4,8),g.L(O4,dy$(O,p.I_,{refreshData:r,ya:x,offlineSourceData:M,mediaCapabilities:P}),10);case 10:l=O4.C;g.rQ(O4,9,5);break;case 8:return g.kx(O4,5),H=fI(y)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",W7("PDE handleRefresh error"),O4.return(m$(y,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",H,
"DOWNLOAD_STATE_FAILED"));case 9:return g.L(O4,I$_(p,l,y),11);case 11:return O4.return(m$(y,!0,l.orchestrationActions));case 5:return h=g.kx(O4),X="PDE handleRefresh error",h instanceof Error&&(X="PDE handleRefresh error: "+h.message),V="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",WR="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",h instanceof g.sN&&h.type==="QUOTA_EXCEEDED"&&(V="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",WR="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
W7(X),O4.return(m$(y,!1,void 0,V,WR,"DOWNLOAD_STATE_FAILED"))}})},F5I=function(p,y){var O,v,W,E;
return g.w(function(z){if(z.T==1)return O=g.JK(y.entityKey).entityId,v=g.Ky(O,"videoDownloadContextEntity"),g.L(z,V6(p.C,v,"videoDownloadContextEntity"),2);W=z.C;return(E=W)!=null&&E.offlineModeType?z.return({offlineModeType:W.offlineModeType}):z.return(void 0)})},I$_=function(p,y,O){var v,W,E,z,f;
return g.w(function(n){if(n.T==1){if(!y.frameworkUpdates||!g.F(y.frameworkUpdates,rH))return n.return();if(!(g.F(y.frameworkUpdates,rH).mutations&&g.F(y.frameworkUpdates,rH).mutations.length>0&&g.F(y.frameworkUpdates,rH).mutations[0].type==="ENTITY_MUTATION_TYPE_DELETE"))return n.W2(2);v=g.JK(g.F(y.frameworkUpdates,rH).mutations[0].entityKey).entityId;return g.L(n,a8(p.C,v),3)}if(n.T!=2){W=n.C;E=g.F(O.actionMetadata,wH);if(f=(z=E)==null?void 0:z.playlistId)W.playlistId=f;W.offlineDeleteReason="OFFLINE_DELETE_REASON_UNKNOWN";
return g.zd(p.I_)?g.L(n,sn(v,p.C,O,p.J,W),2):g.hX(p.I_)?g.L(n,kr(v,p.C,O,p.J),2):n.W2(2)}return g.L(n,NnI(g.F(y.frameworkUpdates,rH)),0)})},m$=function(p,y,O,v,W,E){return new lw(y?"OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS":"OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",fI(p),O,v,W,E)},X4X=function(p,y,O){y=p4I(p.I_,O.cotn,y);
O=g.Jo(y);return g.AvM(y,O,p.I_)},UyL=function(p,y){var O,v,W,E,z,f,n,Q,q,S,N;
return g.w(function(P){if(P.T==1)return O=[],g.L(P,Ci(p.C,{mode:"readonly",K_:!0},function(u){var R=[],r=y.offlineVideoStreams;if(r){r=g.c(r);for(var x=r.next();!x.done;x=r.next())R.push(Iv(u,x.value,"offlineVideoStreams"))}return g.YB.all(R)}),2);
if(v=P.C)for(W=g.c(v),E=W.next();!E.done;E=W.next())if(z=E.value,f=void 0,(f=z)==null?0:f.streamsProgress)for(n=z.streamsProgress,Q=0;Q<n.length;Q++)q=n[Q],S=JSON.parse(q.formatStreamBytes),N={itag:S.itag,lmt:S.lastModified,xtags:S.xtags},O.push(N);return P.return(O)})},hqS=function(p,y){this.C=p;
this.I_=y},bT_=function(p,y){var O,v,W,E,z,f,n,Q,q,S,N,P;
return g.w(function(u){switch(u.T){case 1:return O=fI(y),g.L(u,A6(p.C,"videoPlaybackPositionEntity"),2);case 2:v=u.C;if(v.length===0)return u.return(new lw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",O));g.Rx(u,3);return g.L(u,Ha.getInstance(),5);case 5:W=u.C;if(!W)throw Error("prefStorage is undefined");return g.L(u,W.get("psi"),6);case 6:return E=u.C,n=(f=(z=E)==null?void 0:z.tB)!=null?f:"0",g.L(u,w4F(v,n),7);case 7:return Q=u.C,q={isPaused:Q.watchHistoryPaused,tB:Q.syncTimestampUsec},g.L(u,W.set("psi",
q),8);case 8:if(q.isPaused){u.W2(9);break}S=g.F(Q.frameworkUpdates,rH);if(!Q.frameworkUpdates||!S){u.W2(9);break}return g.L(u,NnI(S),9);case 9:g.rQ(u,4);break;case 3:return N=g.kx(u),P="PPE handleRefresh error: "+(N instanceof Error?N.message:"unknown error"),W7(P),u.return(new lw("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",O,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return u.return(new lw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
O))}})},DyI=function(p,y){var O,v,W,E,z,f,n,Q;
return g.w(function(q){switch(q.T){case 1:return O=fI(y),v=g.JK(y.entityKey).entityId,g.Rx(q,2),g.L(q,Ha.getInstance(),4);case 4:W=q.C;if(!W)throw Error("prefStorage is undefined");return g.L(q,W.get("psi"),5);case 5:E=q.C;z=g.F(y.actionMetadata,C4_);if(((f=E)==null?void 0:f.isPaused)!==!1||(n=z)==null||!n.lastPlaybackPositionSeconds){q.W2(6);break}Q={key:g.Ky(v,"videoPlaybackPositionEntity"),videoId:v,lastPlaybackPositionSeconds:z.lastPlaybackPositionSeconds};return g.L(q,Dp(p.C,Q,"videoPlaybackPositionEntity"),
6);case 6:g.rQ(q,3);break;case 2:return g.kx(q),q.return(new lw("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",O,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return q.return(new lw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",O))}})},Ve_=function(p,y){var O,v,W;
return g.w(function(E){switch(E.T){case 1:O=fI(y);g.Rx(E,2);v=g.JK(y.entityKey).entityId;if(v==="!*$_ALL_ENTITIES_!*$")return g.L(E,fb_(p.C),5);W=g.Ky(v,"videoPlaybackPositionEntity");return g.L(E,oMS(p.C,W),5);case 5:g.rQ(E,3);break;case 2:return g.kx(E),E.return(new lw("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",O,void 0,"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return E.return(new lw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
O))}})},A_F=function(p,y){this.api=p;
this.C=y;this.logger=new g.Qx("woffle");this.T=!1;this.Jn={d7:this.d7};this.logger.debug("Initialized OfflineMediaManager")},pI6=function(p){return g.w(function(y){return y.return($aF(p))})},yg_=function(p){var y;
return g.w(function(O){if(O.T==1)return g.L(O,g.TPi(p),2);y=O.C;return O.return(y.filter(function(v){return!!v.url}).map(function(v){return v.url}))})},dH=function(p,y){var O=g.io(y);
if(O===1||O===0)return Promise.resolve();(O=OhF(p,y))&&O.stopVideo();p.J=0;return pI6(y)},B7=function(p,y,O,v){O=O===void 0?!1:O;
v=v===void 0?!0:v;var W=typeof y==="string"?y:y.videoDetails.videoId;g.io(W)===2&&((y=OhF(p,W))?y.stopVideo():p.logger.info(function(){return"Corresponding player for "+W+" not found. Pausing anyway"}),g.Fp(W,2),p.J=2,O?vk_(p.C):v&&Wn_(p.C))},OhF=function(p,y){var O;
return((O=p.player)==null?void 0:O.getVideoData().videoId)===y?p.player:null},gke=function(p,y,O){y.getPlayerResponse();
g.Fp(y.videoId,2);p.J=2;p.T=!1;var v;(v=p.player)==null||v.dispose();p.player=p.api.z6(y);y={};p.player.cK((y.localmediachange=p.rZ,y.signatureexpired=p.W1,y.statechange=p.VLa,y),p);var W=p.d7(O);p.player.VR(g.Kk(W,W,!0,"m"),!1);p.logger.debug(function(){return"Starting headless playback with quality: "+W});
p.player.Dw(!1)},EkA=function(p,y){this.C=p;
this.I_=y},GbI=function(p,y){var O,v;
return g.w(function(W){switch(W.T){case 1:return O=fI(y),g.L(W,V6(p.C,y.entityKey,"transfer"),2);case 2:if(v=W.C)return W.return(new lw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",O));g.Rx(W,3);return g.L(W,z7F(p,y),5);case 5:g.rQ(W,4);break;case 3:return g.kx(W),W.return(new lw("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",O,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return W.return(new lw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
O))}})},ok6=function(p,y){var O,v;
return g.w(function(W){switch(W.T){case 1:return O=fI(y),g.L(W,V6(p.C,y.entityKey,"transfer"),2);case 2:v=W.C;if(!v||v.transferState!=="TRANSFER_STATE_COMPLETE")return W.return(new lw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",O));g.Rx(W,3);return g.L(W,z7F(p,y,!0),5);case 5:g.rQ(W,4);break;case 3:return g.kx(W),W.return(new lw("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",O,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));
case 4:return W.return(new lw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",O))}})},fjS=function(p,y){var O,v,W,E,z,f,n,Q,q,S;
return g.w(function(N){switch(N.T){case 1:return O=fI(y),v=g.JK(y.entityKey).entityId,g.L(N,Ci(p.C,{mode:"readonly",K_:!0},function(P){var u=Iv(P,y.entityKey,"transfer");P=Iv(P,g.Ky(v,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.YB.all([u,P])}),2);
case 2:W=N.C;E=g.c(W);z=E.next().value;f=E.next().value;n=z;Q=f;if(!n||n.transferState!=="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH")return N.return(new lw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",O));g.Rx(N,3);n.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE";return g.L(N,Dp(p.C,n,"transfer"),5);case 5:q=g.JK(n.key).entityId;hLX({videoId:q,ZO:n,offlineModeType:(S=Q)==null?void 0:S.offlineModeType});g.rQ(N,4);break;case 3:return g.kx(N),N.return(new lw("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",
O,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return N.return(new lw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",O))}})},z7F=function(p,y,O){O=O===void 0?!1:O;
var v,W,E,z,f,n,Q,q,S,N,P,u,R,r,x;return g.w(function(k){switch(k.T){case 1:return v=g.F(y.actionMetadata,nkF),W=g.JK(y.entityKey).entityId,E=g.Ky(W,"downloadStatusEntity"),g.L(k,Ci(p.C,{mode:"readonly",K_:!0},function(M){var l=Iv(M,E,"downloadStatusEntity");M=Iv(M,g.Ky(W,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.YB.all([l,M])}),2);
case 2:return z=k.C,f=g.c(z),n=f.next().value,Q=f.next().value,q=n,S=Q,N="TRANSFER_STATE_TRANSFER_IN_QUEUE",((P=q)==null?void 0:P.downloadState)==="DOWNLOAD_STATE_USER_DELETED"&&(N="TRANSFER_STATE_PAUSED_BY_USER"),r={key:y.entityKey,transferState:N,cotn:g.t8(16),enqueuedTimestampMs:Date.now().toString(),maximumDownloadQuality:(u=v)==null?void 0:u.maximumDownloadQuality,preferredAudioTrack:(R=v)==null?void 0:R.preferredAudioTrack,transferRetryCount:0,isRefresh:O,hasLoggedFirstStarted:!1},g.L(k,Ci(p.C,
{mode:"readwrite",K_:!0},function(M){var l=[];O&&l.push(jO(M,g.Ky(W,"offlineVideoStreams")));l.push(UG(M,r,"transfer"));return g.YB.all(l)}),3);
case 3:if(!O){k.W2(4);break}return g.L(k,pI6(W),4);case 4:UaS({videoId:W,ZO:r,offlineModeType:(x=S)==null?void 0:x.offlineModeType}),g.cR(k)}})},qhh=function(p,y,O,v){if(!p.action.entityKey)throw Error("entityKey is missing.");
var W=g.JK(p.action.entityKey);W={entityType:W.OT,entityId:W.entityId,offlineOrchestrationActionType:p.action.actionType,orchestrationAction:{orchestrationActionId:p.actionId}};y&&(W.offlineOrchestrationActionResult=y.status,W.isRetryable=O?!1:y.C,y.J&&(W.offlineOrchestrationFailureReason=Qoe(y.J,W.isRetryable)));var E,z;if((E=p.action.actionMetadata)==null?0:(z=E.offlineLoggingData)==null?0:z.offlineModeType)W.offlineModeType=p.action.actionMetadata.offlineLoggingData.offlineModeType;v&&(W.additionalOrchestrationActions=
v.map(function(f){return{orchestrationActionId:f.actionId}}));
return W},Qoe=function(p,y){return p!=="OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR"||y?p==="OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"&&y?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":p:"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"},ShF=function(p,y){var O={offlineOrchestrationContext:qhh(p)};
y=tuK(y,O);Y7$(Tn$(),y,p.rootActionId)},NbL=function(p,y,O,v){v=v===void 0?[]:v;
y={offlineOrchestrationContext:qhh(p,y,O,v)};y=tuK(3,y);Y7$(Tn$(),y,p.rootActionId)},P7_=function(){this.actions=[]},u3Y=function(p,y){y=g.c(y);
for(var O=y.next();!O.done;O=y.next())O=O.value,ShF(O,1),p.actions.push(O);p.actions.sort(p.C)},Jg_=function(p,y){if(y)for(var O=0;O<p.actions.length;O++)if(y==="!*$_ALL_ENTITIES_!*$"&&p.actions[O].actionId!==y||y!=="!*$_ALL_ENTITIES_!*$"&&p.actions[O].rootActionId===y&&p.actions[O].actionId!==y)p.actions.splice(O,1),O--},KnA=function(p,y){p=g.c(p.actions);
for(var O=p.next();!O.done;O=p.next())if(O.value.actionId===y)return!0;return!1},H7=function(p,y,O,v,W){g.d.call(this);
var E=this;this.T=p;this.R_=y;this.P2=O;this.Y=v;this.I_=W;this.C=new P7_;this.G=new g.pp;this.J=new g.WI(function(){E.retry()});
this.S=NaN;this.D=!1;this.Jn={IyR:function(){return E.C},
uZ:function(){return E.G},
pH2:function(){return E.J},
retry:function(){return E.retry()}};
g.B(this,this.J);this.V=this.T.observe(this.T4.bind(this))},$uS=function(p,y,O,v,W){var E;
return g.w(function(z){if(z.T==1)return E=new H7(p,y,O,v,W),g.L(z,cgS(E),2);R7F(E);return z.return(E)})},R7F=function(p){var y=p.C.actions[0];
return p.B?((y==null?void 0:y.action.actionType)==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&p.B[0].action.actionType!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(p.D=!0),Promise.resolve()):soL(p)},soL=function(p){var y,O,v,W,E,z,f,n,Q,q,S,N,P,u,R,r,x;
return g.w(function(k){switch(k.T){case 1:if(p.B)throw Error("Already processing an action");if(p.DI())return k.return();y=p.C.actions.shift();eLS(p.P2,!y);if(y===void 0)return k.return();y.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&y.actionId==="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS"&&Jg_(p.C,y.actionId);O="";y.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&y.rootActionId===y.actionId&&(O=y.actionId);v=[y];p.B=v;if(W=p.R_[y.entityType]){k.W2(2);break}p.B=
void 0;return g.L(k,soL(p),3);case 3:return k.return();case 2:E=g.c(v);for(z=E.next();!z.done;z=E.next())f=z.value,ShF(f,2);g.Rx(k,4,5);return g.L(k,HTX(W,v.map(function(M){return M.action})),7);
case 7:n=k.C,Q=g.c(v),q=Q.next();case 8:if(q.done){k.W2(10);break}S=q.value;N=n.get(S.action);return g.L(k,rgF(p,S,N),9);case 9:q=Q.next();k.W2(8);break;case 10:Jg_(p.C,O);case 5:g.tQ(k);p.B=void 0;g.Mb(k,6);break;case 4:return P=g.kx(k),W7("Orchestration error",P),g.Rx(k,12),g.L(k,aje(p,v),14);case 14:g.rQ(k,5);break;case 12:u=g.kx(k);W7("Orchestration retry error",u);R=g.c(v);for(r=R.next();!r.done;r=R.next())x=r.value,x.retryScheduleIndex<3&&u3Y(p.C,[x]);k.W2(5);break;case 6:return g.L(k,soL(p),
0)}})},rgF=function(p,y,O){var v,W,E,z,f,n,Q,q,S,N,P,u;
return g.w(function(R){switch(R.T){case 1:v=y.retryScheduleIndex+2===3;if(O.status==="OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS"){R.W2(2);break}if(O.status!=="OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE"){R.W2(0);break}NbL(y,O,v);if(O.C&&y.retryScheduleIndex+1<3)return g.L(R,aje(p,[y]),0);E=((W=O)==null?0:W.T)?O.T:"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN";z={entityKey:y.action.entityKey,failureReason:E};f=void 0;g.zd(p.I_)?f="mainVideoDownloadStateEntity":g.hX(p.I_)&&(f="musicTrackDownloadMetadataEntity");
if(!f||!O.downloadState){R.W2(7);break}n=g.JK(y.action.entityKey).entityId;return g.L(R,SG(n,f,p.T,O.downloadState),7);case 7:En(p.Y,z);if(O.downloadState==="DOWNLOAD_STATE_FAILED"&&p.I_.K("html5_auto_retry_failed_pde_actions")){R.W2(0);break}W7("Orchestration result is not retryable, deleting action");return g.L(R,oMS(p.T,c7(y).key),0);case 2:Q=void 0;try{Q=(q=O.B)==null?void 0:q.map(function(r){return p.createAction(r,y)})}catch(r){return NbL(y,O,v),S={entityKey:y.action.entityKey,
failureReason:"OFFLINE_OPERATION_FAILURE_REASON_UNSUPPORTED_ENTITY_FAILED"},En(p.Y,S),W7("Orchestration subactions creation error",r),R.return()}NbL(y,O,v,Q);if(!Q){R.W2(12);break}N=Q.map(function(r){return c7(r)});
P=0;case 13:if(!(P<Q.length)||p.D){R.W2(15);break}return g.L(R,Ci(p.T,{mode:"readwrite",K_:!0},function(r){var x=[];x.push(AlX(r,N.slice(P,P+10),"offlineOrchestrationActionWrapperEntity"));return g.YB.all(x)}),16);
case 16:P+=10;R.W2(13);break;case 15:if(p.D)return p.D=!1,R.return();case 12:return u=c7(y),g.L(R,oMS(p.T,u.key),17);case 17:ShF(y,4),g.cR(R)}})},t1F=function(p,y){var O,v,W,E,z,f,n,Q,q,S,N,P;
return g.w(function(u){O=[];v=Infinity;W=4E3;E=g.c(y);for(z=E.next();!z.done;z=E.next())f=z.value,n=Number(f.enqueueTimeSec),Q=kbA(n),q=f.retryScheduleIndex,S=q!=null&&q>0,Q>0&&S?(v=Math.min(v,n),W=Math.min(Q,W)):O.push(f);isFinite(v)&&(!p.J.isActive()||v<p.S)&&(p.S=v,p.J.start(W));p.G.Az()||(N=O.length,O=O.filter(function(R){var r;R=((r=R.actionProto)==null?void 0:r.actionType)||"OFFLINE_ORCHESTRATION_ACTION_TYPE_UNKNOWN";return!xu$.includes(R)}),P=O.length<N,!p.J.isActive()&&P&&p.J.start(1));
O.length>0&&Tb$(p,O);return g.L(u,R7F(p),0)})},M1L=function(p){var y,O,v,W,E,z,f;
return g.w(function(n){if(n.T==1)return g.L(n,Yh$(p),2);y=n.C;O=[];v=g.c(y);for(W=v.next();!W.done;W=v.next())E=W.value,z=g.JK(E.key),f=z.entityId,KnA(p.C,f)||O.push(E);return g.L(n,t1F(p,O),0)})},kbA=function(p){p=p*1E3-Date.now();
return p>4E3?4E3:p},aje=function(p,y){var O,v,W;
return g.w(function(E){O=g.c(y);for(v=O.next();!v.done;v=O.next()){W=v.value;var z=void 0,f=void 0,n=((f=W.action)==null?void 0:(z=f.actionMetadata)==null?void 0:z.retryScheduleIntervalsInSeconds)||[1,2,4];z=1;W.retryScheduleIndex<n.length&&(z=n[W.retryScheduleIndex]);W.C=z*1E3+Date.now();W.retryScheduleIndex++}return g.L(E,ZhA(p,y),0)})},cgS=function(p){var y;
return g.w(function(O){if(O.T==1)return g.L(O,A6(p.T,"offlineOrchestrationActionWrapperEntity"),2);y=O.C;return g.L(O,t1F(p,y),0)})},Tb$=function(p,y){y.length!==0&&y.forEach(function(O){O=KI(O);
O.retryScheduleIndex<3&&u3Y(p.C,[O])})},Yh$=function(p,y){var O;
return g.w(function(v){if(v.T==1)return g.L(v,A6(p.T,"offlineOrchestrationActionWrapperEntity",y),2);O=v.C;return v.return(O.filter(P0A))})},ZhA=function(p,y){if(y.length===0)return Promise.resolve([]);
y=y.map(function(O){return c7(O)});
return Gn_(p.T,y)},Ln$=function(p){this.jL=p;
this.C=void 0},ljS=function(p,y){var O,v,W,E;
return g.w(function(z){O=y.videoId;v=!0;if(y.captionTracks.length)W=jHI(y),p.C=new g.rD(p.jL,y,W);else if(y.fg)E=g.dii(y),p.C=new g.ko(p.jL,y.fg,O,E,y.eh,y.eventId),v=y.eh;else return z.return();return z.return(new Promise(function(f){var n;(n=p.C)==null||n.u5({jW:function(){return g.w(function(Q){if(Q.T==1)return g.L(Q,p.jW(O,v),2);f();g.cR(Q)})},
Aw:function(){}})}))})},wIK=function(p){var y;
return g.w(function(O){if(O.T==1)return g.L(O,RLA(p),2);y=O.C;return O.return(!!y&&y.length>0)})},iw=function(p){g.d.call(this);
this.C=p;this.T=this.C.observe(this.J.bind(this))},muY=function(p,y){var O,v,W,E,z,f,n;
return g.w(function(Q){switch(Q.T){case 1:if(y.length===0)return Q.return([]);O=y.map(function(q){return g.Ky(q,"transfer")});
return g.L(Q,A6(p.C,"transfer",O),2);case 2:v=Q.C;W=v.filter(P0A).map(function(q){return g.JK(q.key).entityId});
E=y.filter(function(q){return W.indexOf(q)===-1});
if(E.length===0)return Q.return([]);z=g.c(E);f=z.next();case 3:if(f.done){Q.W2(5);break}n=f.value;return g.L(Q,pI6(n),4);case 4:f=z.next();Q.W2(3);break;case 5:return Q.return(E)}})},Hh_=function(p,y,O,v,W,E){var z,f,n;
return g.w(function(Q){z="STREAM_TYPE_UNKNOWN";O.video&&O.audio?(z="STREAM_TYPE_AUDIO_AND_VIDEO",W7("unexpected stream type")):O.video&&!O.audio?z="STREAM_TYPE_VIDEO":!O.video&&O.audio&&(z="STREAM_TYPE_AUDIO");f=g.Ky(y,"offlineVideoStreams");n={numBytesDownloaded:W.toFixed(),numTotalBytes:E.toFixed(),streamType:z,streamState:"DOWNLOAD_STREAM_STATE_IN_PROGRESS",formatStreamBytes:JSON.stringify(v),itag:z==="STREAM_TYPE_AUDIO_AND_VIDEO"?Number(O.itag):void 0};return g.L(Q,Ci(p,{mode:"readwrite",K_:!0},
function(q){var S=Iv(q,f,"offlineVideoStreams"),N=Iv(q,g.Ky(y,"transfer"),"transfer");return g.YB.all([S,N]).then(function(P){P=g.c(P);var u=P.next().value;P=P.next().value;if(!P)return jO(q,f).then(function(){});
var R=duY(u);u=BbS(u,v,n,f);var r=UG(q,u,"offlineVideoStreams");duY(u)>R&&(P.lastProgressTimeMs=Date.now().toString());R=[r];P.offlineVideoStreams||(P.offlineVideoStreams=[]);P.offlineVideoStreams.indexOf(f)===-1&&(P.offlineVideoStreams.push(f),R.push(UG(q,P,"transfer")));return g.YB.all(R)})}),0)})},ihY=function(p,y){var O,v,W,E,z;
return g.w(function(f){if(f.T==1)return O=g.Ky(y,"offlineVideoStreams"),g.L(f,V6(p,O,"offlineVideoStreams"),2);v=f.C;if(!v||!v.streamsProgress)return f.return();W=g.c(v.streamsProgress);for(E=W.next();!E.done;E=W.next())z=E.value,z.streamState="DOWNLOAD_STREAM_STATE_COMPLETE",z.numTotalBytes!==z.numBytesDownloaded&&(z.numBytesDownloaded=z.numTotalBytes);return g.L(f,Dp(p,v,"offlineVideoStreams"),0)})},BbS=function(p,y,O,v){if(p&&p.streamsProgress){v=p;
a:{y=y.itag+";"+y.xtags;for(var W=p.streamsProgress,E=0;E<W.length;E++){var z=JSON.parse(W[E].formatStreamBytes);if(z.itag+";"+z.xtags===y){W[E]=O;O=W;break a}}W.push(O);O=W}v.streamsProgress=O}else p={key:v,streamsProgress:[O]};return p},duY=function(p){if(p==null?0:p.streamsProgress){var y=0;
p=p.streamsProgress;for(var O=0;O<p.length;O++){var v=p[O];isNaN(Number(v.numBytesDownloaded))?W7("stream progress bytes number invalid"):y+=Number(v.numBytesDownloaded)}return y}return 0},FnX=function(p,y,O,v){g.d.call(this);
var W=this;this.T=p;this.api=y;this.z4=O;this.T4=v;this.G=new g.pp;this.B=new g.WI(function(){W.C&&W.C.transferState==="TRANSFER_STATE_TRANSFERRING"&&W.G.Az()&&((W.C.transferRetryCount||0)<3?B7(W.Y,W.D,!1,!1):dH(W.Y,W.D.videoDetails.videoId),W.KC("TRANSFER_FAILURE_REASON_TIMEOUT_NO_PROGRESS"))});
this.P2=this.w2=0;this.V=this.S=!1;this.yr=g.sV(this.api.X().experiments,"html5_transfer_processing_logs_interval");this.Fo=new g.hz(this);this.Jn={wH_:function(){return W.B},
gvR:function(){return W.T4},
uZ:function(){return W.G}};
this.R_=this.T.observe(this.WV.bind(this));this.Y=new A_F(y,this);this.ib=new Ln$(y);this.Ne=new iw(this.T);this.xs=this.G.listen("publicytnetworkstatus-online",this.bX.bind(this));this.Ys=this.G.listen("publicytnetworkstatus-offline",this.K2L.bind(this));this.V=this.api.X().K("html5_less_transfer_processing_logs");g.B(this,this.Fo);this.Fo.j(y,"offlinetransferpause",this.YXa);g.zd(this.api.X())?this.J="mainVideoDownloadStateEntity":g.hX(this.api.X())&&(this.J="musicTrackDownloadMetadataEntity")},
IjI=function(p){return g.w(function(y){if(y.T==1)y=g.L(y,KT$(),2);
else{var O=p.Ne;var v=g.H9();v=Object.keys(v);O=muY(O,v);y=g.L(y,O,0)}return y})},I8=function(p,y){y=y===void 0?!1:y;
var O;return g.w(function(v){if(v.T==1){if(p.C)throw Error("Already downloading a video");p.P2=0;p.S=!1;return g.L(v,e7L(p),2)}return v.T!=4?(O=v.C,X3h(p.z4,!O),O&&p.G.Az()?y?g.L(v,new Promise(function(W){g.$L(W,1E3)}),4):v.W2(4):(!O&&p.C&&F_(p),v.W2(0))):g.L(v,XIX(p,O),0)})},UuS=function(p){return g.w(function(y){if(y.T==1)return p.D?g.L(y,dH(p.Y,p.D.videoDetails.videoId),3):y.W2(0);
F_(p);g.cR(y)})},joI=function(p,y){var O,v,W;
return g.w(function(E){switch(E.T){case 1:return g.Rx(E,2),(O=!!y.captionTracks.length||!!y.fg)?g.L(E,wIK(y.videoId),4):E.return();case 4:return(v=E.C)?E.return():g.L(E,ljS(p.ib,y),5);case 5:g.rQ(E,0);break;case 2:W=g.kx(E),W7("Caption downloading error",W,y.cotn),g.cR(E)}})},XIX=function(p,y){var O,v,W,E,z,f;
return g.w(function(n){switch(n.T){case 1:if(p.S)return n.return();p.S=!0;p.C=y;O=g.JK(p.C.key);v=O.entityId;W=void 0;if(p.C.transferState==="TRANSFER_STATE_TRANSFERRING")return g.L(n,eG(p,v),7);if(p.C.transferState!=="TRANSFER_STATE_TRANSFER_IN_QUEUE"||p.C.transferRetryCount||p.C.hasLoggedFirstStarted){n.W2(3);break}return g.L(n,eG(p,v),5);case 5:return W=n.C,p.C.hasLoggedFirstStarted=!0,g.L(n,h76(p),6);case 6:jIU({videoId:v,ZO:p.C,offlineModeType:W},void 0,void 0,!0);n.W2(3);break;case 7:W=n.C,
o8({transferStatusType:"TRANSFER_STATUS_TYPE_RESUME_PROCESSING",statusType:"OFFLINING_RETRIED"},{videoId:v,ZO:p.C,offlineModeType:W});case 3:return g.L(n,bhK(p),8);case 8:return E=null,g.Rx(n,9),g.L(n,C7e(p,y),11);case 11:E=n.C;p.D=E;g.rQ(n,10);break;case 9:return z=g.kx(n),W7("error getting player response",z,y.cotn),g.L(n,p.KC("TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING"),12);case 12:return n.return();case 10:return f=p4I(p.api.X(),y.cotn,E),g.L(n,joI(p,f),13);case 13:return g.L(n,yg_(f.videoId),
14);case 14:f.nQ=n.C,gke(p.Y,f,y.maximumDownloadQuality),p.B.start(108E5),g.cR(n)}})},e7L=function(p){var y,O;
return g.w(function(v){if(v.T==1)return g.L(v,A6(p.T,"transfer"),2);y=v.C;O=y.filter(DuS).sort(V1F);return O.length===0?v.return():v.return(O[0])})},bhK=function(p){var y,O,v;
return g.w(function(W){if(W.T==1){if(!p.C)return X_(p,"onTransferStart"),W.return();p.B.start(108E5);return g.L(W,Un(p,"TRANSFER_STATE_TRANSFERRING"),2)}y=p.C;return(v=((O=y)==null?0:O.key)?g.JK(y.key).entityId:"")&&p.J?g.L(W,SG(v,p.J,p.T,"DOWNLOAD_STATE_DOWNLOAD_IN_PROGRESS"),0):W.W2(0)})},vk_=function(p){var y,O,v,W;
g.w(function(E){switch(E.T){case 1:if(!p.C){X_(p,"onTransferPausedByUser");E.W2(2);break}y=p.C;p.B.stop();return g.L(E,Un(p,"TRANSFER_STATE_PAUSED_BY_USER"),3);case 3:v=((O=y)==null?0:O.key)?g.JK(y.key).entityId:"";if(!v||!p.J){E.W2(4);break}return g.L(E,SG(v,p.J,p.T,"DOWNLOAD_STATE_PAUSED"),4);case 4:return g.L(E,eG(p,v),6);case 6:W=E.C,b4A({videoId:v,ZO:y,offlineModeType:W});case 2:F_(p),I8(p),g.cR(E)}})},Wn_=function(p){var y,O,v;
g.w(function(W){if(W.T==1){if(!p.C)return X_(p,"onTransferPausedByNetwork"),W.return();p.B.stop();return g.L(W,Un(p,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),2)}if(W.T!=3)return y=p.C,(v=((O=y)==null?0:O.key)?g.JK(y.key).entityId:"")&&p.J?g.L(W,SG(v,p.J,p.T,"DOWNLOAD_STATE_PAUSED"),3):W.W2(3);F_(p);g.cR(W)})},AgY=function(p){var y,O,v,W,E;
g.w(function(z){switch(z.T){case 1:if(!p.C)return X_(p,"onTransferComplete"),z.return();y=p.C;p.B.stop();if(!y||!p.D){z.W2(2);break}O=p4I(p.api.X(),y.cotn,p.D);return g.L(z,joI(p,O),2);case 2:return g.L(z,Un(p,"TRANSFER_STATE_COMPLETE","DOWNLOAD_STREAM_STATE_COMPLETE"),4);case 4:W=((v=y)==null?0:v.key)?g.JK(y.key).entityId:"";if(!W||!p.J){z.W2(5);break}return g.L(z,SG(W,p.J,p.T,"DOWNLOAD_STATE_COMPLETE"),5);case 5:return g.L(z,ihY(p.T,W),7);case 7:return g.L(z,eG(p,W),8);case 8:E=z.C,o8({transferStatusType:"TRANSFER_STATUS_TYPE_COMPLETED",
statusType:"SUCCESS"},{videoId:W,ZO:y,offlineModeType:E}),F_(p),I8(p),g.cR(z)}})},pnY=function(p,y,O){var v,W;
g.w(function(E){switch(E.T){case 1:if(!p.C)return X_(p,"onTransferProgress: "+y),E.return();if(p.C.transferState==="TRANSFER_STATE_TRANSFERRING"){E.W2(2);break}return g.L(E,bhK(p),2);case 2:v=Date.now();if(!(v-p.w2>1E3)){E.W2(4);break}p.w2=v;return g.L(E,Hh_(p.T,O.videoId,O.T,O.cX,O.bytesDownloaded,O.C),5);case 5:if(p.V&&!(p.V&&v-p.P2>p.yr)){E.W2(4);break}p.P2=v;return g.L(E,eG(p,y),7);case 7:W=E.C,jIU({videoId:y,ZO:p.C,offlineModeType:W},O.bytesDownloaded,O.C);case 4:p.B.start(108E5),g.cR(E)}})},
ySS=function(p){var y=(p.C.transferRetryCount||0)<3;
y&&(p=p.C,p.transferRetryCount=(p.transferRetryCount||0)+1);return y},O8e=function(p,y){y=y===void 0?"TRANSFER_FAILURE_REASON_UNKNOWN":y;
var O,v,W,E;return g.w(function(z){if(z.T==1)return p.C||X_(p,"setTransferToFailed: "+y),O="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",y==="TRANSFER_FAILURE_REASON_NETWORK"?O="OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED":y==="TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"&&(O="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED"),g.L(z,Un(p,"TRANSFER_STATE_FAILED","DOWNLOAD_STREAM_STATE_ERROR_STREAMS_MISSING",y),2);if(z.T!=3)return En(p.T4,{entityKey:(v=p.C)==null?void 0:v.key,failureReason:O}),
W=p.C?g.JK(p.C.key).entityId:"",g.L(z,eG(p,W),3);E=z.C;var f={videoId:W,ZO:p.C,offlineModeType:E},n=y,Q={transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_WITH_FAILURE",statusType:"FAILED"};n&&(Q.transferFailureReason=n,Q.failureReason=C0Y(n));o8(Q,f);g.cR(z)})},Un=function(p,y,O,v){var W;
return g.w(function(E){if(E.T==1){if(!p.C)return X_(p,"saveTransferState: "+y),E.return();p.C.transferState=y;p.C.failureReason=v;g.Rx(E,2);return g.L(E,h76(p,function(z){return O?eO(z,"offlineVideoStreams",p.C.offlineVideoStreams).then(function(f){for(var n=g.c(f),Q=n.next();!Q.done;Q=n.next())if((Q=Q.value)&&Q.streamsProgress){Q=g.c(Q.streamsProgress);for(var q=Q.next();!q.done;q=Q.next())q.value.streamState=O}return AlX(z,f.filter(function(S){return!!S}),"offlineVideoStreams")}):g.YB.resolve(void 0)}),
4)}if(E.T!=2)return g.rQ(E,0);
W=g.kx(E);return W instanceof g.sN&&W.type==="QUOTA_EXCEEDED"?g.L(E,p.KC("TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"),0):E.W2(0)})},h76=function(p,y){var O;
return g.w(function(v){if(!p.C)return v.return();O=p.C;return g.L(v,Ci(p.T,{mode:"readwrite",K_:!0},function(W){var E=[UG(W,O,"transfer")];y&&E.push(y(W));return g.YB.all(E)}),0)})},F_=function(p){p.C=void 0;
p.D=void 0;p.B.stop()},C7e=function(p,y){var O,v,W,E,z;
return g.w(function(f){if(f.T==1)return O=g.JK(y.key),v=O.entityId,W=g.Ky(v,"playbackData"),g.L(f,V6(p.T,W,"playbackData"),2);E=f.C;if((z=E)==null?0:z.playerResponseJson)return f.return(JSON.parse(E.playerResponseJson));throw Error("No PlayerResponse found");})},X_=function(p,y){p.api.pj("woffle",{mcte:y});
W7("missing current transfer entity.")},eG=function(p,y){var O,v,W;
return g.w(function(E){if(E.T==1)return g.L(E,V6(p.T,g.Ky(y,"videoDownloadContextEntity"),"videoDownloadContextEntity"),2);O=E.C;return E.return((W=(v=O)==null?void 0:v.offlineModeType)!=null?W:void 0)})},DuS=function(p){return vZe[p.transferState]!==void 0},V1F=function(p,y){var O=vZe[p.transferState],v=vZe[y.transferState];
return O!==v?O-v:Number(p.enqueuedTimestampMs)-Number(y.enqueuedTimestampMs)},jG=function(p,y){var O=this;
this.I_=p;this.api=y;this.G=new g.pp;this.D=new g.JA;this.Jn={MP:function(){return O.J.Jn.MP()},
uZ:function(){return O.G},
eUL:function(){return O.J},
CB:function(){return O.CB()},
R5:function(){return O.R5()},
W8:function(){return O.W8()},
LO:function(){return O.LO()},
l9:function(){return O.l9()},
zE:function(v){return O.zE(v)}};
this.J=new i4F(function(){return W8F(O)},function(){O.W8()},this.api.Ns(),this.api.K.bind(this.api));
this.C=new gH(this.api);FTA(this.J)},W8F=function(p){return g.w(function(y){p.api.g2("onOrchestrationBecameLeader");
return g.L(y,p.R5(),0)})},EZU=function(p){var y,O;
return g.w(function(v){if(v.T==1)return g.L(v,pI(),2);if(v.T!=3){y=v.C;if(!y)return W7("PES is undefined"),v.return();p.T=new FnX(y,p.api,p.J,p.C);O=p.JA(y);return g.L(v,$uS(y,O,p.J,p.C,p.I_),3)}p.Y=v.C;return g.L(v,gZF(p),0)})},gZF=function(p){var y;
return g.w(function(O){switch(O.T){case 1:if(!p.T)return W7("transferManager is undefined"),O.return();if(p.T.C){O.W2(2);break}return g.L(O,I8(p.T),2);case 2:if(!p.I_.K("woffle_enable_main_downloads_library")){O.W2(4);break}return g.L(O,p.f5(),4);case 4:if(!p.I_.K("html5_offline_playback_position_sync")){O.W2(6);break}return g.L(O,p.Ky(),7);case 7:return g.L(O,p.zE(864E5),6);case 6:return g.L(O,p.refreshAllStaleEntities(43200,!0),9);case 9:return g.L(O,p.c9(),10);case 10:if(!p.I_.K("html5_retry_downloads_for_expiration")){O.W2(11);
break}return g.L(O,p.l9(),11);case 11:return p.S=g.se(function(){p.refreshAllStaleEntities(43200,!0);p.c9()},9E5),g.g1(g.zY(),function(){return p.LO()}),g.L(O,pI(),13);
case 13:return y=O.C,g.L(O,H4A(y),14);case 14:IbA(p.J),g.cR(O)}})},zjK=function(){var p,y,O,v,W,E;
return g.w(function(z){switch(z.T){case 1:return g.L(z,pI(),2);case 2:p=z.C;if(!p)return z.return([]);y=Date.now()/1E3;return g.L(z,A6(p,"offlineVideoPolicy"),3);case 3:O=z.C,v=g.c(O),W=v.next();case 4:if(W.done){z.W2(6);break}E=W.value;if(!(E.expirationTimestamp&&Number(E.expirationTimestamp)<y)){z.W2(5);break}E.action="OFFLINE_VIDEO_POLICY_ACTION_DISABLE";E.offlinePlaybackDisabledReason="OFFLINE_PLAYBACK_DISABLED_REASON_CLIENT_OFFLINE_CONTENT_EXPIRED";return g.L(z,Dp(p,E,"offlineVideoPolicy"),5);
case 5:W=v.next();z.W2(4);break;case 6:return z.return(O.map(function(f){return f.key}))}})},hs=function(p,y,O,v,W){var E,z,f;
return g.w(function(n){if(n.T==1)return g.L(n,pI(),2);E=n.C;if(!E)return n.return([]);z=y.map(function(Q){var q=g.Ky(Q,O);q={actionType:v,entityKey:q,actionMetadata:Object.assign({},y_F(),W)};v!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&(q.actionMetadata.priority=0);Q=new Js(O,Q,q);return c7(Q)});
f=Gn_(E,z);FTA(p.J);return n.return(f)})},Gie=function(p,y,O,v){var W,E,z,f,n,Q,q,S;
return g.w(function(N){switch(N.T){case 1:W=[],E=g.c(y),z=E.next();case 2:if(z.done){N.W2(4);break}f=z.value;if(f.upToDate||O&&!f.shouldAutoSyncMetadata||!f.playlistId){N.W2(3);break}n={};switch(v){case "mainPlaylistEntity":Q={nextAutoRefreshIntervalSeconds:f.checkInSeconds,autoSync:O};n={mainPlaylistEntityActionMetadata:Q};break;case "musicPlaylist":q={autoSync:O},n={musicPlaylistEntityActionMetadata:q}}return g.L(N,hs(p,[f.playlistId],v,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",n),6);case 6:(S=
N.C)&&W.push.apply(W,g.T(S));case 3:z=E.next();N.W2(2);break;case 4:return N.return(W)}})},oZS=function(p,y){var O;
return g.w(function(v){return y.length?(O=y_F(),g.hT(O,wH,{isEnqueuedForExpiredStreamUrlRefetch:!0}),p.api.pj("qrd",{v:y.length}),v.return(hs(p,y,"playbackData","OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",O))):v.return([])})},fmY=function(p,y,O){this.C=p;
this.I_=y;this.J=O},qF$=function(p,y){var O,v,W,E,z,f,n,Q,q,S,N,P,u,R,r,x,k;
return g.w(function(M){switch(M.T){case 1:return O=fI(y),v=g.JK(y.entityKey),W=v.entityId,E=[],g.Rx(M,2),g.L(M,nZS(p,W),4);case 4:E=M.C;if(!(p.I_.K("woffle_enable_main_downloads_library")&&((z=E)==null?0:z.length))){M.W2(5);break}return g.L(M,S2L(p.C,[y.entityKey]),5);case 5:g.rQ(M,3);break;case 2:return f=g.kx(M),n="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Q="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",f instanceof g.sN&&f.type==="QUOTA_EXCEEDED"?(n="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
Q="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"):W7("Playlist add error"),M.return(new lw("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",O,void 0,n,Q));case 3:q=[];if(!p.I_.K("html5_offline_prevent_redownload_downloaded_video")){M.W2(7);break}return g.L(M,AAh(p.C,"mainVideoEntity",E),8);case 8:E=M.C;case 7:if((S=E)==null?0:S.length)for(N=g.c(E),P=N.next();!P.done;P=N.next())if(u=P.value,R=u.offlineVideoData,r=void 0,(r=R)==null?0:r.videoId)x=void 0,k=Number(((x=y.actionMetadata)==null?void 0:x.priority)||
0)+1,q.push(LI("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",R.videoId,"mainVideoEntity",k,bw,QAF(y,R,W)));return M.return(new lw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",O,q))}})},N7h=function(p,y){var O,v,W,E,z,f,n,Q,q,S,N,P,u,R,r,x,k,M,l,H,h,X,V,WR,O4,E4,b,PR,xx,U4,rF,GL,T0,ax,O_,a,G0,U_,$C,tI,QU,HR,lY,Y6,t,Y,Z,m,e,s4,yM,JQ,vR,Yx,CK,$6,sl,lg,pm,hn,y0,aD,Pz,ms,Jt,dh,j2,hy,Zi,ES,O0,zB,My,b9;
return g.w(function(ug){switch(ug.T){case 1:return O=fI(y),v=y.entityKey,W=g.JK(v).entityId,E=[],z=!1,W==="!*$_ALL_ENTITIES_!*$"?(z=!0,g.L(ug,A6(p.C,"mainPlaylistEntity"),5)):g.L(ug,V6(p.C,v,"mainPlaylistEntity"),4);case 4:(f=ug.C)&&E.push(f);ug.W2(3);break;case 5:E=ug.C;case 3:if((n=E)==null||!n.length)return ug.return(new lw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",O));Q=g.F(y.actionMetadata,SFK);S=(q=Q)==null?void 0:q.nextAutoRefreshIntervalSeconds;P=(N=Q)==null?void 0:N.autoSync;u=[];r=R=
!0;x=!1;if(!z&&P===!1){ug.W2(6);break}g.Rx(ug,7);return g.L(ug,TxA(0,!!P,!0,E),9);case 9:u=ug.C;g.rQ(ug,8);break;case 7:k=g.kx(ug);if(!(k instanceof Error&&k.message==="No data")){k instanceof Error&&k.message==="Empty response body"&&W7(k.message);ug.W2(8);break}return W==="!*$_ALL_ENTITIES_!*$"?g.L(ug,GlA(p.C,y,p.J,"OFFLINE_DELETE_REASON_UNAVAILABLE"),8):g.L(ug,ETU(W,p.C,y,p.J),8);case 8:if(!u.length||!z&&u[0].playlistId!==W)return ug.return(new lw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
O));case 6:if(z){M=[];l=g.c(u);for(H=l.next();!H.done;H=l.next())h=H.value,h.upToDate||P&&!h.shouldAutoSyncMetadata||!h.playlistId||(X={nextAutoRefreshIntervalSeconds:h.checkInSeconds,autoSync:P},M.push(LI("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",h.playlistId,"mainPlaylistEntity",0,bw,{mainPlaylistEntityActionMetadata:X})));return ug.return(new lw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",O,M))}u.length&&(V=u[0],x=!!V.upToDate,P&&(R=(WR=V.shouldAutoSyncMetadata)!=null?WR:!0,r=(O4=V.shouldAutoSyncVideos)!=
null?O4:!0,V.checkInSeconds&&(S=V.checkInSeconds)));if(x||!R)return ug.return(new lw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",O));E4=[];b=E[0];if(!b.downloadState){PR=void 0;ug.W2(15);break}return g.L(ug,V6(p.C,b.downloadState,"mainPlaylistDownloadStateEntity"),16);case 16:PR=ug.C;case 15:return xx=PR,rF=((U4=xx)==null?0:U4.addedTimestampMillis)?String(xx.addedTimestampMillis):void 0,g.Rx(ug,17),g.L(ug,nZS(p,W,rF,S),19);case 19:E4=ug.C;g.rQ(ug,18);break;case 17:GL=g.kx(ug);if(!(GL instanceof
Error&&GL.message==="No data for playlist")){if(GL instanceof Error&&GL.message==="Empty response body for playlist")W7(GL.message);else return T0="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",ax="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",GL instanceof g.sN&&GL.type==="QUOTA_EXCEEDED"&&(T0="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",ax="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),ug.return(new lw("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",O,void 0,T0,ax));
ug.W2(18);break}return g.L(ug,ETU(W,p.C,y,p.J),18);case 18:if(!r)return ug.return(new lw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",O));O_=[];a=new Map;if((G0=E4)==null?0:G0.length)for(U_=g.c(E4),$C=U_.next();!$C.done;$C=U_.next())tI=$C.value,QU=tI.offlineVideoData,HR=void 0,((HR=QU)==null?0:HR.videoId)&&a.set(QU.videoId,QU);lY=new Map;Y6=[];if((t=b)==null?0:(Y=t.videos)==null?0:Y.length)for(Z=g.c(b.videos),m=Z.next();!m.done;m=Z.next())if(e=m.value,s4=JSON.parse(g.JK(e).entityId),yM=s4.videoId)a.has(yM)?
(lY.set(yM,a.get(yM)),a.delete(yM)):Y6.push(yM);vR=Number(((JQ=y.actionMetadata)==null?void 0:JQ.priority)||0)+1;Yx=g.c(a.entries());for(CK=Yx.next();!CK.done;CK=Yx.next())$6=CK.value,sl=g.c($6),lg=sl.next().value,pm=sl.next().value,hn=lg,y0=pm,O_.push(LI("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",hn,"mainVideoEntity",vR,bw,QAF(y,y0,W)));aD=g.c(lY.entries());for(Pz=aD.next();!Pz.done;Pz=aD.next())ms=Pz.value,Jt=g.c(ms),dh=Jt.next().value,j2=Jt.next().value,hy=dh,Zi=j2,O_.push(LI("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
hy,"mainVideoEntity",vR,bw,QAF(y,Zi,W)));ES=g.c(Y6);for(O0=ES.next();!O0.done;O0=ES.next())zB=O0.value,My={playlistId:W},b9={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"},mainVideoEntityActionMetadata:My},O_.push(LI("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",zB,"mainVideoEntity",0,bw,b9));return ug.return(new lw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",O,O_))}})},P9F=function(p,y){var O,v,W,E;
return g.w(function(z){switch(z.T){case 1:return O=fI(y),g.Rx(z,2),v=g.JK(y.entityKey).entityId,v==="!*$_ALL_ENTITIES_!*$"?g.L(z,GlA(p.C,y,p.J,(W=y.actionMetadata)==null?void 0:(E=W.offlineLoggingData)==null?void 0:E.offlineDeleteReason),5):g.L(z,ETU(v,p.C,y,p.J),6);case 6:if(!p.I_.K("woffle_enable_main_downloads_library")){z.W2(5);break}return g.L(z,NxY(p.C,y.entityKey),5);case 5:g.rQ(z,3);break;case 2:return g.kx(z),z.return(new lw("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",O,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
"OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return z.return(new lw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",O))}})},nZS=function(p,y,O,v){var W,E,z,f,n,Q,q;
return g.w(function(S){switch(S.T){case 1:return g.L(S,klL([y]),2);case 2:return W=S.C,g.L(S,uy$(p,W[0],O,v),3);case 3:return E=S.C,z=E.mainPlaylistEntity,f=E.SXR,Q=W5K(z,(n=f)==null?void 0:n.avatar),g.Rx(S,4),g.L(S,$r(Q),6);case 6:g.rQ(S,5);break;case 4:q=g.kx(S),q instanceof Error&&q.message==="Failed to fetch"&&W7(q.message);case 5:return S.return(W[0].videos)}})},uy$=function(p,y,O,v){var W,E,z,f,n,Q,q,S,N,P,u,R,r,x,k,M,l;
return g.w(function(H){switch(H.T){case 1:W=Date.now().toString();O||(O=W);E=y.videos;z=y.playlistId;f=[];n=[];if(E)for(Q=g.c(E),q=Q.next();!q.done;q=Q.next()){S=q.value;N=S.offlineVideoData;if(!N||!N.videoId)throw W7("Invalid offlineVideoData for playlist"),Error("Invalid offlineVideoData for playlist");P=N.videoId;u={videoId:P,playlistId:z};R={id:g.Ky(JSON.stringify(u),"mainPlaylistVideoEntity"),video:g.Ky(P,"mainVideoEntity")};f.push(R);n.push(R.id)}x={key:g.Ky(z,"mainPlaylistDownloadStateEntity"),
addedTimestampMillis:O,lastSyncedTimestampMillis:W};k={key:g.Ky(z,"mainPlaylistEntity"),playlistId:z,videos:n,title:y.title,thumbnailStyleData:JSF(y),visibility:K8_(y),downloadState:x.key};y.channel&&(M=y.channel.offlineChannelData,r=cS6(g.Ky(z,"ytMainChannelEntity"),M),k.channelOwner=r.id);((l=k)==null?0:l.entityMetadata)?(k.entityMetadata.offlineLastModifiedTimestampSeconds=y.lastModifiedTimestamp,v&&(k.entityMetadata.nextAutoRefreshIntervalSeconds=String(v))):k&&(k.entityMetadata={nextAutoRefreshIntervalSeconds:v?
String(v):void 0,offlineLastModifiedTimestampSeconds:y.lastModifiedTimestamp});g.Rx(H,2);return g.L(H,Ci(p.C,{mode:"readwrite",K_:!0},function(h){var X=UG(h,k,"mainPlaylistEntity"),V=UG(h,x,"mainPlaylistDownloadStateEntity");X=[X,V];V=g.c(f);for(var WR=V.next();!WR.done;WR=V.next())X.push(UG(h,WR.value,"mainPlaylistVideoEntity"));r&&X.push(UG(h,r,"ytMainChannelEntity"));return g.YB.all(X)}),4);
case 4:g.rQ(H,3);break;case 2:throw g.kx(H),W7("PES failure for playlist"),Error("PES failure for playlist");case 3:return H.return({mainPlaylistEntity:k,SXR:r,GUI:f})}})},cS6=function(p,y){return{id:p,
channelId:y.channelId,title:y.title,avatar:y.thumbnail}},JSF=function(p){var y=[],O=p.videos;
O&&O.length>0&&y.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_FIRST_VIDEO"),value:{collageThumbnail:{coverThumbnail:O[0].offlineVideoData.thumbnail}}});if((p=p.additionalMetadadatas)&&p.length>0)for(p=g.c(p),O=p.next();!O.done;O=p.next()){var v=O.value.offlineBundleItemPlaylistData,W=void 0;O=(W=v)==null?void 0:W.style;W=void 0;v={collageThumbnail:{coverThumbnail:(W=v)==null?void 0:W.coverThumbnail}};switch(O){case "BUNDLE_ITEM_STYLE_UNSPECIFIED":y.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_UNKNOWN"),
value:v});break;case "BUNDLE_ITEM_STYLE_TWO_BY_TWO":y.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_TWO_BY_TWO"),value:v});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO_AVATAR":y.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO_AVATAR"),value:v});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO":y.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO"),value:v})}}return y},K8_=function(p){switch(p.privacy){case "PRIVATE":return"PLAYLIST_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_VISIBILITY_UNLISTED";default:return"PLAYLIST_VISIBILITY_UNKNOWN"}},QAF=function(p,y,O){y={offlineVideoData:y,
playlistId:O};if(p=g.F(p.actionMetadata,SFK))y.maximumDownloadQuality=p.maximumDownloadQuality;return{mainVideoEntityActionMetadata:y}},RjF=function(p,y,O){this.C=p;
this.I_=y;this.J=O},rSS=function(p,y){var O,v,W,E,z,f,n,Q,q,S,N,P,u;
return g.w(function(R){switch(R.T){case 1:return O=fI(y),v=g.JK(y.entityKey),W=v.entityId,E=g.F(y.actionMetadata,CI),f=!((z=E)==null?0:z.playlistId),g.Rx(R,2),g.L(R,$K6(p,W,void 0,(n=E)==null?void 0:n.offlineVideoData,f),4);case 4:g.rQ(R,3);break;case 2:return Q=g.kx(R),q="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",S="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",Q instanceof g.sN&&Q.type==="QUOTA_EXCEEDED"&&(q="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",S="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
R.return(new lw("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",O,void 0,q,S));case 3:N=1;N=Number(((P=y.actionMetadata)==null?void 0:P.priority)||0)+1;var r=(r=g.F(y.actionMetadata,CI))?{playbackDataActionMetadata:{maximumDownloadQuality:r.maximumDownloadQuality}}:void 0;u=LI("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",W,"playbackData",N,sAK,r);return R.return(new lw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",O,[u]))}})},amF=function(p,y){var O,v,W,E,z,f,n,Q,q,S,N,P,u,R,r,x,k;
return g.w(function(M){switch(M.T){case 1:return O=fI(y),v=g.JK(y.entityKey),W=v.entityId,g.L(M,V6(p.C,y.entityKey,"mainVideoEntity"),2);case 2:E=M.C;if(!E){z=void 0;M.W2(3);break}return g.L(M,V6(p.C,E.downloadState,"mainVideoDownloadStateEntity"),4);case 4:z=M.C;case 3:f=z;if(!E||!f)return M.return(new lw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",O));g.Rx(M,5);return g.L(M,$K6(p,W,f.addedTimestampMillis,(Q=g.F(y.actionMetadata,CI))==null?void 0:Q.offlineVideoData),7);case 7:q=1;q=Number(((S=
y.actionMetadata)==null?void 0:S.priority)||0)+1;n=LI("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",W,"playbackData",q,sAK);g.rQ(M,6);break;case 5:N=g.kx(M);if(!(N instanceof Error&&N.message==="No data")){if(N instanceof Error&&N.message==="Empty response body")W7(N.message);else return P="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",u="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",N instanceof g.sN&&N.type==="QUOTA_EXCEEDED"&&(P="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
u="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),M.return(new lw("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",O,void 0,P,u));M.W2(6);break}return g.L(M,a8(p.C,W),9);case 9:R=M.C;r=g.F(y.actionMetadata,CI);if(k=(x=r)==null?void 0:x.playlistId)R.playlistId=k;R.offlineDeleteReason="OFFLINE_DELETE_REASON_UNAVAILABLE";return g.L(M,sn(W,p.C,y,p.J,R),6);case 6:return M.return(new lw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",O,n?[n]:void 0))}})},ki_=function(p,y){var O,v,W,E,z,f,n,Q,q,S;
return g.w(function(N){switch(N.T){case 1:return O=fI(y),g.Rx(N,2),v=g.JK(y.entityKey).entityId,v==="!*$_ALL_ENTITIES_!*$"?g.L(N,GlA(p.C,y,p.J,(q=y.actionMetadata)==null?void 0:(S=q.offlineLoggingData)==null?void 0:S.offlineDeleteReason),5):g.L(N,a8(p.C,v),6);case 6:W=N.C;E=g.F(y.actionMetadata,CI);if(f=(z=E)==null?void 0:z.playlistId)W.playlistId=f;W.offlineDeleteReason=(n=y.actionMetadata)==null?void 0:(Q=n.offlineLoggingData)==null?void 0:Q.offlineDeleteReason;return g.L(N,sn(v,p.C,y,p.J,W),7);
case 7:if(!p.I_.K("woffle_enable_main_downloads_library")){N.W2(5);break}return g.L(N,NxY(p.C,y.entityKey),5);case 5:g.rQ(N,3);break;case 2:return g.kx(N),N.return(new lw("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",O,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return N.return(new lw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",O))}})},$K6=function(p,y,O,v,W){var E,z,f,n,Q,q;
return g.w(function(S){switch(S.T){case 1:if(E=v){S.W2(2);break}return g.L(S,a$$([y]),3);case 3:z=S.C,E=z[0];case 2:return g.L(S,xKK(p,E,O,W),4);case 4:f=S.C;n=f.mainVideoEntity;Q=f.channelEntity;g.Rx(S,5);var N=uw(n.thumbnail),P=uw(Q.avatar);return g.L(S,$r(N.concat(P)),7);case 7:g.rQ(S,0);break;case 5:q=g.kx(S),q instanceof Error&&q.message==="Failed to fetch"&&W7(q.message),g.cR(S)}})},xKK=function(p,y,O,v){var W,E,z,f,n,Q,q,S,N,P,u,R,r;
return g.w(function(x){switch(x.T){case 1:O||(O=Date.now().toString());E=(W=y.channel)==null?void 0:W.offlineChannelData;z={id:g.Ky(y.videoId,"ytMainChannelEntity"),channelId:E.channelId,title:E.title,avatar:E.thumbnail};f={key:g.Ky(y.videoId,"mainVideoDownloadStateEntity"),playbackData:g.Ky(y.videoId,"playbackData"),addedTimestampMillis:O,videoDownloadContextEntity:g.Ky(y.videoId,"videoDownloadContextEntity")};n={key:g.Ky(y.videoId,"videoPlaybackPositionEntity"),videoId:y.videoId,lastPlaybackPositionSeconds:"0"};
p.I_.K("html5_offline_playback_position_sync")&&(Q={playbackPosition:n.key});q=g.Ky(y.videoId,"mainVideoEntity");S={key:q,videoId:y.videoId,title:y.title,thumbnail:y.thumbnail,localizedStrings:{viewCount:y.shortViewCountText},userState:Q,lengthSeconds:y.lengthSeconds?Number(y.lengthSeconds):void 0,publishedTimestampMillis:y.publishedTimestamp?(Number(y.publishedTimestamp)*1E3).toString():void 0,formattedDescription:y.description,owner:z.id,downloadState:f.key};if(!p.I_.K("woffle_enable_main_downloads_library")||
!v){x.W2(2);break}return g.L(x,q2Y(p.C,[q]),3);case 3:if(u=x.C)N=u.mainDownloadsLibraryEntity,P=u.mainDownloadsListEntity;case 2:return r=VuL,R={key:g.Ky(y.videoId,"downloadStatusEntity"),downloadState:"DOWNLOAD_STATE_PENDING_DOWNLOAD"},g.hT(f,r,R),g.L(x,Ci(p.C,{mode:"readwrite",K_:!0},function(k){var M=UG(k,z,"ytMainChannelEntity"),l=UG(k,f,"mainVideoDownloadStateEntity"),H=UG(k,S,"mainVideoEntity");M=[M,l,H];p.I_.K("html5_offline_playback_position_sync")&&(l=UG(k,n,"videoPlaybackPositionEntity"),
M.push(l));N&&(l=UG(k,N,"mainDownloadsLibraryEntity"),M.push(l));P&&(l=UG(k,P,"mainDownloadsListEntity"),M.push(l));R&&(k=UG(k,R,"downloadStatusEntity"),M.push(k));return g.YB.all(M)}),4);
case 4:return x.return({mainVideoEntity:S,channelEntity:z})}})},T7L=function(p,y,O){this.C=p;
this.I_=y;this.J=O},YFF=function(p,y){var O,v,W,E,z,f,n,Q,q,S,N,P,u,R,r,x,k,M,l,H,h,X,V,WR,O4,E4,b;
return g.w(function(PR){switch(PR.T){case 1:return O=fI(y),v=[],g.L(PR,Ha.getInstance(),2);case 2:W=PR.C;if(!W){PR.W2(3);break}return g.L(PR,W.get("sdois"),4);case 4:return E=PR.C,g.L(PR,(f=W)==null?void 0:f.get("lmqf"),5);case 5:z=PR.C;case 3:g.Rx(PR,6);if(E===void 0)throw Error("prefStorage or opt-in state is undefined");n=[];if(E){PR.W2(8);break}return g.L(PR,Q4F(p.C),9);case 9:n=PR.C,n.reverse();case 8:if(!n.length){PR.W2(10);break}Q=g.c(n);q=Q.next();case 11:if(q.done){PR.W2(10);break}S=q.value;
if(!S){PR.W2(12);break}N=g.JK(S).entityId;return g.L(PR,a8(p.C,N),14);case 14:return P=PR.C,P.offlineDeleteReason="OFFLINE_DELETE_REASON_PARENT_LIST_DELETE",g.L(PR,sn(N,p.C,{entityKey:S,actionType:y.actionType},p.J,P),12);case 12:q=Q.next();PR.W2(11);break;case 10:return g.L(PR,Y2h(E,(u=z)!=null?u:"SD"),16);case 16:return R=PR.C,g.L(PR,oTU(R),17);case 17:r=nT_(R);if(!p.I_.K("woffle_enable_main_downloads_library")){PR.W2(18);break}if(E){PR.W2(19);break}return g.L(PR,NxY(p.C,g.mY),19);case 19:return g.L(PR,
S2L(p.C,[g.mY]),18);case 18:if((x=r)==null?0:x.length)for(k=g.c(r),M=k.next();!M.done;M=k.next())if(H=l=M.value,h=H.actionType,X=H.entityKey,V=H.actionMetadata,h&&X&&V&&!g.F(V,tXF)){h==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(V.offlineLoggingData={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});if(WR=g.F(l.actionMetadata,CI))WR.playlistId="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS",l.actionMetadata=Object.assign({},l.actionMetadata,{mainVideoEntityActionMetadata:WR});v.push(l)}g.rQ(PR,
7);break;case 6:return O4=g.kx(PR),E4="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",b="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",O4 instanceof g.sN&&O4.type==="QUOTA_EXCEEDED"&&(E4="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",b="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),PR.return(new lw("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",O,void 0,E4,b));case 7:return PR.return(new lw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",O,v))}})},MXh=function(){jG.apply(this,
arguments);
this.V="mainVideoEntity"},Z8K=function(p,y,O){y=y===void 0?43200:y;
O=O===void 0?!0:O;var v=v===void 0?!1:v;var W,E,z;return g.w(function(f){switch(f.T){case 1:if(!p.G.Az())return f.return([]);W=[];g.Rx(f,2);return g.L(f,TxA(y,O,v),4);case 4:W=f.C;g.rQ(f,3);break;case 2:E=g.kx(f),E instanceof Error&&E.message==="No data"||E instanceof Error&&E.message==="Empty response body"&&W7(E.message);case 3:return z=Gie(p,W,O,"mainPlaylistEntity"),f.return(z)}})},L86=function(p,y,O,v){v=v===void 0?!1:v;
var W,E,z,f,n,Q,q,S,N,P,u,R,r,x,k;return g.w(function(M){switch(M.T){case 1:return W=[],g.L(M,teX(),2);case 2:return(E=M.C)||v?g.L(M,MeF(y,O),3):M.return([]);case 3:z=M.C;if((f=z)==null||!f.length)return M.return([]);n={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"};Q=g.c(z);q=Q.next();case 4:if(q.done){M.W2(6);break}N=S=q.value;P=N.actionType;u=N.entityKey;R=N.actionMetadata;if(!(P&&u&&R)||g.F(R,tXF)){M.W2(5);break}P==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(R.offlineLoggingData=
n);r=g.JK(u);x=r.entityId;return g.L(M,hs(p,[x],"mainVideoEntity",P,R),8);case 8:k=M.C,W=W.concat(k);case 5:q=Q.next();M.W2(4);break;case 6:return M.return(W)}})},lmF=function(p,y){this.C=p;
this.J=y},mKe=function(p,y){var O,v,W,E,z,f,n,Q,q,S,N,P,u,R,r,x;
return g.w(function(k){switch(k.T){case 1:return O=fI(y),v=g.JK(y.entityKey),W=v.entityId,E=[],g.Rx(k,2),g.L(k,wn6(p,W),4);case 4:E=k.C;if((z=E)==null||!z.length){k.W2(5);break}return g.L(k,c_X(p.C,y.entityKey),5);case 5:g.rQ(k,3);break;case 2:return f=g.kx(k),n="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Q="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",f instanceof g.sN&&f.type==="QUOTA_EXCEEDED"&&(n="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",Q="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
k.return(new lw("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",O,void 0,n,Q));case 3:return q=[],g.L(k,AAh(p.C,"musicTrack",E),7);case 7:E=k.C;if(E.length)for(S=g.c(E),N=S.next();!N.done;N=S.next())if(P=N.value,u=P.offlineVideoData,R=void 0,(R=u)==null?0:R.videoId)r=void 0,x=Number(((r=y.actionMetadata)==null?void 0:r.priority)||0)+1,q.push(LI("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",u.videoId,"musicTrack",x,DV,ts(y,u,W)));return k.return(new lw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",O,q))}})},
dKL=function(p,y){var O,v,W,E,z,f,n,Q,q,S,N,P,u,R,r,x,k,M,l,H,h,X,V,WR,O4,E4,b,PR,xx,U4,rF,GL,T0,ax,O_,a,G0,U_,$C,tI,QU,HR,lY,Y6,t,Y,Z,m,e,s4,yM,JQ,vR,Yx,CK,$6,sl,lg,pm;
return g.w(function(hn){switch(hn.T){case 1:return O=fI(y),v=y.entityKey,W=g.JK(v).entityId,E=[],z=!1,W==="!*$_ALL_ENTITIES_!*$"?(z=!0,g.L(hn,A6(p.C,"musicAlbumRelease"),5)):g.L(hn,V6(p.C,v,"musicAlbumRelease"),4);case 4:(f=hn.C)&&E.push(f);hn.W2(3);break;case 5:E=hn.C;case 3:if((n=E)==null||!n.length)return hn.return(new lw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",O));if(z){Q=[];q=g.c(E);for(S=q.next();!S.done;S=q.next())N=S.value,P=g.JK(N.id).entityId,Q.push(LI("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
P,"musicAlbumRelease",0,DV));return hn.return(new lw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",O,Q))}u=[];R=E[0];r=void 0;if(!R.downloadMetadata){hn.W2(6);break}return g.L(hn,V6(p.C,R.downloadMetadata,"musicAlbumReleaseDownloadMetadataEntity"),7);case 7:x=hn.C,r=Number((M=(k=x)==null?void 0:k.addedTimestampMillis)!=null?M:"0")/1E3;case 6:return g.Rx(hn,8),g.L(hn,wn6(p,W,(l=r)==null?void 0:l.toString()),10);case 10:u=hn.C;g.rQ(hn,9);break;case 8:H=g.kx(hn);if(!(H instanceof Error&&H.message===
"No data")){if(H instanceof Error&&H.message==="Empty response body")W7(H.message);else return h="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",X="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",H instanceof g.sN&&H.type==="QUOTA_EXCEEDED"&&(h="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",X="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),hn.return(new lw("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",O,void 0,h,X));hn.W2(9);break}return g.L(hn,xr(W,"musicAlbumRelease",p.C,
y,p.J),9);case 9:V=[];WR=new Map;if((O4=u)==null?0:O4.length)for(E4=g.c(u),b=E4.next();!b.done;b=E4.next())PR=b.value,xx=PR.offlineVideoData,U4=void 0,((U4=xx)==null?0:U4.videoId)&&WR.set(xx.videoId,xx);rF=new Map;GL=[];if((T0=R)==null?0:(ax=T0.tracks)==null?0:ax.length)for(O_=g.c(R.tracks),a=O_.next();!a.done;a=O_.next())if(G0=a.value,U_=g.JK(G0).entityId)WR.has(U_)?(rF.set(U_,WR.get(U_)),WR.delete(U_)):GL.push(U_);tI=Number((($C=y.actionMetadata)==null?void 0:$C.priority)||0)+1;QU=g.c(WR.entries());
for(HR=QU.next();!HR.done;HR=QU.next())lY=HR.value,Y6=g.c(lY),t=Y6.next().value,Y=Y6.next().value,Z=t,m=Y,V.push(LI("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",Z,"musicTrack",tI,DV,ts(y,m)));e=g.c(rF.entries());for(s4=e.next();!s4.done;s4=e.next())yM=s4.value,JQ=g.c(yM),vR=JQ.next().value,Yx=JQ.next().value,CK=vR,$6=Yx,V.push(LI("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",CK,"musicTrack",tI,DV,ts(y,$6)));sl=g.c(GL);for(lg=sl.next();!lg.done;lg=sl.next())pm=lg.value,V.push(LI("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
pm,"musicTrack",0,DV));return hn.return(new lw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",O,V))}})},B7L=function(p,y){var O,v;
return g.w(function(W){switch(W.T){case 1:return O=fI(y),g.Rx(W,2),v=g.JK(y.entityKey).entityId,v==="!*$_ALL_ENTITIES_!*$"?g.L(W,Tv(p.C,y,p.J),5):g.L(W,xr(v,"musicAlbumRelease",p.C,y,p.J),6);case 6:return g.L(W,Rq6(p.C,y.entityKey),5);case 5:g.rQ(W,3);break;case 2:return g.kx(W),W.return(new lw("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",O,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return W.return(new lw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
O))}})},wn6=function(p,y,O){var v,W,E;
return g.w(function(z){switch(z.T){case 1:return g.L(z,klL([y]),2);case 2:return v=z.C,g.L(z,H8F(p,v[0],O),3);case 3:return W=z.C,E=uw(W.thumbnailDetails),g.L(z,$r(E),4);case 4:return z.return(v[0].videos)}})},H8F=function(p,y,O){var v,W,E,z,f,n,Q,q,S,N,P,u,R,r;
return g.w(function(x){if(x.T==1){v=y.additionalMetadadatas;W=void 0;if(v&&v.length>0)for(E=g.c(v),z=E.next();!z.done;z=E.next())if(f=z.value,f.offlineMusicPlaylistData){W=f.offlineMusicPlaylistData;break}n=y.playlistId;Q=$yh(y);q=Q.TI;S=Q.Po;N=O?(Number(O)*1E3).toString():Date.now().toString();P=y.lastModifiedTimestamp?(Number(y.lastModifiedTimestamp)*1E3).toString():"0";u={id:g.Ky(n,"musicAlbumReleaseDownloadMetadataEntity"),trackDownloadMetadatas:S,lastModifiedTimestampMillis:P,addedTimestampMillis:N,
syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"};R={id:g.Ky(n,"musicAlbumRelease"),title:y.title,audioPlaylistId:n,trackCount:y.totalVideoCount,tracks:q,downloadMetadata:u.id};W&&(R.thumbnailDetails=(r=W.albumHqThumbnail)!=null?r:W.albumArtistThumbnail,R.artistDisplayName=W.albumArtistDisplayName,R.releaseDate=W.albumReleaseDate,R.contentRating={explicitType:W.albumReleaseExplicitType},R.releaseType=W.albumReleaseType);return g.L(x,Ci(p.C,{mode:"readwrite",K_:!0},function(k){var M=UG(k,R,"musicAlbumRelease");
k=UG(k,u,"musicAlbumReleaseDownloadMetadataEntity");return g.YB.all([M,k])}),2)}return x.return(R)})},i8F=function(p,y){this.C=p;
this.J=y},Im$=function(p,y){var O,v,W,E,z,f,n,Q,q,S,N,P,u,R,r,x;
return g.w(function(k){switch(k.T){case 1:return O=fI(y),v=g.JK(y.entityKey),W=v.entityId,E=[],g.Rx(k,2),g.L(k,F8F(p,W),4);case 4:E=k.C;if((z=E)==null||!z.length){k.W2(5);break}return g.L(k,c_X(p.C,y.entityKey),5);case 5:g.rQ(k,3);break;case 2:return f=g.kx(k),n="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Q="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",f instanceof g.sN&&f.type==="QUOTA_EXCEEDED"&&(n="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",Q="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
k.return(new lw("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",O,void 0,n,Q));case 3:return q=[],g.L(k,AAh(p.C,"musicTrack",E),7);case 7:E=k.C;if(E.length)for(S=g.c(E),N=S.next();!N.done;N=S.next())if(P=N.value,u=P.offlineVideoData,R=void 0,(R=u)==null?0:R.videoId)r=void 0,x=Number(((r=y.actionMetadata)==null?void 0:r.priority)||0)+1,q.push(LI("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",u.videoId,"musicTrack",x,VX,ts(y,u,W)));return k.return(new lw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",O,q))}})},
ej_=function(p,y){var O,v,W,E,z,f,n,Q,q,S,N,P,u,R,r,x,k,M,l,H,h,X,V,WR,O4,E4,b,PR,xx,U4,rF,GL,T0,ax,O_,a,G0,U_,$C,tI,QU,HR,lY,Y6,t,Y,Z,m,e,s4,yM,JQ,vR,Yx,CK,$6,sl,lg,pm,hn,y0,aD,Pz,ms,Jt,dh,j2,hy,Zi,ES,O0;
return g.w(function(zB){switch(zB.T){case 1:return O=fI(y),v=y.entityKey,W=g.JK(v).entityId,E=[],z=!1,W==="!*$_ALL_ENTITIES_!*$"?(z=!0,g.L(zB,A6(p.C,"musicPlaylist"),5)):g.L(zB,V6(p.C,v,"musicPlaylist"),4);case 4:(f=zB.C)&&E.push(f);zB.W2(3);break;case 5:E=zB.C;case 3:if((n=E)==null||!n.length)return zB.return(new lw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",O));Q=g.F(y.actionMetadata,s4A);S=(q=Q)==null?void 0:q.autoSync;N=[];u=P=!0;R=!1;r=void 0;if(!z&&S===!1){zB.W2(6);break}g.Rx(zB,7);return g.L(zB,
ZTF(0,!!S,!0,E),9);case 9:N=zB.C;g.rQ(zB,8);break;case 7:x=g.kx(zB);if(!(x instanceof Error&&x.message==="No data")){x instanceof Error&&x.message==="Empty response body"&&W7(x.message);zB.W2(8);break}return W==="!*$_ALL_ENTITIES_!*$"?g.L(zB,Tv(p.C,y,p.J),8):g.L(zB,xr(W,"musicPlaylist",p.C,y,p.J),8);case 8:if(!N.length||!z&&N[0].playlistId!==W)return zB.return(new lw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",O));case 6:if(z){k=[];M=g.c(N);for(l=M.next();!l.done;l=M.next())H=l.value,H.upToDate||
S&&!H.shouldAutoSyncMetadata||!H.playlistId||(h={autoSync:S},k.push(LI("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",H.playlistId,"musicPlaylist",0,VX,{musicPlaylistEntityActionMetadata:h})));return zB.return(new lw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",O,k))}N.length&&(X=N[0],R=!!X.upToDate,S&&(P=(V=X.shouldAutoSyncMetadata)!=null?V:!0,u=(WR=X.shouldAutoSyncVideos)!=null?WR:!0,X.checkInSeconds&&(r=X.checkInSeconds)));if(R||!P)return zB.return(new lw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
O));O4=[];E4=E[0];b=void 0;if(!E4.downloadMetadata){zB.W2(15);break}return g.L(zB,V6(p.C,E4.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),16);case 16:PR=zB.C,b=Number((U4=(xx=PR)==null?void 0:xx.addedTimestampMillis)!=null?U4:"0")/1E3;case 15:return g.Rx(zB,17),g.L(zB,F8F(p,W,(rF=b)==null?void 0:rF.toString(),r),19);case 19:O4=zB.C;g.rQ(zB,18);break;case 17:GL=g.kx(zB);if(!(GL instanceof Error&&GL.message==="No data")){if(GL instanceof Error&&GL.message==="Empty response body")W7(GL.message);
else return T0="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",ax="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",GL instanceof g.sN&&GL.type==="QUOTA_EXCEEDED"&&(T0="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",ax="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),zB.return(new lw("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",O,void 0,T0,ax));zB.W2(18);break}return g.L(zB,xr(W,"musicPlaylist",p.C,y,p.J),18);case 18:if(!u)return zB.return(new lw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
O));O_=[];a=new Map;if((G0=O4)==null?0:G0.length)for(U_=g.c(O4),$C=U_.next();!$C.done;$C=U_.next())tI=$C.value,QU=tI.offlineVideoData,HR=void 0,((HR=QU)==null?0:HR.videoId)&&a.set(QU.videoId,QU);lY=new Map;Y6=[];if((t=E4)==null?0:(Y=t.tracks)==null?0:Y.length)for(Z=g.c(E4.tracks),m=Z.next();!m.done;m=Z.next())if(e=m.value,s4=g.JK(e).entityId)a.has(s4)?(lY.set(s4,a.get(s4)),a.delete(s4)):Y6.push(s4);JQ=Number(((yM=y.actionMetadata)==null?void 0:yM.priority)||0)+1;vR=g.c(a.entries());for(Yx=vR.next();!Yx.done;Yx=
vR.next())CK=Yx.value,$6=g.c(CK),sl=$6.next().value,lg=$6.next().value,pm=sl,hn=lg,O_.push(LI("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",pm,"musicTrack",JQ,VX,ts(y,hn)));y0=g.c(lY.entries());for(aD=y0.next();!aD.done;aD=y0.next())Pz=aD.value,ms=g.c(Pz),Jt=ms.next().value,dh=ms.next().value,j2=Jt,hy=dh,O_.push(LI("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",j2,"musicTrack",JQ,VX,ts(y,hy)));Zi=g.c(Y6);for(ES=Zi.next();!ES.done;ES=Zi.next())O0=ES.value,O_.push(LI("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
O0,"musicTrack",0,VX));return zB.return(new lw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",O,O_))}})},XnY=function(p,y){var O,v;
return g.w(function(W){switch(W.T){case 1:return O=fI(y),g.Rx(W,2),v=g.JK(y.entityKey).entityId,v==="!*$_ALL_ENTITIES_!*$"?g.L(W,Tv(p.C,y,p.J),5):g.L(W,xr(v,"musicPlaylist",p.C,y,p.J),6);case 6:return g.L(W,Rq6(p.C,y.entityKey),5);case 5:g.rQ(W,3);break;case 2:return g.kx(W),W.return(new lw("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",O,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return W.return(new lw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
O))}})},F8F=function(p,y,O,v){var W,E,z;
return g.w(function(f){switch(f.T){case 1:return g.L(f,klL([y]),2);case 2:return W=f.C,g.L(f,UKY(p,W[0],O,v),3);case 3:return E=f.C,z=uw(E.thumbnailDetails),g.L(f,$r(z),4);case 4:return f.return(W[0].videos)}})},UKY=function(p,y,O,v){var W,E,z,f,n,Q,q,S,N;
return g.w(function(P){return P.T==1?(W=y.playlistId,E=$yh(y),z=E.TI,f=E.Po,n=O?(Number(O)*1E3).toString():Date.now().toString(),Q=y.lastModifiedTimestamp?(Number(y.lastModifiedTimestamp)*1E3).toString():"0",q={id:g.Ky(W,"musicPlaylistDownloadMetadataEntity"),trackDownloadMetadatas:f,lastModifiedTimestampMillis:Q,addedTimestampMillis:n,syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"},S={id:g.Ky(W,"musicPlaylist"),title:y.title,playlistId:W,thumbnailDetails:y.thumbnail,visibility:jAh(y),trackCount:y.totalVideoCount,
tracks:z,downloadMetadata:q.id},v&&(((N=S)==null?0:N.entityMetadata)?S.entityMetadata.nextAutoRefreshIntervalSeconds=String(v):S&&(S.entityMetadata={nextAutoRefreshIntervalSeconds:String(v)})),g.L(P,Ci(p.C,{mode:"readwrite",K_:!0},function(u){var R=UG(u,S,"musicPlaylist");u=UG(u,q,"musicPlaylistDownloadMetadataEntity");return g.YB.all([R,u])}),2)):P.return(S)})},jAh=function(p){switch(p.privacy){case "PRIVATE":return"PLAYLIST_ENTITY_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_ENTITY_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_ENTITY_VISIBILITY_UNLISTED";default:return"PLAYLIST_ENTITY_VISIBILITY_UNKNOWN"}},hjA=function(p,y){this.C=p;
this.J=y},VX6=function(p,y){var O,v,W,E,z,f,n,Q,q,S,N,P,u;
return g.w(function(R){switch(R.T){case 1:return O=fI(y),v=g.JK(y.entityKey),W=v.entityId,E=g.F(y.actionMetadata,b8L),g.Rx(R,2),g.L(R,C9Y(p,W,void 0,(z=E)==null?void 0:z.track,(f=E)==null?void 0:f.albumRelease),4);case 4:if((n=E)==null?0:n.playlistId){R.W2(5);break}return g.L(R,c_X(p.C,y.entityKey),5);case 5:g.rQ(R,3);break;case 2:return Q=g.kx(R),q="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",S="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",Q instanceof g.sN&&Q.type==="QUOTA_EXCEEDED"&&
(q="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",S="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),R.return(new lw("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",O,void 0,q,S));case 3:P=Number(((N=y.actionMetadata)==null?void 0:N.priority)||0)+1;var r=(r=g.F(y.actionMetadata,b8L))?{playbackDataActionMetadata:{maximumDownloadQuality:r.maximumDownloadQuality}}:void 0;u=LI("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",W,"playbackData",P,DKU,r);return R.return(new lw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
O,[u]))}})},ASY=function(p,y){var O,v,W,E,z,f,n,Q,q,S,N,P,u,R,r;
return g.w(function(x){switch(x.T){case 1:return O=fI(y),v=g.JK(y.entityKey),W=v.entityId,g.L(x,V6(p.C,y.entityKey,"musicTrack"),2);case 2:E=x.C;if(!E){z=void 0;x.W2(3);break}return g.L(x,V6(p.C,E.downloadMetadata,"musicTrackDownloadMetadataEntity"),4);case 4:z=x.C;case 3:f=z;if(!E||!f)return x.return(new lw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",O));Q=g.F(y.actionMetadata,b8L);g.Rx(x,5);return g.L(x,C9Y(p,W,f.addedTimestampMillis,(q=Q)==null?void 0:q.track,(S=Q)==null?void 0:S.albumRelease),
7);case 7:P=Number(((N=y.actionMetadata)==null?void 0:N.priority)||0)+1;n=LI("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",W,"playbackData",P,DKU);g.rQ(x,6);break;case 5:u=g.kx(x);if(!(u instanceof Error&&u.message==="No data")){if(u instanceof Error&&u.message==="Empty response body")W7(u.message);else return R="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",r="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",u instanceof g.sN&&u.type==="QUOTA_EXCEEDED"&&(R="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
r="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),x.return(new lw("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",O,void 0,R,r));x.W2(6);break}return g.L(x,kr(W,p.C,y,p.J),6);case 6:return x.return(new lw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",O,n?[n]:void 0))}})},pfY=function(p,y){var O,v;
return g.w(function(W){switch(W.T){case 1:return O=fI(y),g.Rx(W,2),v=g.JK(y.entityKey).entityId,v==="!*$_ALL_ENTITIES_!*$"?g.L(W,Tv(p.C,y,p.J),5):g.L(W,kr(v,p.C,y,p.J),6);case 6:return g.L(W,Rq6(p.C,y.entityKey),5);case 5:g.rQ(W,3);break;case 2:return g.kx(W),W.return(new lw("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",O,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return W.return(new lw("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
O))}})},C9Y=function(p,y,O,v,W){var E,z,f,n,Q,q;
return g.w(function(S){switch(S.T){case 1:if(E=v){S.W2(2);break}return g.L(S,a$$([y]),3);case 3:z=S.C,f=z[0],E=K5F(f);case 2:return g.L(S,yUL(p,E,y,W,O),4);case 4:n=S.C;Q=n.musicTrackEntity;q=n.ZX;var N=uw(Q.thumbnailDetails),P=[];q&&(P=uw(q.thumbnailDetails));return g.L(S,$r(N.concat(P)),0)}})},yUL=function(p,y,O,v,W){var E;
return g.w(function(z){return z.T==1?(W||(W=Date.now().toString()),E={id:g.Ky(O,"musicTrackDownloadMetadataEntity"),playbackData:g.Ky(O,"playbackData"),addedTimestampMillis:W,videoDownloadContextEntity:g.Ky(O,"videoDownloadContextEntity")},v&&(y.albumRelease=v.id),g.L(z,Ci(p.C,{mode:"readwrite",K_:!0},function(f){var n=[],Q=UG(f,E,"musicTrackDownloadMetadataEntity");n.push(Q);Q=UG(f,y,"musicTrack");n.push(Q);v&&(f=UG(f,v,"musicAlbumRelease"),n.push(f));return g.YB.all(n)}),2)):z.T!=3?g.L(z,SG(O,"musicTrackDownloadMetadataEntity",
p.C,"DOWNLOAD_STATE_PENDING_DOWNLOAD"),3):z.return({musicTrackEntity:y,
ZX:v})})},As=function(){jG.apply(this,arguments);
this.V="musicTrack"},O5A=function(p,y,O){y=y===void 0?43200:y;
O=O===void 0?!0:O;var v=v===void 0?!1:v;var W,E;return g.w(function(z){switch(z.T){case 1:if(!p.G.Az())return z.return([]);W=[];g.Rx(z,2);return g.L(z,ZTF(y,O,v),4);case 4:W=z.C;g.rQ(z,3);break;case 2:g.kx(z);case 3:return E=Gie(p,W,O,"musicPlaylist"),z.return(E)}})},vLh=function(){g.Ru.apply(this,arguments);
var p=this;this.events=new g.hz(this);this.I_=this.player.X();this.Jn={VK2:function(){return p.C},
SR:function(){return p.SR()},
zY:function(y){return p.zY(y)}}},WXS=function(p){var y;
p=g.F((y=p.getWatchNextResponse())==null?void 0:y.currentVideoEndpoint,g.GR);if(p==null?0:p.playlistId)var O=p.playlistId;return O},gLX=function(p,y){var O,v,W,E;
return g.w(function(z){if(z.T==1){O=y.clientPlaybackNonce;v={cpn:O,offlineSourceVisualElement:g.tT(y.xs||"").getAsJson(),selectedOfflineMode:"OFFLINE_NOW",isPartialPlayback:!1};y.T&&(v.videoFmt=Number(y.T.itag));y.B&&(v.audioFmt=Number(y.B.itag));if((W=WXS(y))&&y.videoId){var f=y.videoId;f=W!=="PPSV"?Promise.resolve(!1):p.C.Dd(f);z=g.L(z,f,3)}else z=z.W2(2);return z}z.T!=2&&(E=z.C)&&(v.selectedOfflineMode="OFFLINE_MODE_TYPE_AUTO_OFFLINE");p.T=O;g.Pi("offlinePlaybackStarted",v);g.cR(z)})};
g.li.prototype.z6=g.gQ(45,function(p){return this.app.z6(p)});
g.J2.prototype.z6=g.gQ(44,function(p){return g.JaQ(this,9,p)});
g.K(ds,mi);g.z0.Object.defineProperties(ds.prototype,{entityMetadata:{configurable:!0,enumerable:!0,get:function(){return this.C.entityMetadata},
set:function(p){this.C.entityMetadata=p}}});
g.K(bjF,ds);bjF.prototype.T=function(){return[]};
g.K(CHS,ds);CHS.prototype.T=function(){return[]};
g.K(D3K,ds);D3K.prototype.T=function(){return[]};
g.K(V2Y,ds);V2Y.prototype.T=function(){return[]};
g.K(AyX,ds);AyX.prototype.T=function(){var p=[];this.C.alternateChannel&&p.push(this.C.alternateChannel);this.C.alternateChannelList&&p.push.apply(p,g.T(this.C.alternateChannelList));this.C.oneofChannelEntity&&p.push(this.C.oneofChannelEntity);return[].concat(g.T(new Set(p)))};
g.K(pt6,ds);pt6.prototype.T=function(){var p=[];this.C.entryCollection&&p.push(this.C.entryCollection);return[].concat(g.T(new Set(p)))};
g.K(yHF,mi);yHF.prototype.T=function(){var p=[];this.C.video&&p.push(this.C.video);return[].concat(g.T(new Set(p)))};
g.K(OYU,ds);OYU.prototype.T=function(){var p=[];this.C.parentPlaylist&&p.push(this.C.parentPlaylist);if(this.C.entries)for(var y=g.c(this.C.entries),O=y.next();!O.done;O=y.next())p.push.apply(p,g.T((new yHF(O.value)).T()));return[].concat(g.T(new Set(p)))};
g.K(v96,ds);v96.prototype.T=function(){var p=[];this.C.descriptionEntity&&p.push(this.C.descriptionEntity);this.C.creators&&p.push.apply(p,g.T(this.C.creators));this.C.theBiggestFan&&p.push(this.C.theBiggestFan);return[].concat(g.T(new Set(p)))};
g.K(WGI,ds);WGI.prototype.T=function(){return[]};
g.K(g9I,ds);g9I.prototype.T=function(){return[]};
g.K(E9L,ds);E9L.prototype.T=function(){return[]};
g.K(zPF,ds);zPF.prototype.T=function(){return[]};
g.K(GwF,ds);GwF.prototype.T=function(){return[]};
g.K(o9U,ds);o9U.prototype.T=function(){return[]};
g.K(fGh,ds);fGh.prototype.T=function(){return[]};
g.K(n9_,ds);n9_.prototype.T=function(){return[]};
g.K(Q0h,ds);Q0h.prototype.T=function(){return[]};
g.K(qMe,ds);qMe.prototype.T=function(){var p=[];this.C.downloadsList&&p.push(this.C.downloadsList);this.C.smartDownloadsList&&p.push(this.C.smartDownloadsList);this.C.recommendedDownloadsList&&p.push(this.C.recommendedDownloadsList);this.C.refresh&&p.push(this.C.refresh);return[].concat(g.T(new Set(p)))};
g.K(SMh,mi);SMh.prototype.T=function(){var p=[];this.C.video&&p.push(this.C.video);this.C.playlist&&p.push(this.C.playlist);this.C.videoItem&&p.push(this.C.videoItem);this.C.playlistItem&&p.push(this.C.playlistItem);return[].concat(g.T(new Set(p)))};
g.K(Ndh,ds);Ndh.prototype.T=function(){var p=[];this.C.refresh&&p.push(this.C.refresh);if(this.C.downloads)for(var y=g.c(this.C.downloads),O=y.next();!O.done;O=y.next())p.push.apply(p,g.T((new SMh(O.value)).T()));return[].concat(g.T(new Set(p)))};
g.K(PQF,ds);PQF.prototype.T=function(){var p=[];this.C.localImageEntities&&p.push.apply(p,g.T(this.C.localImageEntities));return[].concat(g.T(new Set(p)))};
g.K(ujY,ds);ujY.prototype.T=function(){var p=[];this.C.playbackData&&p.push(this.C.playbackData);this.C.localImageEntities&&p.push.apply(p,g.T(this.C.localImageEntities));this.C.videoDownloadContextEntity&&p.push(this.C.videoDownloadContextEntity);return[].concat(g.T(new Set(p)))};
g.K(JHF,ds);JHF.prototype.T=function(){return[]};
g.K(KGA,ds);KGA.prototype.T=function(){var p=[];this.C.fakeChildren&&p.push.apply(p,g.T(this.C.fakeChildren));return[].concat(g.T(new Set(p)))};
g.K(cHU,ds);cHU.prototype.T=function(){var p=[];this.C.video&&p.push(this.C.video);this.C.playbackData&&p.push(this.C.playbackData);this.C.offlineVideoPolicy&&p.push(this.C.offlineVideoPolicy);return[].concat(g.T(new Set(p)))};
g.K(RPI,ds);RPI.prototype.T=function(){return[]};
g.K($LY,ds);$LY.prototype.T=function(){var p=[];this.C.channelOwner&&p.push(this.C.channelOwner);this.C.videos&&p.push.apply(p,g.T(this.C.videos));this.C.collaboratorChannels&&p.push.apply(p,g.T(this.C.collaboratorChannels));this.C.downloadState&&p.push(this.C.downloadState);this.C.refresh&&p.push(this.C.refresh);return[].concat(g.T(new Set(p)))};
g.K(s0F,ds);s0F.prototype.T=function(){var p=[];this.C.video&&p.push(this.C.video);this.C.channelContributor&&p.push(this.C.channelContributor);return[].concat(g.T(new Set(p)))};
g.K(rHI,mi);rHI.prototype.T=function(){var p=[];this.C.localImageEntities&&p.push.apply(p,g.T(this.C.localImageEntities));this.C.videoDownloadContextEntity&&p.push(this.C.videoDownloadContextEntity);return[].concat(g.T(new Set(p)))};
g.K(aGK,mi);aGK.prototype.T=function(){var p=[];this.C.recommendedVideoMetadata&&p.push.apply(p,g.T((new rHI(this.C.recommendedVideoMetadata)).T()));return[].concat(g.T(new Set(p)))};
g.K(kw_,mi);kw_.prototype.T=function(){var p=[];this.C.playbackPosition&&p.push(this.C.playbackPosition);return[].concat(g.T(new Set(p)))};
g.K(xLA,ds);xLA.prototype.T=function(){var p=[];this.C.owner&&p.push(this.C.owner);this.C.downloadState&&p.push(this.C.downloadState);this.C.userState&&p.push.apply(p,g.T((new kw_(this.C.userState)).T()));this.C.additionalMetadata&&p.push.apply(p,g.T((new aGK(this.C.additionalMetadata)).T()));return[].concat(g.T(new Set(p)))};
g.K(TdU,ds);TdU.prototype.T=function(){var p=[];this.C.userChannelDetails&&p.push(this.C.userChannelDetails);return[].concat(g.T(new Set(p)))};
g.K(tBF,ds);tBF.prototype.T=function(){var p=[];this.C.channelOwner&&p.push(this.C.channelOwner);this.C.playbackPosition&&p.push(this.C.playbackPosition);this.C.localImageEntities&&p.push.apply(p,g.T(this.C.localImageEntities));this.C.downloadStatus&&p.push(this.C.downloadStatus);return[].concat(g.T(new Set(p)))};
g.K(YMY,ds);YMY.prototype.T=function(){return[]};
g.K(MB_,ds);MB_.prototype.T=function(){return[]};
g.K(ZYY,ds);ZYY.prototype.T=function(){return[]};
g.K(LGK,ds);LGK.prototype.T=function(){return[]};
g.K(lG_,ds);lG_.prototype.T=function(){return[]};
g.K(wtL,ds);wtL.prototype.T=function(){return[]};
g.K(mL6,ds);mL6.prototype.T=function(){return[]};
g.K(dLI,ds);dLI.prototype.T=function(){return[]};
g.K(BdA,ds);BdA.prototype.T=function(){return[]};
g.K(HYY,ds);HYY.prototype.T=function(){return[]};
g.K(iYX,ds);iYX.prototype.T=function(){return[]};
g.K(FGY,ds);FGY.prototype.T=function(){return[]};
g.K(IG_,ds);IG_.prototype.T=function(){var p=[];this.C.trackDownloadMetadatas&&p.push.apply(p,g.T(this.C.trackDownloadMetadatas));return[].concat(g.T(new Set(p)))};
g.K(eP$,ds);
eP$.prototype.T=function(){var p=[];this.C.downloadedTracks&&p.push.apply(p,g.T(this.C.downloadedTracks));this.C.smartDownloadedTracks&&p.push.apply(p,g.T(this.C.smartDownloadedTracks));this.C.downloadedEpisodes&&p.push.apply(p,g.T(this.C.downloadedEpisodes));this.C.downloadedAlbumReleases&&p.push.apply(p,g.T(this.C.downloadedAlbumReleases));this.C.smartDownloadedAlbumReleases&&p.push.apply(p,g.T(this.C.smartDownloadedAlbumReleases));this.C.downloadedPlaylists&&p.push.apply(p,g.T(this.C.downloadedPlaylists));this.C.smartDownloadedPlaylists&&
p.push.apply(p,g.T(this.C.smartDownloadedPlaylists));this.C.metadataOnlyTracks&&p.push.apply(p,g.T(this.C.metadataOnlyTracks));return[].concat(g.T(new Set(p)))};
g.K(XtF,ds);XtF.prototype.T=function(){var p=[];this.C.trackDownloadMetadatas&&p.push.apply(p,g.T(this.C.trackDownloadMetadatas));return[].concat(g.T(new Set(p)))};
g.K(UL6,ds);UL6.prototype.T=function(){var p=[];this.C.playbackData&&p.push(this.C.playbackData);this.C.localImageEntities&&p.push.apply(p,g.T(this.C.localImageEntities));this.C.videoDownloadContextEntity&&p.push(this.C.videoDownloadContextEntity);return[].concat(g.T(new Set(p)))};
g.K(j0Y,ds);j0Y.prototype.T=function(){var p=[];this.C.musicLibraryStatusEntity&&p.push(this.C.musicLibraryStatusEntity);this.C.primaryArtists&&p.push.apply(p,g.T(this.C.primaryArtists));this.C.details&&p.push(this.C.details);this.C.userDetails&&p.push(this.C.userDetails);this.C.tracks&&p.push.apply(p,g.T(this.C.tracks));this.C.share&&p.push(this.C.share);this.C.downloadMetadata&&p.push(this.C.downloadMetadata);this.C.refresh&&p.push(this.C.refresh);return[].concat(g.T(new Set(p)))};
g.K(hPU,ds);hPU.prototype.T=function(){var p=[];this.C.albumRelease&&p.push(this.C.albumRelease);this.C.tracks&&p.push.apply(p,g.T(this.C.tracks));return[].concat(g.T(new Set(p)))};
g.K(bYF,ds);bYF.prototype.T=function(){var p=[];this.C.albumRelease&&p.push(this.C.albumRelease);return[].concat(g.T(new Set(p)))};
g.K(CQY,ds);CQY.prototype.T=function(){var p=[];this.C.details&&p.push(this.C.details);this.C.userDetails&&p.push(this.C.userDetails);return[].concat(g.T(new Set(p)))};
g.K(DLL,ds);DLL.prototype.T=function(){var p=[];this.C.parentArtist&&p.push(this.C.parentArtist);return[].concat(g.T(new Set(p)))};
g.K(VBU,ds);VBU.prototype.T=function(){var p=[];this.C.parentArtist&&p.push(this.C.parentArtist);return[].concat(g.T(new Set(p)))};
g.K(AHh,ds);AHh.prototype.T=function(){return[]};
g.K(p_F,ds);p_F.prototype.T=function(){return[]};
g.K(ylI,mi);ylI.prototype.T=function(){var p=[];this.C.creatorEntity&&p.push(this.C.creatorEntity);return[].concat(g.T(new Set(p)))};
g.K(O1I,ds);
O1I.prototype.T=function(){var p=[];this.C.tracks&&p.push.apply(p,g.T(this.C.tracks));this.C.refresh&&p.push(this.C.refresh);this.C.musicLibraryStatusEntity&&p.push(this.C.musicLibraryStatusEntity);this.C.details&&p.push(this.C.details);this.C.downloadMetadata&&p.push(this.C.downloadMetadata);this.C.sideloadMetadata&&p.push(this.C.sideloadMetadata);this.C.userDetails&&p.push(this.C.userDetails);this.C.entryCollection&&p.push(this.C.entryCollection);this.C.share&&p.push(this.C.share);this.C.podcastShowAdditionalMetadata&&p.push.apply(p,
g.T((new ylI(this.C.podcastShowAdditionalMetadata)).T()));return[].concat(g.T(new Set(p)))};
g.K(vWK,ds);vWK.prototype.T=function(){return[]};
g.K(WqY,ds);
WqY.prototype.T=function(){var p=[];this.C.musicLibraryStatusEntity&&p.push(this.C.musicLibraryStatusEntity);this.C.artists&&p.push.apply(p,g.T(this.C.artists));this.C.audioModeVersion&&p.push(this.C.audioModeVersion);this.C.videoModeVersion&&p.push(this.C.videoModeVersion);this.C.userDetails&&p.push(this.C.userDetails);this.C.details&&p.push(this.C.details);this.C.albumRelease&&p.push(this.C.albumRelease);this.C.share&&p.push(this.C.share);this.C.libraryEdit&&p.push(this.C.libraryEdit);this.C.downloadMetadata&&
p.push(this.C.downloadMetadata);this.C.playbackPosition&&p.push(this.C.playbackPosition);this.C.lyrics&&p.push(this.C.lyrics);return[].concat(g.T(new Set(p)))};
g.K(gWA,ds);gWA.prototype.T=function(){var p=[];this.C.parentTrack&&p.push(this.C.parentTrack);return[].concat(g.T(new Set(p)))};
g.K(EWX,ds);EWX.prototype.T=function(){var p=[];this.C.parentTrack&&p.push(this.C.parentTrack);return[].concat(g.T(new Set(p)))};
g.K(zA6,ds);zA6.prototype.T=function(){return[]};
g.K(GXF,ds);GXF.prototype.T=function(){return[]};
g.K(oW6,ds);oW6.prototype.T=function(){return[]};
g.K(fEh,ds);fEh.prototype.T=function(){return[]};
g.K(nW6,ds);nW6.prototype.T=function(){var p=[];this.C.transfer&&p.push(this.C.transfer);this.C.adsPlaybackData&&p.push.apply(p,g.T(this.C.adsPlaybackData));this.C.drmLicense&&p.push(this.C.drmLicense);this.C.offlineVideoPolicy&&p.push(this.C.offlineVideoPolicy);this.C.videoDownloadContextEntity&&p.push(this.C.videoDownloadContextEntity);return[].concat(g.T(new Set(p)))};
g.K(QZS,ds);QZS.prototype.T=function(){return[]};
g.K(qDh,ds);qDh.prototype.T=function(){var p=[];this.C.offlineVideoStreams&&p.push.apply(p,g.T(this.C.offlineVideoStreams));this.C.captionTrack&&p.push.apply(p,g.T(this.C.captionTrack));return[].concat(g.T(new Set(p)))};
g.K(SDh,ds);SDh.prototype.T=function(){return[]};
g.K(NRK,ds);NRK.prototype.T=function(){return[]};
g.K(PaY,ds);PaY.prototype.T=function(){return[]};
g.K(u9F,ds);u9F.prototype.T=function(){return[]};
g.K(JlY,ds);JlY.prototype.T=function(){return[]};
g.K(KqF,ds);KqF.prototype.T=function(){return[]};
g.K(clU,ds);clU.prototype.T=function(){return[]};
g.K(RAh,ds);RAh.prototype.T=function(){return[]};
g.K($re,ds);$re.prototype.T=function(){return[]};
g.K(sZY,ds);sZY.prototype.T=function(){return[]};
g.K(rl6,ds);rl6.prototype.T=function(){return[]};
g.K(aE_,ds);aE_.prototype.T=function(){return[]};
g.K(kXX,ds);kXX.prototype.T=function(){return[]};
g.K(xrA,ds);xrA.prototype.T=function(){return[]};
g.K(TRA,ds);TRA.prototype.T=function(){return[]};
g.K(tgS,ds);tgS.prototype.T=function(){return[]};
g.K(YDX,ds);YDX.prototype.T=function(){return[]};
g.K(Mge,ds);Mge.prototype.T=function(){return[]};
g.K(Z1U,ds);Z1U.prototype.T=function(){return[]};
g.K(LqY,ds);LqY.prototype.T=function(){return[]};
g.K(lEL,ds);lEL.prototype.T=function(){return[]};
var L5h=["browse","music/browse","unplugged/browse"],BxF=["offline/playlist_sync_check"],r_U=["offline"],l$F=["offline/offline_video_playback_position_sync"],mye=["offline/get_playback_data_entity"],Ba;Ha.getInstance=function(){return g.w(function(p){return p.return(new Promise(function(y){g.Ws().then(function(O){O?(Ha.instance||(Ha.instance=new Ha(O)),y(Ha.instance)):y(void 0)})}))})};
Ha.prototype.get=function(p){var y=this,O,v,W;return g.w(function(E){if(E.T==1)return g.L(E,BR$(y.token),2);if(E.T!=3)return O=E.C,g.L(E,O.get("prefs",p),3);v=E.C;if(!v)return E.return();W=(0,g.I)();return v.expirationTimestampMs<=W?E.return():E.return(v.value)})};
Ha.prototype.set=function(p,y,O){O=O===void 0?31536E3:O;var v=this,W,E,z;return g.w(function(f){if(f.T==1)return W=(0,g.I)(),E={key:p,value:y,expirationTimestampMs:W+O*1E3},g.L(f,BR$(v.token),2);z=f.C;return g.L(f,g.Hi(z,"prefs",E),0)})};
Ha.prototype.remove=function(p){var y=this,O;return g.w(function(v){if(v.T==1)return g.L(v,BR$(y.token),2);O=v.C;return g.L(v,O.delete("prefs",p),0)})};
g.K(iu,g.pX);g.K(Fr,eAX);Fr.prototype.J=function(p,y){y=Ur_(y);p=(new TextEncoder).encode(JSON.stringify(p));return this.C.encrypt(p,y)};
Fr.prototype.T=function(p,y){if(!(p instanceof Uint8Array))throw H1Y(1);var O=new TextDecoder;y=Ur_(y);p=this.C.decrypt(p,y);return JSON.parse(O.decode(p))};
var jZU={accountLinkStatusEntity:E9L,booleanEntity:D3K,buttonEntity:xrA,captionTrack:zA6,channelHandle:bjF,chipEntity:clU,commerceAcquisitionClientPayloadEntity:tgS,commerceCartListEntity:YDX,contextNoteFeedEntityPayload:CHS,continuationTokenEntity:RPI,downloadQualityPickerEntity:fGh,downloadsPageRefreshTokenEntity:Q0h,downloadsPageViewConfigurationEntity:YMY,downloadStatusEntity:n9_,dismissState:RAh,sfvAudioItemCurrentlyPlayingEntity:u9F,emojiFountainDataEntity:aE_,emojiCustomizationSetEntity:rl6,
fakeChannel:AyX,fakePlaylist:pt6,fakePlaylistEntryCollection:OYU,fakeVideo:v96,fakeVideoDescription:WGI,featuredProductsEntity:HYY,flowStateEntity:g9I,iconBadgeEntity:Mge,interstitialInteractionStateEntity:GwF,likeButtonAnimationEntity:MB_,liveChatPollStateEntity:o9U,liveViewerLeaderboardChatEntryPointStateEntity:NRK,liveViewerLeaderboardPointsEntity:PaY,liveReactionsDataEntity:kXX,logoEntity:zPF,macroMarkerEntity:ZYY,mainDownloadsLibraryEntity:qMe,mainDownloadsListEntity:Ndh,mainPlaylistDownloadStateEntity:PQF,
mainPlaylistEntity:$LY,mainPlaylistVideoEntity:s0F,mainVideoDownloadStateEntity:ujY,mainVideoEntity:xLA,markersEngagementPanelSyncEntity:LGK,markersVisibilityOverrideEntity:lG_,musicAlbumReleaseDetail:hPU,musicAlbumReleaseDownloadMetadataEntity:IG_,musicAlbumRelease:j0Y,musicAlbumReleaseUserDetail:bYF,musicArtistDetail:DLL,musicArtist:CQY,musicArtistUserDetail:VBU,musicDownloadsLibraryEntity:eP$,musicLibraryEdit:AHh,musicLibraryStatusEntity:p_F,musicPlaylist:O1I,musicPlaylistDownloadMetadataEntity:XtF,
musicShare:vWK,musicTrackDetail:gWA,musicTrackDownloadMetadataEntity:UL6,musicTrack:WqY,musicTrackUserDetail:EWX,offlineOrchestrationActionWrapperEntity:GXF,offlineVideoPolicy:oW6,offlineVideoStreams:fEh,offlineabilityEntity:JHF,orchestrationWebSamplingEntity:KGA,pageHeaderEntity:$re,pdpStateEntity:Z1U,pinnedProductEntity:iYX,playbackData:nW6,playerStateEntity:wtL,quantityIncrementerEntity:LqY,refresh:QZS,saveToPlaylistListEntity:JlY,selectedChipIndexEntityPayload:mL6,settingEntity:KqF,stringEntity:V2Y,
suggestedFeedbackChipStateEntity:dLI,transfer:qDh,trendingOfferEntity:FGY,videoDownloadContextEntity:SDh,videoOverviewAsyncDataEntity:lEL,videoPlaybackPositionEntity:TRA,votingEntity:sZY,ytMainChannelEntity:TdU,youchatPendingResponseEntity:BdA,ytMainDownloadedVideoEntity:cHU,ytMainVideoEntity:tBF};g.K(h6,eAX);h6.prototype.J=function(p){return p};
h6.prototype.T=function(p){if(p instanceof Uint8Array)throw H1Y(0);return p};
g.K(bu,g.d);bu.prototype.observe=function(p){var y=this;this.observers.push(p);return function(){var O=y.observers.indexOf(p);O>=0&&y.observers.splice(O,1)}};
bu.prototype.T=function(p){zLX(this,p.data)};
bu.prototype.mN=function(){this.channel.close()};
var QIh,f$F=new g.L8("elementsCommand");var rH=new g.L8("entityBatchUpdate");var VuL=new g.L8("downloadStatusEntity");var SFK=new g.L8("mainPlaylistEntityActionMetadata");var CI=new g.L8("mainVideoEntityActionMetadata");var s4A=new g.L8("musicPlaylistEntityActionMetadata");var b8L=new g.L8("musicTrackEntityActionMetadata");var tXF=new g.L8("localImageEntityActionMetadata");var wH=new g.L8("playbackDataActionMetadata");var nkF=new g.L8("transferEntityActionMetadata");var C4_=new g.L8("videoPlaybackPositionEntityActionMetadata");var xaI;new g.JA;new g.JA;Z4Y.prototype.request=function(p,y,O){y=y===void 0?{}:y;return this.locks.request(p,y,function(v){return O(v)})};var v7=g.ji.caches,On,daA;yX.prototype.open=function(p){return v7.open(w3$(p))};
yX.prototype.has=function(p){return v7.has(w3$(p))};
yX.prototype.delete=function(p){return v7.delete(w3$(p))};
yX.prototype.match=function(p,y){var O=this,v,W,E,z,f,n;return g.w(function(Q){switch(Q.T){case 1:return g.L(Q,O.keys(),2);case 2:v=Q.C,W=g.c(v),E=W.next();case 3:if(E.done){Q.W2(5);break}z=E.value;return g.L(Q,O.open(z),6);case 6:return f=Q.C,g.L(Q,f.match(p,y),7);case 7:if(n=Q.C)return Q.return(n);E=W.next();Q.W2(3);break;case 5:return Q.return()}})};
g.K(lbh,yX);lbh.prototype.keys=function(){var p,y,O,v,W,E,z,f,n;return g.w(function(Q){if(Q.T==1)return p=[],y=g.yk("CacheStorage keys"),g.L(Q,v7.keys(),2);O=Q.C;v=g.c(O);for(W=v.next();!W.done;W=v.next()){E=W.value;var q=E.indexOf(":");z=q===-1?{QA:E}:{QA:E.substring(0,q),datasyncId:E.substring(q+1)};f=z.QA;n=z.datasyncId;n===y&&p.push(f)}return Q.return(p)})};g.K(gH,g.d);gH.prototype.J=function(p){this.api.g2("onOfflineOperationFailure",p.data)};
gH.prototype.B=function(p){this.api.publish("offlinetransferpause",p.data)};
gH.prototype.mN=function(){var p;(p=this.C)==null||p.close();var y;(y=this.T)==null||y.close()};i4F.prototype.fE=function(){this.C&&zv(this)};
i4F.prototype.ZB=function(){this.T&&this.T.resolve();this.J=this.C=!1;this.V()};var xu$=["OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"];var zq_="captionTrack downloadStatusEntity ytMainChannelEntity mainPlaylistEntity mainPlaylistDownloadStateEntity mainPlaylistVideoEntity mainVideoEntity mainVideoDownloadStateEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity videoPlaybackPositionEntity".split(" ");var J_6="downloadStatusEntity musicAlbumRelease musicDownloadsLibraryEntity musicPlaylist musicTrack musicTrackDownloadMetadataEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity".split(" ");g.K(iTY,ZV);iTY.prototype.T=function(p){return nI(p)?eqK(this,p):QX(p)?j4X(this,p):Promise.reject(Error("Unsupported action type: "+p.actionType))};g.K(hqS,ZV);hqS.prototype.T=function(p){return QX(p)?bT_(this,p):DaF(p)?DyI(this,p):q6(p)?Ve_(this,p):Promise.reject(Error("Unsupported action type: "+p.actionType))};g.J=A_F.prototype;g.J.VLa=function(p){var y=this,O,v,W,E;return g.w(function(z){if(!g.C(p.state,128))return z.W2(0);O=p.state.nw;var f=(v=O)==null?void 0:v.errorCode,n=(W=O)==null?void 0:W.oh;E=f==="net.connect"&&n===1?"TRANSFER_FAILURE_REASON_NETWORK_LOST":(f==null?0:f.startsWith("net."))?"TRANSFER_FAILURE_REASON_NETWORK":"TRANSFER_FAILURE_REASON_INTERNAL";return g.L(z,y.KC(y.player.getVideoData().videoId,E),0)})};
g.J.KC=function(p,y){var O=this;return g.w(function(v){if(v.T==1){if(O.T)return v.return();O.T=!0;return y==="TRANSFER_FAILURE_REASON_NETWORK_LOST"?(B7(O,p,!1,!0),v.W2(0)):g.L(v,dH(O,p),3)}g.Fp(p,4);return g.L(v,O.C.KC(y),0)})};
g.J.rZ=function(p){p.status===2?(p.status!==this.J&&(bhK(this.C),g.Fp(p.videoId,2)),p.Jm&&pnY(this.C,p.videoId,p.Jm)):p.status===4?(dH(this,p.videoId),this.KC(p.videoId,p.zb?"TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":"TRANSFER_FAILURE_REASON_INTERNAL")):p.status===1&&AgY(this.C);this.J=p.status;this.api.g2("localmediachange",{videoId:p.videoId,status:p.status})};
g.J.W1=function(){var p=this,y;return g.w(function(O){if(O.T==1){if(p.T)return O.return();p.T=!0;y=p.player.getVideoData().videoId;return g.L(O,dH(p,y),2)}return g.L(O,p.C.W1(),0)})};
g.J.d7=function(p){switch(p){case "HD_1080":return"hd1080";case "HD":return"hd720";case "SD":return"large";case "LD":return"tiny";default:return"hd720"}};
g.J.K=function(p){return this.api.X().K(p)};g.K(EkA,ZV);EkA.prototype.T=function(p){return nI(p)?GbI(this,p):QX(p)?ok6(this,p):DaF(p)?fjS(this,p):Promise.reject(Error("Unsupported action type: "+p.actionType))};P7_.prototype.C=function(p,y){var O=p.action.actionMetadata.priority-y.action.actionMetadata.priority;O===0&&(p.C<y.C?O=-1:p.C>y.C&&(O=1));return O};g.K(H7,g.d);H7.prototype.mN=function(){this.V&&this.V();g.d.prototype.mN.call(this)};
H7.prototype.createAction=function(p,y){var O=g.JK(p.entityKey).entityType,v=g.t8(16);return new Js(O,v,p,y.actionId,y.rootActionId)};
H7.prototype.T4=function(p){var y=this,O,v,W,E,z,f,n,Q,q;return g.w(function(S){if(S.T==1){if(y.DI())return S.return();v=(O=p.offlineOrchestrationActionWrapperEntity)!=null?O:new Set;W=[];E=g.c(v);for(z=E.next();!z.done;z=E.next())f=z.value,n=g.JK(f),Q=n.entityId,KnA(y.C,Q)||W.push(f);return g.L(S,Yh$(y,W),2)}q=S.C;return g.L(S,t1F(y,q),0)})};
H7.prototype.retry=function(){var p=this;return g.w(function(y){return g.L(y,M1L(p),0)})};Ln$.prototype.jW=function(p,y){y=y===void 0?!0:y;var O=this,v,W,E,z,f,n,Q,q;return g.w(function(S){switch(S.T){case 1:if(!O.C)return S.return();v=[];W=g.gD(O.C.T,y);E=[];for(z={rq:0};z.rq<W.length;z={rq:z.rq},z.rq++)f=W[z.rq],n=O.C.K2(f,"json3"),Q=g.mX(n,{withCredentials:!0,format:"RAW"},3,500).then(function(N){return function(P){P={metadata:g.kd(W[N.rq]),trackData:P.xhr.responseText};E.push(P)}}(z)).Zk(function(N){W7("Caption fetch error",N)}),v.push(Q);
return g.L(S,hw_(v),2);case 2:return g.Rx(S,3),g.L(S,cAF(p,E),5);case 5:g.rQ(S,0);break;case 3:q=g.kx(S),W7("Caption DB transaction error",q),g.cR(S)}})};g.K(iw,g.d);iw.prototype.mN=function(){this.T&&this.T();g.d.prototype.mN.call(this)};
iw.prototype.J=function(p){var y=this,O,v,W,E,z,f,n,Q;return g.w(function(q){v=(O=p.transfer)!=null?O:new Set;W=[];E=g.c(v);for(z=E.next();!z.done;z=E.next())f=z.value,n=g.JK(f),Q=n.entityId,W.push(Q);return W.length===0?q.return():g.L(q,muY(y,W),0)})};g.K(FnX,g.d);g.J=FnX.prototype;g.J.mN=function(){this.R_&&this.R_();this.Ne.dispose();this.B.dispose();this.xs&&g.ED(this.G.Jc,this.xs);this.Ys&&g.ED(this.G.Jc,this.Ys);g.d.prototype.mN.call(this)};
g.J.YXa=function(p){var y=this,O,v,W;return g.w(function(E){switch(E.T){case 1:O=g.Ky(p,"transfer");if(y.C&&O===y.C.key){B7(y.Y,y.D,!0);y.B.stop();E.W2(0);break}return g.L(E,Ci(y.T,{mode:"readwrite",K_:!0},function(z){return Iv(z,O,"transfer").then(function(f){if(f&&f.transferState!=="TRANSFER_STATE_COMPLETE"&&f.transferState!=="TRANSFER_STATE_FAILED")return f.transferState="TRANSFER_STATE_PAUSED_BY_USER",UG(z,f,"transfer").then(function(){return f})})}),3);
case 3:v=E.C;if(!v){E.W2(0);break}if(!p||!y.J){E.W2(5);break}return g.L(E,SG(p,y.J,y.T,"DOWNLOAD_STATE_PAUSED"),5);case 5:return g.L(E,eG(y,p),7);case 7:W=E.C,b4A({videoId:p,ZO:v,offlineModeType:W}),g.cR(E)}})};
g.J.K2L=function(){var p=this;if(this.C&&this.D){B7(this.Y,this.D,!1);var y=this.C,O=(y==null?0:y.key)?g.JK(y.key).entityId:"";O&&this.J&&(new Promise(function(v,W){SG(O,p.J,p.T,"DOWNLOAD_STATE_PAUSED").catch(function(E){W(E)})})).catch(function(v){W7("Download state setting error",v)})}this.B.stop()};
g.J.bX=function(){this.C?XIX(this,this.C):I8(this)};
g.J.WV=function(p){var y=this;return g.w(function(O){switch(O.T){case 1:if(!y.C){O.W2(2);break}if(y.C.transferState==="TRANSFER_STATE_COMPLETE"||y.C.transferState==="TRANSFER_STATE_FAILED"||!p.transfer||!p.transfer.has(y.C.key)){O.W2(3);break}return g.L(O,V6(y.T,y.C.key,"transfer"),4);case 4:y.C=O.C;if(y.C){O.W2(3);break}return g.L(O,UuS(y),3);case 3:if(y.C)return O.return();case 2:return g.L(O,I8(y),0)}})};
g.J.KC=function(p,y){var O=this,v,W,E,z,f;return g.w(function(n){switch(n.T){case 1:if(!O.C){X_(O,"onTransferFailure: "+p);n.W2(2);break}v=O.C;E=((W=v)==null?0:W.key)?g.JK(v.key).entityId:"";a:switch(p){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_PLAYABILITY":case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":var Q=!1;break a;default:Q=!0}return Q&&ySS(O)?g.L(n,Un(O,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),8):g.L(n,
O8e(O,p),5);case 5:if(!E||!O.J){n.W2(2);break}return g.L(n,SG(E,O.J,O.T,"DOWNLOAD_STATE_FAILED"),2);case 8:return g.L(n,eG(O,E),9);case 9:z=n.C;o8({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_RETRY"},{videoId:E,ZO:v,offlineModeType:z});if(!E||!O.J){n.W2(2);break}return g.L(n,SG(E,O.J,O.T,"DOWNLOAD_STATE_RETRYABLE_FAILURE"),2);case 2:F_(O),f=I8(O,!0),y&&y(f),g.cR(n)}})};
g.J.W1=function(p){var y=this,O,v,W,E,z,f,n,Q,q,S,N,P;return g.w(function(u){switch(u.T){case 1:if(!y.C){X_(y,"onMaybeTransferStreamsExpired");u.W2(2);break}return ySS(y)?g.L(u,Un(y,"TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"),9):g.L(u,O8e(y,"TRANSFER_FAILURE_REASON_STREAM_MISSING"),5);case 5:if(!y.J){u.W2(2);break}O=y.C;W=((v=O)==null?0:v.key)?g.JK(O.key).entityId:"";if(!W){u.W2(2);break}return g.L(u,SG(W,y.J,y.T,"DOWNLOAD_STATE_FAILED"),2);case 9:return y.C||X_(y,"onMaybeTransferStreamsExpiredRetryAttempting"),
E=y.C,f=((z=E)==null?0:z.key)?g.JK(E.key).entityId:"",g.L(u,eG(y,f),10);case 10:return n=u.C,o8({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_PLAYER_RESPONSE_EXPIRATION"},{videoId:f,ZO:E,offlineModeType:n}),Q=y_F(),g.hT(Q,wH,{isEnqueuedForExpiredStreamUrlRefetch:!0}),q=g.Ky(f,"playbackData"),S={actionType:"OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",entityKey:q,actionMetadata:Q},N=c7(new Js("playbackData",f,S)),g.L(u,Dp(y.T,N,"offlineOrchestrationActionWrapperEntity"),2);case 2:F_(y),P=I8(y,!0),
p&&p(P),g.cR(u)}})};
var ELS={},vZe=(ELS.TRANSFER_STATE_TRANSFERRING=1,ELS.TRANSFER_STATE_TRANSFER_IN_QUEUE=2,ELS);g.J=jG.prototype;g.J.CB=function(){return this.D.promise};
g.J.R5=function(){if(this.T&&this.Y)return this.D.promise;EZU(this).then(this.D.resolve).catch(this.D.reject);return this.D.promise};
g.J.JA=function(p){var y={};return y.playbackData=new iTY(p,this.I_,this.C),y.transfer=new EkA(p,this.I_),y.videoPlaybackPositionEntity=new hqS(p,this.I_),y};
g.J.LO=function(){var p=this;return g.w(function(y){return p.T?g.L(y,IjI(p.T),0):y.W2(0)})};
g.J.W8=function(){var p=this,y,O;return g.w(function(v){if(v.T==1)return p.T||p.Y?g.L(v,p.CB(),2):v.return();p.S!==void 0&&(g.aG(p.S),p.S=void 0);p.B!==void 0&&(g.aG(p.B),p.B=void 0);(y=p.T)==null||y.dispose();p.T=void 0;(O=p.Y)==null||O.dispose();p.Y=void 0;p.api.g2("onOrchestrationLostLeader");p.D=new g.JA;g.cR(v)})};
g.J.isOrchestrationLeader=function(){return this.J.C};
g.J.Dd=function(){return g.w(function(p){return p.return(!1)})};
g.J.Z7=function(p){var y=this.C;y.api.publish("offlinetransferpause",p);var O;(O=y.T)==null||O.postMessage(p)};
g.J.bX=function(p){var y,O;return g.w(function(v){if(v.T==1)return g.L(v,pI(),2);y=v.C;if(!y)return v.return();O=g.Ky(p,"transfer");return g.L(v,Ci(y,{mode:"readwrite",K_:!0},function(W){var E=Iv(W,O,"transfer"),z=Iv(W,g.Ky(p,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.YB.all([E,z]).then(function(f){f=g.c(f);var n=f.next().value;var Q=f.next().value;return n&&n.transferState==="TRANSFER_STATE_PAUSED_BY_USER"?(n.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE",UG(W,n,"transfer").then(function(){o8({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_USER_RESUME",
statusType:"USER_RESUMED"},{videoId:p,ZO:n,offlineModeType:Q==null?void 0:Q.offlineModeType});return g.YB.resolve(null)})):g.YB.resolve(null)})}),0)})};
g.J.Qg=function(p){p=p===void 0?43200:p;var y=this,O,v,W,E,z,f,n,Q;return g.w(function(q){if(q.T==1)return y.G.Az()?g.L(q,pI(),2):q.return(zjK());if(q.T!=3){O=q.C;if(!O)return q.return([]);v=Date.now()/1E3;return g.L(q,A6(O,"offlineVideoPolicy"),3)}W=q.C;E=[];z=g.c(W);for(f=z.next();!f.done;f=z.next())n=f.value,Number(n.lastUpdatedTimestampSeconds)+p<=v&&(Q=g.JK(n.key).entityId,E.push(Q));return E.length?q.return(hs(y,E,y.V,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH")):q.return([])})};
g.J.deleteAll=function(){return hs(this,["!*$_ALL_ENTITIES_!*$"],this.V,"OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",{offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}})};
g.J.refreshAllStaleEntities=function(p){var y=this;return g.w(function(O){return O.T==1?g.L(O,y.Qg(p),2):O.return(O.C)})};
g.J.setUpPositionSyncInterval=function(p){var y=this;this.B!==void 0&&(g.aG(this.B),this.B=void 0);var O=p!=null?p:864E5;this.B=g.se(function(){y.zE(O)},O)};
g.J.zE=function(p){var y=this,O,v,W,E,z,f;return g.w(function(n){switch(n.T){case 1:return g.Rx(n,2),g.L(n,Ha.getInstance(),4);case 4:O=n.C;if(!O)throw Error("prefStorage is undefined");return g.L(n,O.get("psi"),5);case 5:v=n.C;E=((W=v)==null?0:W.tB)?Number(v.tB)/1E3:0;z=Date.now();if(!(E+p<=z)){n.W2(6);break}return g.L(n,hs(y,["!*$_ALL_ENTITIES_!*$"],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"),6);case 6:g.rQ(n,0);break;case 2:f=g.kx(n),W7("Offline manager error",f),
g.cR(n)}})};
g.J.l9=function(){var p=this,y,O,v,W,E,z,f;return g.w(function(n){if(n.T==1)return g.L(n,pI(),2);if(n.T!=3)return(y=n.C)?g.L(n,A6(y,"transfer"),3):n.return([]);O=n.C;v=[];W=g.c(O);for(E=W.next();!E.done;E=W.next())z=E.value,z.transferState==="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"&&z.key&&(f=g.JK(z.key).entityId,v.push(f));return n.return(oZS(p,v))})};
g.J.c9=function(){return g.w(function(p){return p.return([])})};
g.J.f5=function(){return g.w(function(p){g.cR(p)})};
g.J.Ky=function(){return g.w(function(p){g.cR(p)})};g.K(fmY,ZV);fmY.prototype.T=function(p){return nI(p)?qF$(this,p):QX(p)?N7h(this,p):q6(p)?P9F(this,p):Promise.reject(Error("Unsupported action type: "+p.actionType))};
var bw=[10];g.K(RjF,ZV);RjF.prototype.T=function(p){return nI(p)?rSS(this,p):QX(p)?amF(this,p):q6(p)?ki_(this,p):Promise.reject(Error("Unsupported action type: "+p.actionType))};
var sAK=[10];g.K(T7L,ZV);T7L.prototype.T=function(p){return QX(p)?YFF(this,p):Promise.reject(Error("Unsupported action type: "+p.actionType))};g.K(MXh,jG);g.J=MXh.prototype;g.J.JA=function(p){var y=jG.prototype.JA.call(this,p);y.mainVideoEntity=new RjF(p,this.I_,this.C);y.mainPlaylistEntity=new fmY(p,this.I_,this.C);y.mainDownloadsListEntity=new T7L(p,this.I_,this.C);return y};
g.J.refreshAllStaleEntities=function(p,y){var O=this,v,W,E,z,f,n,Q,q,S,N,P;return g.w(function(u){switch(u.T){case 1:v=[];if(!O.I_.K("web_player_offline_playlist_auto_refresh")){u.W2(2);break}return g.L(u,Z8K(O,p,y),3);case 3:v=u.C;case 2:return g.L(u,Ha.getInstance(),4);case 4:return W=u.C,g.L(u,(E=W)==null?void 0:E.get("sdois"),5);case 5:return z=u.C,g.L(u,(f=W)==null?void 0:f.get("lmqf"),6);case 6:n=u.C;if(!z){u.W2(7);break}q=v;S=q.concat;return g.L(u,L86(O,z,(Q=n)!=null?Q:"SD",p===0),8);case 8:v=
S.call(q,u.C);case 7:return N=v,P=N.concat,g.L(u,jG.prototype.refreshAllStaleEntities.call(O,p,y),9);case 9:return v=P.call(N,u.C),u.return(v)}})};
g.J.Dd=function(p){var y,O,v,W,E,z,f,n;return g.w(function(Q){if(Q.T==1)return g.L(Q,pI(),2);if(Q.T!=3)return(y=Q.C)?g.L(Q,V6(y,g.mY,"mainDownloadsListEntity"),3):Q.return(!1);O=Q.C;if((v=O)==null?0:(W=v.downloads)==null?0:W.length)for(E=g.Ky(p,"mainVideoEntity"),z=g.c(O.downloads),f=z.next();!f.done;f=z.next())if(n=f.value,n.videoItem===E)return Q.return(!0);return Q.return(!1)})};
g.J.c9=function(){var p=this,y,O,v,W,E,z,f,n;return g.w(function(Q){if(Q.T==1)return g.L(Q,pI(),2);if(Q.T!=3)return(y=Q.C)?g.L(Q,A6(y,"downloadStatusEntity"),3):Q.return([]);O=Q.C;v=[];W=g.c(O);for(E=W.next();!E.done;E=W.next())z=E.value,z.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&z.key&&(f=g.JK(z.key).entityId,v.push(f));return v.length?(n={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}},Q.return(hs(p,v,"mainVideoEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
n))):Q.return([])})};
g.J.Ky=function(){var p;return g.w(function(y){return y.T==1?g.L(y,pI(),2):(p=y.C)?g.L(y,Ci(p,{mode:"readwrite",K_:!0},function(O){return eO(O,"mainVideoEntity").then(function(v){var W=[];v=g.c(v);for(var E=v.next();!E.done;E=v.next()){E=E.value;var z=void 0;(z=E.userState)!=null&&z.playbackPosition||(z=g.JK(E.key).entityId,z={key:g.Ky(z,"videoPlaybackPositionEntity"),videoId:z,lastPlaybackPositionSeconds:"0"},W.push(UG(O,z,"videoPlaybackPositionEntity")),E.userState={playbackPosition:z.key},W.push(UG(O,
E,"mainVideoEntity")))}return g.YB.all(W)})}),0):y.return()})};
g.J.f5=function(){var p,y,O,v,W,E,z,f,n,Q,q,S,N,P,u,R,r,x,k,M,l,H,h,X,V,WR,O4,E4,b,PR,xx,U4,rF,GL,T0,ax,O_,a;return g.w(function(G0){if(G0.T==1)return g.L(G0,pI(),2);if(G0.T!=3){p=G0.C;if(!p)return G0.return();y=g.Ky("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity");return g.L(G0,Ci(p,{mode:"readonly",K_:!0},function(U_){return g.YB.all([Iv(U_,y,"mainDownloadsListEntity"),Iv(U_,g.mY,"mainDownloadsListEntity"),eO(U_,"mainVideoEntity"),eO(U_,"mainPlaylistEntity")])}),3)}O=G0.C;
v=g.c(O);W=v.next().value;E=v.next().value;z=v.next().value;f=v.next().value;n=W;Q=E;q=z;S=f;N=new Set;if((P=n)==null?0:(u=P.downloads)==null?0:u.length)for(R=g.c(n.downloads),r=R.next();!r.done;r=R.next())x=r.value,k=void 0,(M=(k=x.videoItem)!=null?k:x.playlistItem)&&N.add(M);if((l=Q)==null?0:(H=l.downloads)==null?0:H.length)for(h=g.c(Q.downloads),X=h.next();!X.done;X=h.next())V=X.value,V.videoItem&&N.add(V.videoItem);WR=new Set;O4=[];E4=g.c(S);for(b=E4.next();!b.done;b=E4.next()){PR=b.value;if(PR.videos)for(xx=
g.c(PR.videos),U4=xx.next();!U4.done;U4=xx.next())rF=U4.value,(GL=JSON.parse(g.JK(rF).entityId).videoId)&&WR.add(GL);PR.key&&!N.has(PR.key)&&O4.push(PR.key)}T0=g.c(q);for(ax=T0.next();!ax.done;ax=T0.next())O_=ax.value,O_.key&&!N.has(O_.key)&&(a=g.JK(O_.key).entityId,WR.has(a)||O4.push(O_.key));return O4.length?g.L(G0,S2L(p,O4),0):G0.W2(0)})};g.K(lmF,ZV);lmF.prototype.T=function(p){return nI(p)?mKe(this,p):QX(p)?dKL(this,p):q6(p)?B7L(this,p):Promise.reject(Error("Unsupported action type: "+p.actionType))};
var DV=[10];g.K(i8F,ZV);i8F.prototype.T=function(p){return nI(p)?Im$(this,p):QX(p)?ej_(this,p):q6(p)?XnY(this,p):Promise.reject(Error("Unsupported action type: "+p.actionType))};
var VX=[10];g.K(hjA,ZV);hjA.prototype.T=function(p){return nI(p)?VX6(this,p):QX(p)?ASY(this,p):q6(p)?pfY(this,p):Promise.reject(Error("Unsupported action type: "+p.actionType))};
var DKU=[10];g.K(As,jG);As.prototype.JA=function(p){var y=jG.prototype.JA.call(this,p);y.musicTrack=new hjA(p,this.C);y.musicPlaylist=new i8F(p,this.C);y.musicAlbumRelease=new lmF(p,this.C);return y};
As.prototype.refreshAllStaleEntities=function(p,y){var O=this,v,W,E;return g.w(function(z){if(z.T==1)return g.L(z,O5A(O,p,y),2);if(z.T!=3)return W=v=z.C,E=W.concat,g.L(z,jG.prototype.refreshAllStaleEntities.call(O,p,y),3);v=E.call(W,z.C);return z.return(v)})};g.K(vLh,g.Ru);g.J=vLh.prototype;g.J.create=function(){var p=this;g.B(this,this.events);if(g.zd(this.I_))this.C=new MXh(this.I_,this.player);else if(g.hX(this.I_)||g.fL(this.I_)==="WEB_MUSIC_INTEGRATIONS")this.C=new As(this.I_,this.player);this.events.j(this.player,"onPlaybackStartExternal",function(){p.SR()});
this.events.j(this.player,"videodatachange",function(){p.SR()});
this.I_.K("html5_offline_playback_position_sync")&&this.events.j(this.player,"presentingplayerstatechange",this.zY)};
g.J.Sh=function(){return!1};
g.J.oi=function(p,y,O,v){var W=this;return g.w(function(E){return W.C?E.return(hs(W.C,p,y,O,v)):E.return(Promise.reject())})};
g.J.deleteAll=function(){return this.C.deleteAll()};
g.J.Qg=function(p){return this.C.Qg(p)};
g.J.refreshAllStaleEntities=function(p){return this.C.refreshAllStaleEntities(p)};
g.J.setUpPositionSyncInterval=function(p){this.C.setUpPositionSyncInterval(p)};
g.J.Z7=function(p){this.C.Z7(p)};
g.J.bX=function(p){return this.C.bX(p)};
g.J.SR=function(){var p=this,y;return g.w(function(O){y=p.player.getVideoData();return g.yD(y)?WXS(y)&&p.T!==y.clientPlaybackNonce?g.L(O,gLX(p,y),0):O.W2(0):O.return()})};
g.J.zY=function(p){var y=this,O,v,W,E,z,f,n;return g.w(function(Q){if(Q.T==1)return O=y.player.getVideoData(),v=O.U6,g.aU(p,2)||g.aU(p,512)?g.L(Q,pI(),2):Q.return();if(Q.T!=3){W=Q.C;if(!W)return W7("PES is undefined"),Q.return();E=O.videoId;return g.L(Q,V6(W,g.Ky(E,"mainVideoEntity"),"mainVideoEntity"),3)}z=Q.C;if(!z)return Q.return();f=Math.floor(v).toString();n={videoPlaybackPositionEntityActionMetadata:{lastPlaybackPositionSeconds:f}};return g.L(Q,y.oi([E],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE",
n),0)})};
g.J.isOrchestrationLeader=function(){return this.C.isOrchestrationLeader()};
g.J.updateDownloadState=function(p,y){var O,v,W,E;return g.w(function(z){if(z.T==1)return g.L(z,pI(),2);O=z.C;if(!O)return W7("PES is undefined"),z.return();v=g.JK(p);W=v.entityType;E=v.entityId;return g.L(z,SG(E,W,O,y,!0),0)})};g.c5("offline",vLh);})(_yt_player);
